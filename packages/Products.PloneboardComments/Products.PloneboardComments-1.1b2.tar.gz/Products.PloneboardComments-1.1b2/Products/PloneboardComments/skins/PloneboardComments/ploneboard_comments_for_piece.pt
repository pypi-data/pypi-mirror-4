<metal:discussion define-macro="discussion-summary">
  <div class="discreet"
       tal:define="object__ entry | object_ | nothing; object_ python:(hasattr(object__, 'getObject') and object__.getObject()) or object__; isDiscussionAllowed python:context.portal_discussion.isDiscussionAllowedFor(object_);">
        <tal:if condition="python:isDiscussionAllowed and object_"> <!-- tal:on-error="nothing"> -->
          <metal:block tal:define="conversation python:context.ploneboard_comments_get_conversation(object_)">
          <tal:single i18n:domain="PloneboardComments">
          <a tal:condition="python:conversation" href="#" tal:attributes="href conversation/absolute_url" i18n:domain="PloneboardComments"><span i18n:translate="">There is a conversation about this piece here and it has</span> <span tal:replace="python:conversation.getNumberOfComments() - 1"></span> <span i18n:translate="">comment(s)</span>.</a>

         <a tal:condition="python:(not conversation)" href="#" tal:attributes="href python:context.ploneboard_comments_create_conversation_url(object=entry)" i18n:translate="">Start a conversation about this piece.</a>
          </tal:single>
          </metal:block>
        </tal:if>
      </div>
</metal:discussion>
