<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <title>Test coverage report: event_rsvp.views</title>
    <style type="text/css" media="screen">
      a
      {
        color: #3d707a;
      }
      
      a:hover, a:active
      {
        color: #bf7d18;
      }
    
      body 
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        font-size: 13px;
      }
      
      .nav 
      {
        font-size: 12px;
        margin-left: 50px;
      }

      .ignored
      {
        color: #707070;
      }

      .executed 
      {
        color: #3d9900;
      }

      .missed 
      {
        color: red;
        font-weight: bold;
      }

      .excluded 
      {
        color: #6090f0;
        font-weight: lighter;
      }
    
      #content-header 
      {
        font-size: 12px;
        padding: 18px 0 18px 50px;
      }

      #content-header h1 
      {
        font-size: 16px;
        margin: 10px 0 0 0;
        color: #909090;
      }
      
      #module-name
      {
        color: #583707;
      }
    
      #content-header p
      {
        font-size: 13px;
        margin: 0;
        color: #909090;
      }

      #content-header .normal 
      {
        color: #609030;
      }

      #content-header .warning 
      {
        color: #d0a000;
      }

      #content-header .critical 
      {
        color: red;
      }
      
      #source-listing 
      {
        margin-bottom: 24px;
      }

      #source-listing ol 
      {
        padding: 0 0 0 50px;
        width: 90%;
        font-family: monospace;
        list-style-position: outside;
      }

      #source-listing ol li 
      {
        line-height: 18px;
        font-size: small;
      }
        
      #source-listing ol code 
      {
        padding:  0 .001em 0 0; /* Firefox doesn't render empty li's properly */
        font-size: medium;
        white-space: pre;
      }
   </style>
  </head>

  <body>

<div class="nav">
  <a href="event_rsvp.models.html">event_rsvp.models</a> &lt;&lt;
  <a href="../index.html">index</a>
</div>

<div id="content-header">
  <h1>
    <span id="module-name">event_rsvp.views</span>:
    121 total statements,
    <span class="normal">100.0% covered</span>
  </h1>
  <p>Generated: Tue 2013-04-16 10:12 CEST</p>
  <p>Source file: /home/tobi/Projects/event-rsvp/src/event_rsvp/views.py</p>
  <p>
    Stats:
    <span class="executed">113 executed</span>,
    <span class="missed">0 missed</span>,
    <span class="excluded">8 excluded</span>,
    <span class="ignored">106 ignored</span> 
  </p> 
</div>

<div id="source-listing">
  <ol>
    <li class="ignored"><code>"""Views for the ``event_rsvp`` app."""</code></li>
<li class="excluded"><code>from django.contrib.auth.decorators import login_required</code></li>
<li class="excluded"><code>from django.core.urlresolvers import reverse</code></li>
<li class="excluded"><code>from django.http import Http404, HttpResponseRedirect</code></li>
<li class="excluded"><code>from django.utils import timezone</code></li>
<li class="excluded"><code>from django.utils.decorators import method_decorator</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>from django.views.generic import (</code></li>
<li class="ignored"><code>    CreateView,</code></li>
<li class="ignored"><code>    DeleteView,</code></li>
<li class="ignored"><code>    DetailView,</code></li>
<li class="ignored"><code>    ListView,</code></li>
<li class="ignored"><code>    UpdateView,</code></li>
<li class="ignored"><code>)</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>from event_rsvp.forms import EventForm, GuestForm</code></li>
<li class="excluded"><code>from event_rsvp.models import Event, Guest</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>#--------#</code></li>
<li class="ignored"><code># Mixins #</code></li>
<li class="ignored"><code>#--------#</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class StaffMixin(object):</code></li>
<li class="ignored"><code>    """Mixin to let only staff member pass."""</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    @method_decorator(login_required)</code></li>
<li class="ignored"><code>    def dispatch(self, request, *args, **kwargs):</code></li>
<li class="executed"><code>        if not request.user.is_staff:</code></li>
<li class="executed"><code>            raise Http404</code></li>
<li class="executed"><code>        return super(StaffMixin, self).dispatch(request, *args, **kwargs)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class EventViewMixin(object):</code></li>
<li class="ignored"><code>    """Mixin to handle event-specific options."""</code></li>
<li class="executed"><code>    model = Event</code></li>
<li class="executed"><code>    form_class = EventForm</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_form_kwargs(self):</code></li>
<li class="executed"><code>        kwargs = super(EventViewMixin, self).get_form_kwargs()</code></li>
<li class="executed"><code>        kwargs.update({'created_by': self.request.user})</code></li>
<li class="executed"><code>        return kwargs</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_success_url(self):</code></li>
<li class="executed"><code>        return reverse('rsvp_event_staff')</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class EventSecurityMixin(object):</code></li>
<li class="ignored"><code>    """Mixin to handle event-specific security options."""</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def dispatch(self, request, *args, **kwargs):</code></li>
<li class="executed"><code>        self.kwargs = kwargs</code></li>
<li class="executed"><code>        self.object = self.get_object()</code></li>
<li class="executed"><code>        date = self.object.start</code></li>
<li class="ignored"><code>        # Check the right starting date within the slug</code></li>
<li class="executed"><code>        if (date.year != int(kwargs.get('year'))</code></li>
<li class="ignored"><code>                or date.month != int(kwargs.get('month'))</code></li>
<li class="ignored"><code>                or date.day != int(kwargs.get('day'))):</code></li>
<li class="executed"><code>            redirect_url = getattr(self.object, 'get_{0}_url'.format(</code></li>
<li class="ignored"><code>                self.url_mode))</code></li>
<li class="executed"><code>            return HttpResponseRedirect(redirect_url())</code></li>
<li class="executed"><code>        return super(EventSecurityMixin, self).dispatch(request, *args,</code></li>
<li class="ignored"><code>                                                        **kwargs)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class GuestViewMixin(object):</code></li>
<li class="ignored"><code>    """Mixin to handle guest-specific functions."""</code></li>
<li class="executed"><code>    model = Guest</code></li>
<li class="executed"><code>    form_class = GuestForm</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def dispatch(self, request, *args, **kwargs):</code></li>
<li class="executed"><code>        try:</code></li>
<li class="executed"><code>            self.event = Event.objects.get(slug=kwargs.get('event_slug'))</code></li>
<li class="executed"><code>        except Event.DoesNotExist:</code></li>
<li class="executed"><code>            raise Http404</code></li>
<li class="executed"><code>        return super(GuestViewMixin, self).dispatch(request, *args, **kwargs)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_context_data(self, **kwargs):</code></li>
<li class="executed"><code>        context = super(GuestViewMixin, self).get_context_data(**kwargs)</code></li>
<li class="executed"><code>        context.update({'event': self.event, 'user': self.request.user})</code></li>
<li class="executed"><code>        if (self.request.user.is_authenticated()</code></li>
<li class="ignored"><code>                or self.event.allow_anonymous_rsvp):</code></li>
<li class="executed"><code>            context.update({'permission_to_book': True})</code></li>
<li class="executed"><code>        return context</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_form_kwargs(self):</code></li>
<li class="executed"><code>        kwargs = super(GuestViewMixin, self).get_form_kwargs()</code></li>
<li class="executed"><code>        kwargs.update({'event': self.event, 'user': self.request.user})</code></li>
<li class="executed"><code>        return kwargs</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_success_url(self):</code></li>
<li class="executed"><code>        return self.event.get_absolute_url()</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class GuestSecurityMixin(object):</code></li>
<li class="ignored"><code>    """Mixin to handle guest-specific security options."""</code></li>
<li class="executed"><code>    def get_object(self, *args, **kwargs):</code></li>
<li class="executed"><code>        obj = super(GuestSecurityMixin, self).get_object(*args, **kwargs)</code></li>
<li class="executed"><code>        if obj.event != self.event:</code></li>
<li class="executed"><code>            raise Http404</code></li>
<li class="executed"><code>        return obj</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>#--------#</code></li>
<li class="ignored"><code># Views  #</code></li>
<li class="ignored"><code>#--------#</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class EventListView(ListView):</code></li>
<li class="ignored"><code>    """List view to display upcoming events."""</code></li>
<li class="executed"><code>    def get_queryset(self):</code></li>
<li class="executed"><code>        return Event.objects.filter(start__gt=timezone.now(),</code></li>
<li class="ignored"><code>                                    is_published=True)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_context_data(self, **kwargs):</code></li>
<li class="executed"><code>        context = super(EventListView, self).get_context_data(**kwargs)</code></li>
<li class="executed"><code>        if self.request.user.is_authenticated():</code></li>
<li class="executed"><code>            context.update({</code></li>
<li class="ignored"><code>                'my_participations': self.request.user.guest_set.all()})</code></li>
<li class="executed"><code>        return context</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class EventDetailView(EventSecurityMixin, EventViewMixin, DetailView):</code></li>
<li class="ignored"><code>    """Detail view to display information of an event."""</code></li>
<li class="executed"><code>    url_mode = 'absolute'</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def dispatch(self, request, *args, **kwargs):</code></li>
<li class="executed"><code>        self.kwargs = kwargs</code></li>
<li class="executed"><code>        self.object = self.get_object()</code></li>
<li class="executed"><code>        if not self.object.is_published and not request.user.is_staff:</code></li>
<li class="executed"><code>            raise Http404</code></li>
<li class="executed"><code>        return super(EventDetailView, self).dispatch(request, *args, **kwargs)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class EventCreateView(StaffMixin, EventViewMixin, CreateView):</code></li>
<li class="ignored"><code>    """Create view to handle information of an event."""</code></li>
<li class="executed"><code>    pass</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class EventUpdateView(StaffMixin, EventSecurityMixin, EventViewMixin,</code></li>
<li class="ignored"><code>                      UpdateView):</code></li>
<li class="ignored"><code>    """Update view to handle information of an event."""</code></li>
<li class="executed"><code>    url_mode = 'update'</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class EventDeleteView(StaffMixin, EventSecurityMixin, EventViewMixin,</code></li>
<li class="ignored"><code>                      DeleteView):</code></li>
<li class="ignored"><code>    """Delete view to remove the relevant event."""</code></li>
<li class="executed"><code>    url_mode = 'delete'</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class EventCreateFromTemplateView(StaffMixin, EventViewMixin, CreateView):</code></li>
<li class="ignored"><code>    """Create view to create information of an event from a template."""</code></li>
<li class="executed"><code>    @method_decorator(login_required)</code></li>
<li class="ignored"><code>    def dispatch(self, request, *args, **kwargs):</code></li>
<li class="executed"><code>        try:</code></li>
<li class="ignored"><code>            # Check if it's really a template</code></li>
<li class="executed"><code>            self.template = Event.objects.get(pk=kwargs.get('pk'),</code></li>
<li class="ignored"><code>                                              template_name__gt='')</code></li>
<li class="executed"><code>        except Event.DoesNotExist:</code></li>
<li class="executed"><code>            raise Http404</code></li>
<li class="executed"><code>        return super(EventCreateFromTemplateView, self).dispatch(</code></li>
<li class="ignored"><code>            request, *args, **kwargs)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_form_kwargs(self):</code></li>
<li class="executed"><code>        kwargs = super(EventCreateFromTemplateView, self).get_form_kwargs()</code></li>
<li class="executed"><code>        kwargs.update({'instance': self.template,</code></li>
<li class="ignored"><code>                       'create_from_template': True})</code></li>
<li class="executed"><code>        return kwargs</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class StaffDashboardView(StaffMixin, ListView):</code></li>
<li class="ignored"><code>    """View to display event related functions and lists."""</code></li>
<li class="executed"><code>    model = Event</code></li>
<li class="executed"><code>    template_name = 'event_rsvp/staff_dashboard.html'</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def get_context_data(self, **kwargs):</code></li>
<li class="executed"><code>        context = super(StaffDashboardView, self).get_context_data(**kwargs)</code></li>
<li class="executed"><code>        templates = self.object_list.exclude(template_name__exact='')</code></li>
<li class="executed"><code>        self.object_list = self.object_list.filter(template_name__exact='')</code></li>
<li class="executed"><code>        context.update({</code></li>
<li class="ignored"><code>            'upcoming': self.object_list.filter(start__gt=timezone.now()),</code></li>
<li class="ignored"><code>            'current': self.object_list.filter(start__lte=timezone.now(),</code></li>
<li class="ignored"><code>                                               end__gte=timezone.now()),</code></li>
<li class="ignored"><code>            'past': self.object_list.filter(end__lt=timezone.now()),</code></li>
<li class="ignored"><code>            'templates': templates,</code></li>
<li class="ignored"><code>        })</code></li>
<li class="executed"><code>        return context</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class GuestDetailView(StaffMixin, GuestSecurityMixin, GuestViewMixin,</code></li>
<li class="ignored"><code>                      DetailView):</code></li>
<li class="ignored"><code>    """View to display guest related functions and lists."""</code></li>
<li class="executed"><code>    pass</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class GuestCreateView(GuestViewMixin, CreateView):</code></li>
<li class="ignored"><code>    """Create view to add a guest to an event."""</code></li>
<li class="executed"><code>    def get_form_kwargs(self):</code></li>
<li class="executed"><code>        kwargs = super(GuestCreateView, self).get_form_kwargs()</code></li>
<li class="executed"><code>        if self.request.user.is_authenticated():</code></li>
<li class="executed"><code>            kwargs.update({'initial': {</code></li>
<li class="ignored"><code>                'name': self.request.user.get_full_name(),</code></li>
<li class="ignored"><code>                'email': self.request.user.email}})</code></li>
<li class="executed"><code>        return kwargs</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class GuestUpdateView(GuestSecurityMixin, GuestViewMixin, UpdateView):</code></li>
<li class="ignored"><code>    """Update view to handle a guest."""</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    @method_decorator(login_required)</code></li>
<li class="ignored"><code>    def dispatch(self, request, *args, **kwargs):</code></li>
<li class="executed"><code>        try:</code></li>
<li class="executed"><code>            self.event = Event.objects.get(slug=kwargs.get('event_slug'))</code></li>
<li class="executed"><code>        except Event.DoesNotExist:</code></li>
<li class="executed"><code>            raise Http404</code></li>
<li class="executed"><code>        self.kwargs = kwargs</code></li>
<li class="executed"><code>        self.object = self.get_object()</code></li>
<li class="executed"><code>        if (not request.user.is_staff and not self.object.user</code></li>
<li class="ignored"><code>                and not self.object.user == request.user):</code></li>
<li class="executed"><code>            raise Http404</code></li>
<li class="executed"><code>        return super(GuestViewMixin, self).dispatch(request, *args, **kwargs)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class GuestDeleteView(StaffMixin, GuestViewMixin, GuestSecurityMixin,</code></li>
<li class="ignored"><code>                      DeleteView):</code></li>
<li class="ignored"><code>    """Delete view to remove the relevant guest."""</code></li>
<li class="executed"><code>    pass</code></li>
  </ol>
</div>

<div class="nav">
  <a href="event_rsvp.models.html">event_rsvp.models</a> &lt;&lt;
  <a href="../index.html">index</a>
</div>

  </body>
</html>

