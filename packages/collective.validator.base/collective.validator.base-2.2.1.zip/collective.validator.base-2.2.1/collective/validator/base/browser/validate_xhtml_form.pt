<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="collective.validator.base">

<div metal:fill-slot="main"
     tal:define="xhtml view/getRightView;
                 p_ist python:context.portal_validationtool;
                 results python:p_ist.validatePage(xhtml);
                 val python:p_ist.getIntegratedType();
                 url python:p_ist.getValUrl();
                 validity python:results['m:validity'];
                 errors python:results['m:errors'];
                 errorcount python:errors['m:errorcount'];
                 errors python:errors['m:errorlist'];
                 warnings python:results['m:warnings'];
                 warningcount python:warnings['m:warningcount'];
                 warnings python:warnings['m:warninglist'];
     ">
<div>

    <h2 i18n:translate="valid_form_title">Validation form (redirect to W3C site)</h2>
    

    <form action="" tal:attributes="action url" 
          method="post"
          id="form_validate"
          >
        <fieldset>
           <legend i18n:translate="legend_validate">Validate code on W3C site</legend>
           <p>
              <span i18n:translate="validate_instructions">Click on this button to validate the code of the object: "</span>
              <strong tal:content="python:context.Title()"/> " (<span tal:content="context/portal_type"/>).
           </p>
           <input type="hidden" name="fragment" value="" tal:attributes="value xhtml;"/>
           <input type="hidden" name="doctype" value="" tal:attributes="value val;"/>

           <input i18n:attributes="value submit_button_value;title submit_button_title" title="Validate code (you'll be redirect to W3C site)" type="submit" class="context" value="Validate"/>
        </fieldset>
    </form>
</div>

<div>
    <h2 i18n:translate="valid_results_title">Validation results</h2>
    <p tal:condition="validity">
    <span i18n:translate="code_valid">Code <b>valid</b> for </span><span tal:content="val"/>
    </p>
    <div tal:condition="not:validity">
        <p>
        <span i18n:translate="code_not_valid">Code <b>NOT valid</b> for</span> <span tal:content="val"/>
        </p>

        <tal:condition condition="errors">
            <h3 i18n:translate="errors">Errors</h3>
                <ol>
                   <tal:errors repeat="error errors">
                       <li tal:define="line python:error['m:line'];
                                       col python:error['m:col'];
                                       message python:error['m:message']">
                           <b i18n:translate="row">Row:</b> <i><span tal:content="line"/></i><br/>
                           <b i18n:translate="column">Column:</b> <i><span tal:content="col"/></i><br/>
                           <b i18n:translate="message">Message:</b> <i><span tal:content="structure message"/></i>
                      </li>
                   </tal:errors>  
                </ol>
        </tal:condition>
        <tal:condition condition="warnings">
            <h3 i18n:translate="warnings">Warnings</h3>
                <ol>
                    <tal:warnings repeat="warning warnings">
                        <li tal:define="line python:warning['m:line'];
                                    col python:warning['m:col'];
                                    message python:warning['m:message']">
                           <b i18n:translate="row">Row:</b> <i><span tal:content="line"/></i><br/>
                           <b i18n:translate="column">Column:</b> <i><span tal:content="col"/></i><br/>
                           <b i18n:translate="message">Message:</b> <i><span tal:content="structure message"/></i>
                        </li>
                    </tal:warnings>
                </ol>
        </tal:condition>
    </div>
</div>

<tal:comment replace="nothing">
   Prima al caricamento della pagina redirigevo automaticamente l'utente nella pagina
   dei risultati del w3c. Ora invece effettuo una chiamata remota e presento i risultati, in locale.
   <script type="text/javascript" onload="this()">
       <!--
           var my_form = document.getElementById("form_validate")
           my_form.submit()
       -->
   </script>
</tal:comment>

</div>
</html>
