<div class="cthumb-widget" i18n:domain="ztfy.file">
	<div class="current-value" tal:define="value view/current_value;"
							   tal:condition="value">
		<tal:var define="img_size value/getImageSize;
						 img_width python:img_width[0];
						 img_height python:img_height[0];
						 adapter view/adapter;
						 thumb_size python:adapter and adapter.getDisplaySize('thumb') or (32,32);
						 thumb_width python:thumb_size[0];
						 thumb_height python:thumb_size[1];
						 geometry view/geometry;
						 left python:geometry and geometry.position[0] or 0;
						 top python:geometry and geometry.position[1] or 0;
						 width python:geometry and geometry.size[0] or 32;
						 height python:geometry and geometry.size[1] or 32;">
			<input type="hidden" tal:attributes="name string:${view/name}__x; value left;" />
			<input type="hidden" tal:attributes="name string:${view/name}__y; value top;" />
			<input type="hidden" tal:attributes="name string:${view/name}__w; value width;" />
			<input type="hidden" tal:attributes="name string:${view/name}__h; value height;" />
			<div>
				<span i18n:translate="">Current content:</span> <span tal:content="value/contentType" /> &nbsp;&ndash;&nbsp;
				<span tal:content="python:'%d x %d' % (img_width,img_height)" /> px &nbsp;&ndash;&nbsp;
				<span tal:content="python:value.getSize() / 1024" /> <span i18n:translate="">Kb</span>
			</div>
			<div class="download-link">
				<img class="thumb" tal:define="display value/++display++thumb"
								   tal:attributes="src display/@@absolute_url;
												   name view/name;" />&nbsp;&nbsp;&nbsp;
				<a target="_blank" tal:attributes="href value/@@absolute_url" alt="" title="Download original image" i18n:attributes="title"
				   tal:omit-tag="not:view/downloadable">
					<img class="cthumb" tal:define="display value/++display++cthumb"
										tal:attributes="src display/@@absolute_url;" />
				</a>
				<script type="text/javascript" tal:content="string:
					$$(document).ready(function() {
						$$('IMG.thumb[name=${view/name}]').imgAreaSelect({
							parent: $$('IMG.thumb[name=${view/name}]').parent('DIV.download-link'),
							position: 'relative',
							aspectRatio: '1:1',
							handles: true,
							persistent: false,
							imageWidth: ${thumb_width},
							imageHeight: ${thumb_height},
							minWidth: 30,
							maxWidth: ${thumb_width},
							minHeight: 30,
							maxHeight: ${thumb_height},
							x1: ${left},
							y1: ${top},
							x2: Math.min(${left}+Math.max(${width},30),${thumb_width}),
							y2: Math.min(${top}+Math.max(${height},30),${thumb_height}),
							onSelectEnd: $$.ZTFY.file.cthumb.endSelect
						});
					});
				"></script>
			</div>
		</tal:var>
	</div>
	<div class="delete-value" tal:condition="view/deletable">
		<input type="checkbox" value="on"
			   tal:attributes="id string:${view/name}__delete_input;
							   name string:${view/name}__delete" />
		<label for=""
			   tal:attributes="for string:${view/name}__delete_input" i18n:translate="">Delete current content</label>
	</div>
	<input type="file" id="" name="" class="" title="" lang="" disabled=""
		   readonly="" alt="" tabindex="" accesskey="" size="" maxlength=""
		   tal:attributes="id view/id;
						   name view/name;
						   class view/klass;
						   style view/style;
						   title view/title;
						   lang view/lang;
						   onclick view/onclick;
						   ondblclick view/ondblclick;
						   onmousedown view/onmousedown;
						   onmouseup view/onmouseup;
						   onmouseover view/onmouseover;
						   onmousemove view/onmousemove;
						   onmouseout view/onmouseout;
						   onkeypress view/onkeypress;
						   onkeydown view/onkeydown;
						   onkeyup view/onkeyup;
						   disabled view/disabled;
						   tabindex view/tabindex;
						   onfocus view/onfocus;
						   onblur view/onblur;
						   onchange view/onchange;
						   readonly view/readonly;
						   alt view/alt;
						   accesskey view/accesskey;
						   onselect view/onselect;
						   size view/size;
						   maxlength view/maxlength" />
</div>