<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Write a robot test for an existing Plone add-on &mdash; plone.app.robotframework 1.0a1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="plone.app.robotframework 1.0a1 documentation" href="index.html" />
    <link rel="next" title="Learn more robot" href="robot.html" />
    <link rel="prev" title="Write a robot test for a new Plone add-on" href="templer.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="robot.html" title="Learn more robot"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="templer.html" title="Write a robot test for a new Plone add-on"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">plone.app.robotframework 1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="write-a-robot-test-for-an-existing-plone-add-on">
<h1>Write a robot test for an existing Plone add-on<a class="headerlink" href="#write-a-robot-test-for-an-existing-plone-add-on" title="Permalink to this headline">¶</a></h1>
<p>This is a tutorial for getting started with writing functional Selenium tests
for an existing Plone add-on with Robot Framework.</p>
<p>Let&#8217;s assumpt that we have an add-on <strong>my.product</strong>.</p>
<div class="section" id="update-requirements">
<h2>Update requirements<a class="headerlink" href="#update-requirements" title="Permalink to this headline">¶</a></h2>
<p>At first, we need to fix our product to require all the necessary dependencies
for running Robot Framework tests.</p>
<p>To fix our dependencies, we update <tt class="docutils literal"><span class="pre">my.product/setup.py</span></tt> with:</p>
<div class="highlight-python"><pre>extras_require={'test': ['plone.app.testing[robot]]},</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When testing with Plone version less than 4.3, we must pin
the version of <strong>plone.app.testing</strong> into <tt class="docutils literal"><span class="pre">buildout.cfg</span></tt>.</p>
<p>Update <tt class="docutils literal"><span class="pre">my.product/buildout.cfg</span></tt> with:</p>
<div class="highlight-python"><pre>[buildout]
extends =
    ...
    versions.cfg</pre>
</div>
<p>And create <tt class="docutils literal"><span class="pre">my.product/versions.cfg</span></tt> with:</p>
<div class="last highlight-python"><pre>[versions]
plone.app.versions = 4.2.2</pre>
</div>
</div>
</div>
<div class="section" id="bootstrap-and-run-buildout">
<h2>Bootstrap and run buildout<a class="headerlink" href="#bootstrap-and-run-buildout" title="Permalink to this headline">¶</a></h2>
<p>Before we continue, now is a good time to run bootstrap and buildout to get the
development environment ready:</p>
<div class="highlight-python"><pre>$ python bootstrap.py --distribute
$ bin/buildout</pre>
</div>
</div>
<div class="section" id="define-functional-test-fixture">
<h2>Define functional test fixture<a class="headerlink" href="#define-functional-test-fixture" title="Permalink to this headline">¶</a></h2>
<p>Functional Selenium tests require a fully functional Plone-environment.</p>
<p>Luckily, with
<a class="reference external" href="http://pypi.python.org/pypi/plone.app.testing/">plone.app.testing</a>
we can easily define a custom test fixture with Plone and our own add-on
installed.</p>
<p>After the base fixture has been created (by following
<a class="reference external" href="http://pypi.python.org/pypi/plone.app.testing/">plone.app.testing</a>
documentation) we only need to define a functional testing fixture, which adds
a fully functional ZServer to serve a Plone sandbox with our add-on.</p>
<p>Update <tt class="docutils literal"><span class="pre">my.product/src/my/product/testing.py</span></tt> with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.app.testing</span> <span class="kn">import</span> <span class="n">FunctionalTesting</span>


<span class="n">MY_PRODUCT_FUNCTIONAL_TESTING</span> <span class="o">=</span> <span class="n">FunctionalTesting</span><span class="p">(</span>
    <span class="n">bases</span><span class="o">=</span><span class="p">(</span><span class="n">MY_PRODUCT_FIXTURE</span><span class="p">,</span> <span class="n">z2</span><span class="o">.</span><span class="n">ZSERVER_FIXTURE</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;MyproductLayer:Functional&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-robot-test-suite">
<h2>Create a robot test suite<a class="headerlink" href="#create-a-robot-test-suite" title="Permalink to this headline">¶</a></h2>
<p>Robot tests are written as text files, which are called test suites.</p>
<p>It&#8217;s good practice, with Plone, to prefix all robot test suite files with
<tt class="docutils literal"><span class="pre">robot_</span></tt>. This makes it easier to both exclude the robot tests (which are
usually very time consuming) from test runs or run only the robot tests.</p>
<p>Write a simple robot tests suite
<tt class="docutils literal"><span class="pre">my.product/src/my/product/tests/robot_hello.txt</span></tt>:</p>
<div class="highlight-python"><pre>*** Settings ***

Library  Selenium2Library  timeout=10  implicit_wait=0.5

Suite Setup  Start browser
Suite Teardown  Close All Browsers

*** Variables ***

${BROWSER} =  Firefox

*** Test Cases ***

Hello World
    [Tags]  hello
    Go to  http://localhost:55001/plone/hello-world
    Page should contain  Hello World!

*** Keywords ***

Start browser
    Open browser  http://localhost:55001/plone/  browser=${BROWSER}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Defining browser for <tt class="docutils literal"><span class="pre">Open</span> <span class="pre">browser</span></tt> keyword as a variable makes it easy to
run the test later with different browser.</p>
</div>
</div>
<div class="section" id="register-the-suite-for-zope-testrunner">
<h2>Register the suite for zope.testrunner<a class="headerlink" href="#register-the-suite-for-zope-testrunner" title="Permalink to this headline">¶</a></h2>
<p>To be able to run Robot Framework test suite with
<a class="reference external" href="http://pypi.python.org/pypi/zope.testrunner/">zope.testrunner</a>
and on top of our add-ons functional test fixture, we need to</p>
<ol class="arabic simple">
<li>wrap the test suite into properly named Python unittest test suite</li>
<li>assign our functional test layer for all the test cases.</li>
</ol>
<p>We do this all by simply writing
<tt class="docutils literal"><span class="pre">my.product/src/my/product/tests/test_robot.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">my.product.testing</span> <span class="kn">import</span> <span class="n">MY_PRODUCT_FUNCTIONAL_TESTING</span>
<span class="kn">from</span> <span class="nn">plone.testing</span> <span class="kn">import</span> <span class="n">layered</span>
<span class="kn">import</span> <span class="nn">robotsuite</span>
<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">def</span> <span class="nf">test_suite</span><span class="p">():</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTests</span><span class="p">([</span>
        <span class="n">layered</span><span class="p">(</span><span class="n">robotsuite</span><span class="o">.</span><span class="n">RobotTestSuite</span><span class="p">(</span><span class="s">&quot;robot_hello_world.txt&quot;</span><span class="p">),</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">MY_PRODUCT_FUNCTIONAL_TESTING</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="k">return</span> <span class="n">suite</span>
</pre></div>
</div>
<p>Note that <tt class="docutils literal"><span class="pre">test_</span></tt>-prefix in the filename of <tt class="docutils literal"><span class="pre">test_robot.py</span></tt> is required for
<strong>zope.testunner</strong> to find the test suite.</p>
</div>
<div class="section" id="list-and-filter-tests">
<h2>List and filter tests<a class="headerlink" href="#list-and-filter-tests" title="Permalink to this headline">¶</a></h2>
<p>Run <tt class="docutils literal"><span class="pre">bin/test</span></tt> (<strong>zope.testrunner</strong>) with <tt class="docutils literal"><span class="pre">--list-tests</span></tt>-argument to
see that our test is registered correctly:</p>
<div class="highlight-python"><pre>$ bin/test --list-tests
Listing my.product.testing.MyproductLayer:Functional tests:
  Hello_World (robot_hello_world.txt) #hello
Listing my.product.testing.MyproductLayer:Integration tests:
  ...</pre>
</div>
<p>Experiment with <tt class="docutils literal"><span class="pre">-t</span></tt>-argument to filter testrunner to find only our
robot test:</p>
<div class="highlight-python"><pre>$ bin/test -t robot_ --list-tests
Listing my.product.testing.MyproductLayer:Functional tests:
  Hello_World (robot_hello_world.txt) #hello</pre>
</div>
<p>or everything else:</p>
<div class="highlight-python"><pre>$ bin/test -t \!robot_ --list-tests
Listing my.product.testing.MyproductLayer:Integration tests:
  ...</pre>
</div>
<p>We can also filter robot tests with tags:</p>
<div class="highlight-python"><pre>$ bin/test -t \#hello --list-tests
Listing my.product.testing.MyproductLayer:Functional tests:
  Hello_World (robot_hello_world.txt) #hello</pre>
</div>
</div>
<div class="section" id="run-failing-test">
<h2>Run (failing) test<a class="headerlink" href="#run-failing-test" title="Permalink to this headline">¶</a></h2>
<p>After the test has been written and registered, it can be run normally
with <tt class="docutils literal"><span class="pre">bin/test</span></tt>.</p>
<p>The run will fail, because the test describes an unimplemented feature:</p>
<div class="highlight-python"><pre>$ bin/test -t robot_

Running my.product.testing.MyproductLayer:Functional tests:
  Set up plone.testing.zca.LayerCleanup in 0.000 seconds.
  Set up plone.testing.z2.Startup in 0.217 seconds.
  Set up plone.app.testing.layers.PloneFixture in 7.643 seconds.
  Set up my.product.testing.MyproductLayer in 0.026 seconds.
  Set up plone.testing.z2.ZServer in 0.503 seconds.
  Set up my.product.testing.MyproductLayer:Functional in 0.000 seconds.
  Running:
    1/1 (100.0%)
==============================================================================
Robot Hello World
==============================================================================
Hello World                                                           | FAIL |
Page should have contained text 'Hello World!' but did not
------------------------------------------------------------------------------
Robot Hello World                                                     | FAIL |
1 critical test, 0 passed, 1 failed
1 test total, 0 passed, 1 failed
==============================================================================
Output:  /.../my.product/parts/test/robot_hello_world/Hello_World/output.xml
Log:     /.../my.product/parts/test/robot_hello_world/Hello_World/log.html
Report:  /.../my.product/parts/test/robot_hello_world/Hello_World/report.html



Failure in test Hello World (robot_hello_world.txt) #hello
Traceback (most recent call last):
  File "/.../unittest2-0.5.1-py2.7.egg/unittest2/case.py", line 340, in run
    testMethod()
  File "/.../eggs/robotsuite-1.0.2-py2.7.egg/robotsuite/__init__.py", line 317, in runTest
    assert last_status == 'PASS', last_message
AssertionError: Page should have contained text 'Hello World!' but did not


  Ran 1 tests with 1 failures and 0 errors in 3.632 seconds.
Tearing down left over layers:
  Tear down my.product.testing.MyproductLayer:Functional in 0.000 seconds.
  Tear down plone.testing.z2.ZServer in 5.282 seconds.
  Tear down my.product.testing.MyproductLayer in 0.003 seconds.
  Tear down plone.app.testing.layers.PloneFixture in 0.084 seconds.
  Tear down plone.testing.z2.Startup in 0.006 seconds.
  Tear down plone.testing.zca.LayerCleanup in 0.004 seconds.</pre>
</div>
</div>
<div class="section" id="create-an-example-view">
<h2>Create an example view<a class="headerlink" href="#create-an-example-view" title="Permalink to this headline">¶</a></h2>
<p>Create view described in the test by registering a template into
<tt class="docutils literal"><span class="pre">my.product/src/my/product/configure.zcml</span></tt>:</p>
<div class="highlight-python"><pre>&lt;configure
    xmlns="http://namespaces.zope.org/zope"
    xmlns:five="http://namespaces.zope.org/five"
    xmlns:browser="http://namespaces.zope.org/browser"
    xmlns:i18n="http://namespaces.zope.org/i18n"
    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"
    i18n_domain="my.product"&gt;

  ...

  &lt;browser:page
      name="hello-world"
      for="Products.CMFCore.interfaces.ISiteRoot"
      template="hello_world.pt"
      permission="zope2.View"
      /&gt;

  ...

&lt;/configure&gt;</pre>
</div>
<p>And writing the template into <tt class="docutils literal"><span class="pre">my.product/src/my/product/hello_world.pt</span></tt>:</p>
<div class="highlight-python"><pre>&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone"&gt;
&lt;body&gt;

&lt;metal:content-core fill-slot="content-core"&gt;
    &lt;metal:content-core define-macro="content-core"&gt;
      &lt;p&gt;Hello World!&lt;/p&gt;
    &lt;/metal:content-core&gt;
&lt;/metal:content-core&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
</div>
<div class="section" id="run-passing-test">
<h2>Run (passing) test<a class="headerlink" href="#run-passing-test" title="Permalink to this headline">¶</a></h2>
<p>Re-run the test to see it passing:</p>
<div class="highlight-python"><pre>$ bin/test -t robot_
Running my.product.testing.MyproductLayer:Functional tests:
  Set up plone.testing.zca.LayerCleanup in 0.000 seconds.
  Set up plone.testing.z2.Startup in 0.220 seconds.
  Set up plone.app.testing.layers.PloneFixture in 7.810 seconds.
  Set up my.product.testing.MyproductLayer in 0.027 seconds.
  Set up plone.testing.z2.ZServer in 0.503 seconds.
  Set up my.product.testing.MyproductLayer:Functional in 0.000 seconds.
  Running:

  Ran 1 tests with 0 failures and 0 errors in 2.604 seconds.
Tearing down left over layers:
  Tear down my.product.testing.MyproductLayer:Functional in 0.000 seconds.
  Tear down plone.testing.z2.ZServer in 5.253 seconds.
  Tear down my.product.testing.MyproductLayer in 0.004 seconds.
  Tear down plone.app.testing.layers.PloneFixture in 0.085 seconds.
  Tear down plone.testing.z2.Startup in 0.006 seconds.
  Tear down plone.testing.zca.LayerCleanup in 0.004 seconds.</pre>
</div>
</div>
<div class="section" id="test-reports">
<h2>Test reports<a class="headerlink" href="#test-reports" title="Permalink to this headline">¶</a></h2>
<p>Robot Framework generates high quality test reports with screenshots of
failing tests as:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">my.product/parts/tests/robot_report.html</span></tt></dt>
<dd>Overview of the test results.</dd>
<dt><tt class="docutils literal"><span class="pre">my.product/parts/tests/robot_log.html</span></tt>:</dt>
<dd>Detailed log for every test with screenshots of failing tests.</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Write a robot test for an existing Plone add-on</a><ul>
<li><a class="reference internal" href="#update-requirements">Update requirements</a></li>
<li><a class="reference internal" href="#bootstrap-and-run-buildout">Bootstrap and run buildout</a></li>
<li><a class="reference internal" href="#define-functional-test-fixture">Define functional test fixture</a></li>
<li><a class="reference internal" href="#create-a-robot-test-suite">Create a robot test suite</a></li>
<li><a class="reference internal" href="#register-the-suite-for-zope-testrunner">Register the suite for zope.testrunner</a></li>
<li><a class="reference internal" href="#list-and-filter-tests">List and filter tests</a></li>
<li><a class="reference internal" href="#run-failing-test">Run (failing) test</a></li>
<li><a class="reference internal" href="#create-an-example-view">Create an example view</a></li>
<li><a class="reference internal" href="#run-passing-test">Run (passing) test</a></li>
<li><a class="reference internal" href="#test-reports">Test reports</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="templer.html"
                        title="previous chapter">Write a robot test for a new Plone add-on</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="robot.html"
                        title="next chapter">Learn more robot</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="robot.html" title="Learn more robot"
             >next</a> |</li>
        <li class="right" >
          <a href="templer.html" title="Write a robot test for a new Plone add-on"
             >previous</a> |</li>
        <li><a href="index.html">plone.app.robotframework 1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Plone Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>