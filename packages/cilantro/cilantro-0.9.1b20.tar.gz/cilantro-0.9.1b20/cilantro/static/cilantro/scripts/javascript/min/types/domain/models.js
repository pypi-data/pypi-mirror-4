var __hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__bind=function(a,b){return function(){return a.apply(b,arguments)}};define(["underscore","backbone","common/models/state","cilantro/types/domain/views"],function(a,b,c,d){var e,f,g,h;return e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(c.Model),f=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return __extends(c,b),c.prototype.model=e,c.prototype.url=App.endpoints.domains,c.prototype.initialize=function(){var a=this;return this.bind("active",this.activate),this.bind("inactive",this.inactivate),App.hub.subscribe("domain/request",function(b){var c,d;return c=a.get(b),c?c.activate():(d=a.subdomains.get(b),c=a.get(d.get("parent").id),c.activate(),d.activate())})},c.prototype.comparator=function(a){return a.get("order")},c.prototype.parse=function(b,c){var e,f,g,i,j;f=a.groupBy(b,function(a){var b;return((b=a["parent"])!=null?b.id:void 0)||null}),this.subdomains=new h,new d.SubdomainCollectionView({collection:this.subdomains}),e=f["null"],delete f["null"],j=a.flatten(a.values(f));for(i in f)g=parseInt(i),j.push({id:g,name:"All",parent:{id:g}});return this.subdomains.reset(j),e},c.prototype.activate=function(a){return App.hub.publish("domain/active",a.id),this.chain().without(a).map(function(a){return a.inactivate()})},c.prototype.inactivate=function(a){return App.hub.publish("domain/inactive",a.id)},c}(b.Collection),g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(e),h=function(b){function c(){return this.toggleEnableByDomain=__bind(this.toggleEnableByDomain,this),c.__super__.constructor.apply(this,arguments)}return __extends(c,b),c.prototype.model=g,c.prototype.initialize=function(){return App.hub.subscribe("domain/active",this.toggleEnableByDomain),this.bind("reset",this.groupByDomain),this.bind("active",this.activate),this.bind("inactive",this.inactivate)},c.prototype.comparator=function(a){return a.get("order")},c.prototype.groupByDomain=function(){return this._byDomain=this.groupBy(function(a){return a.get("parent").id})},c.prototype.toggleEnableByDomain=function(a){var b,c=this;b=!1,this.map(function(c){if(c.get("parent").id!==a)return c.disable();c.enable({reactivate:!0});if(c.isActive())return b=!0});if(!b&&this._byDomain[a])return this.get(a).activate()},c.prototype.activate=function(b){return App.hub.publish("subdomain/active",b.id),a(this._byDomain[b.get("parent").id]).without(b).map(function(a){return a.inactivate()})},c.prototype.inactivate=function(a){return App.hub.publish("subdomain/inactive",a.id)},c}(f),{Model:e,Collection:f}})