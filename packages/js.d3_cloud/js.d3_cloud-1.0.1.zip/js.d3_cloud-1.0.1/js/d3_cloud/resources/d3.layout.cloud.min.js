(function(x){function g(){var L=[256,256],J=r,z=s,K=b,C=k,H=k,D=t,I=n,E=u,G=[],F=Infinity,c=d3.dispatch("word","end"),y=null,A={};A.start=function(){var O=m((L[0]>>5)*L[1]),Q=null,S=G.length,N=-1,M=[],R=G.map(function(U,T){return{text:J.call(this,U,T),font:z.call(this,U,T),style:C.call(this,U,T),weight:H.call(this,U,T),rotate:D.call(this,U,T),size:~~K.call(this,U,T),padding:n.call(this,U,T)}}).sort(function(U,T){return T.size-U.size});if(y){clearInterval(y)}y=setInterval(P,0);P();return A;function P(){var U=+new Date,T;while(+new Date-U<F&&++N<S&&y){T=R[N];T.x=(L[0]*(Math.random()+0.5))>>1;T.y=(L[1]*(Math.random()+0.5))>>1;q(T,R,N);if(B(O,T,Q)){M.push(T);c.word(T);if(Q){i(Q,T)}else{Q=[{x:T.x+T.x0,y:T.y+T.y0},{x:T.x+T.x1,y:T.y+T.y1}]}T.x-=L[0]>>1;T.y-=L[1]>>1}}if(N>=S){A.stop();c.end(M,Q)}}};A.stop=function(){if(y){clearInterval(y);y=null}return A};A.timeInterval=function(M){if(!arguments.length){return F}F=M==null?Infinity:M;return A};function B(Q,aj,P){var N=[{x:0,y:0},{x:L[0],y:L[1]}],ah=aj.x,ag=aj.y,M=Math.sqrt(L[0]*L[0]+L[1]*L[1]),X=E(L),Y=Math.random()<0.5?1:-1,W=-Y,ad,V,T;while(ad=X(W+=Y)){V=~~ad[0];T=~~ad[1];if(Math.min(V,T)>M){break}aj.x=ah+V;aj.y=ag+T;if(aj.x+aj.x0<0||aj.y+aj.y0<0||aj.x+aj.x1>L[0]||aj.y+aj.y1>L[1]){continue}if(!P||!j(aj,Q,L[0])){if(!P||f(aj,P)){var ab=aj.sprite,U=aj.width>>5,aa=L[0]>>5,O=aj.x-(U<<4),Z=O&127,ai=32-Z,af=aj.y1-aj.y0,S=(aj.y+aj.y0)*aa+(O>>5),R;for(var ac=0;ac<af;ac++){R=0;for(var ae=0;ae<=U;ae++){Q[S+ae]|=(R<<ai)|(ae<U?(R=ab[ac*U+ae])>>>Z:0)}S+=aa}delete aj.sprite;return true}}}return false}A.words=function(M){if(!arguments.length){return G}G=M;return A};A.size=function(M){if(!arguments.length){return L}L=[+M[0],+M[1]];return A};A.font=function(M){if(!arguments.length){return z}z=d3.functor(M);return A};A.fontStyle=function(M){if(!arguments.length){return C}C=d3.functor(M);return A};A.fontWeight=function(M){if(!arguments.length){return H}H=d3.functor(M);return A};A.rotate=function(M){if(!arguments.length){return D}D=d3.functor(M);return A};A.text=function(M){if(!arguments.length){return J}J=d3.functor(M);return A};A.spiral=function(M){if(!arguments.length){return E}E=a[M+""]||M;return A};A.fontSize=function(M){if(!arguments.length){return K}K=d3.functor(M);return A};A.padding=function(M){if(!arguments.length){return I}I=d3.functor(M);return A};return d3.rebind(A,c,"on")}function r(c){return c.text}function s(){return"serif"}function k(){return"normal"}function b(c){return Math.sqrt(c.value)}function t(){return(~~(Math.random()*6)-3)*30}function n(){return 1}function q(V,W,T){if(V.sprite){return}v.clearRect(0,0,(e<<5)/h,l/h);var E=0,D=0,G=0,L=W.length;T--;while(++T<L){V=W[T];v.save();v.font=V.style+" "+V.weight+" "+~~((V.size+1)/h)+"px "+V.font;var F=v.measureText(V.text+"m").width*h,S=V.size<<1;if(V.rotate){var O=Math.sin(V.rotate*w),C=Math.cos(V.rotate*w),z=F*C,H=F*O,U=S*C,B=S*O;F=(Math.max(Math.abs(z+B),Math.abs(z-B))+31)>>5<<5;S=~~Math.max(Math.abs(H+U),Math.abs(H-U))}else{F=(F+31)>>5<<5}if(S>G){G=S}if(E+F>=(e<<5)){E=0;D+=G;G=0}if(D+S>=l){break}v.translate((E+(F>>1))/h,(D+(S>>1))/h);if(V.rotate){v.rotate(V.rotate*w)}v.fillText(V.text,0,0);v.restore();V.width=F;V.height=S;V.xoff=E;V.yoff=D;V.x1=F>>1;V.y1=S>>1;V.x0=-V.x1;V.y0=-V.y1;E+=F}var I=v.getImageData(0,0,(e<<5)/h,l/h).data,K=[];while(--T>=0){V=W[T];var F=V.width,A=F>>5,S=V.y1-V.y0,J=V.padding;for(var R=0;R<S*A;R++){K[R]=0}E=V.xoff;if(E==null){return}D=V.yoff;var c=0,Q=-1;for(var P=0;P<S;P++){for(var R=0;R<F;R++){var N=A*P+(R>>5),M=I[((D+P)*(e<<5)+(E+R))<<2]?1<<(31-(R%32)):0;if(J){if(P){K[N-A]|=M}if(P<F-1){K[N+A]|=M}M|=(M<<1)|(M>>1)}K[N]|=M;c|=M}if(c){Q=P}else{V.y0++;S--;P--;D++}}V.y1=V.y0+Q;V.sprite=K.slice(0,(V.y1-V.y0)*A)}}function j(J,C,G){G>>=5;var I=J.sprite,F=J.width>>5,c=J.x-(F<<4),E=c&127,B=32-E,A=J.y1-J.y0,D=(J.y+J.y0)*G+(c>>5),H;for(var y=0;y<A;y++){H=0;for(var z=0;z<=F;z++){if(((H<<B)|(z<F?(H=I[y*F+z])>>>E:0))&C[D+z]){return true}}D+=G}return false}function i(z,A){var y=z[0],c=z[1];if(A.x+A.x0<y.x){y.x=A.x+A.x0}if(A.y+A.y0<y.y){y.y=A.y+A.y0}if(A.x+A.x1>c.x){c.x=A.x+A.x1}if(A.y+A.y1>c.y){c.y=A.y+A.y1}}function f(y,c){return y.x+y.x1>c[0].x&&y.x+y.x0<c[1].x&&y.y+y.y1>c[0].y&&y.y+y.y0<c[1].y}function u(c){var y=c[0]/c[1];return function(z){return[y*(z*=0.1)*Math.cos(z),z*Math.sin(z)]}}function p(B){var z=4,A=z*B[0]/B[1],c=0,C=0;return function(D){var y=D<0?-1:1;switch((Math.sqrt(1+4*y*D)-y)&3){case 0:c+=A;break;case 1:C+=z;break;case 2:c-=A;break;default:C-=z;break}return[c,C]}}function m(z){var c=[],y=-1;while(++y<z){c[y]=0}return c}var w=Math.PI/180,e=1<<11>>5,l=1<<11,d,h=1;if(typeof document!=="undefined"){d=document.createElement("canvas");d.width=1;d.height=1;h=Math.sqrt(d.getContext("2d").getImageData(0,0,1,1).data.length>>2);d.width=(e<<5)/h;d.height=l/h}else{var o=require("canvas");d=new o(e<<5,l)}var v=d.getContext("2d"),a={archimedean:u,rectangular:p};v.fillStyle="red";v.textAlign="center";x.cloud=g})(typeof exports==="undefined"?d3.layout||(d3.layout={}):exports);