env:
  PATH: "${ROCK_PATH}/scripts:${ROCK_PATH}/bin:${ROCK_PATH}/venv/bin:${PATH}"
  PYTHONPATH: "${ROCK_PATH}:${PYTHONPATH}"
  ROCK_PIP_INSTALL: "install -r ./requirements.txt"
  ROCK_PIP_INSTALL_DEPLOYMENT: "--verbose install -r ./requirements.txt"
  ROCK_VIRTUALENV: "--distribute ./venv"
  ROCK_VIRTUALENV_DEPLOYMENT: "--verbose --distribute ./venv"

build: |

  if [[ ! -f ./venv/bin/activate ]]; then
    virtualenv ${ROCK_VIRTUALENV}
  fi

  if [[ -f ./requirements.txt ]]; then
    pip ${ROCK_PIP_INSTALL}
  else
    warn 'no "requirements.txt" file found'
  fi

build_deployment: |

  if [[ ! -f ./requirements.txt ]]; then
    die 'no "requirements.txt" file found'
  fi

  if [[ ! -f ./venv/bin/activate ]]; then
    virtualenv ${ROCK_VIRTUALENV_DEPLOYMENT}
  fi

  pip ${ROCK_PIP_INSTALL_DEPLOYMENT}

  virtualenv --relocatable ./venv

test: |

  python -m unittest discover ./tests

clean: |

  if [[ -d ./venv ]]; then
    rm -fr ./venv
  fi
