env:
  PATH: "${PROJECT_PATH}/scripts:${PROJECT_PATH}/bin:${PROJECT_PATH}/venv/bin:${PATH}"
  BUILD_PATH: "${PROJECT_PATH}/venv"
  TEST_PATH: "${PROJECT_PATH}/tests"
  PYTHONPATH: "${PROJECT_PATH}:${PYTHONPATH}"
  ROCK_PIP_INSTALL: "install -r ./requirements.txt"
  ROCK_PIP_INSTALL_DEPLOYMENT: "--verbose install -r ./requirements.txt"
  ROCK_PYVENV: "\"${BUILD_PATH}\""
  ROCK_PYVENV_DEPLOYMENT: "\"${BUILD_PATH}\""

build: |

  if [[ ! -e "${BUILD_PATH}/bin/python" ]]; then
    pyvenv ${ROCK_PYVENV}
    distribute-setup
    rm -f distribute-*.gz
    easy_install pip
  fi

  if [[ -f ./requirements.txt ]]; then
    pip ${ROCK_PIP_INSTALL}
  else
    warn 'no "requirements.txt" file found'
  fi

build_deployment: |

  if [[ ! -f ./requirements.txt ]]; then
    die 'no "requirements.txt" file found'
  fi

  if [[ ! -e "${BUILD_PATH}/bin/python" ]]; then
    pyvenv ${ROCK_PYVENV_DEPLOYMENT}
    distribute-setup
    rm -f distribute-*.gz
    easy_install --verbose pip
  fi

  pip ${ROCK_PIP_INSTALL_DEPLOYMENT}

test: |

  python -m unittest discover "${TEST_PATH}"

clean: |

  if [[ -d "${BUILD_PATH}" ]]; then
    rm -fr "${BUILD_PATH}"
  fi
