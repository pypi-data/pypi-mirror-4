(function(a){a.fn.maskMoney=function(b){b=a.extend({symbol:"US$",showSymbol:false,symbolStay:false,thousands:",",decimal:".",precision:2,defaultZero:true,allowZero:false,allowNegative:false},b);return this.each(function(){var l=a(this);var d=false;function n(){d=true}function i(){d=false}function p(y){y=y||window.event;var s=y.charCode||y.keyCode||y.which;if(s==undefined){return false}if(l.attr("readonly")&&(s!=13&&s!=9)){return false}if(s<48||s>57){if(s==45){n();l.val(f(l));return false}else{if(s==43){n();l.val(l.val().replace("-",""));return false}else{if(s==13||s==9){if(d){i();a(this).change()}return true}else{if(s==37||s==39){return true}else{k(y);return true}}}}}else{if(l.val().length>=l.attr("maxlength")){return false}else{k(y);var v=String.fromCharCode(s);var r=l.get(0);var w=l.getInputSelection(r);var u=w.start;var t=w.end;r.value=r.value.substring(0,u)+v+r.value.substring(t,r.value.length);e(r,u+1);n();return false}}}function j(w){w=w||window.event;var s=w.charCode||w.keyCode||w.which;if(s==undefined){return false}if(l.attr("readonly")&&(s!=13&&s!=9)){return false}var r=l.get(0);var v=l.getInputSelection(r);var u=v.start;var t=v.end;if(s==8){k(w);if(u==t){r.value=r.value.substring(0,u-1)+r.value.substring(t,r.value.length);u=u-1}else{r.value=r.value.substring(0,u)+r.value.substring(t,r.value.length)}e(r,u);n();return false}else{if(s==9){if(d){a(this).change();i()}return true}else{if(s==46||s==63272){k(w);if(r.selectionStart==r.selectionEnd){r.value=r.value.substring(0,u)+r.value.substring(t+1,r.value.length)}else{r.value=r.value.substring(0,u)+r.value.substring(t,r.value.length)}e(r,u);n();return false}else{return true}}}}function m(t){var r=o();if(l.val()==r){l.val("")}else{if(l.val()==""&&b.defaultZero){l.val(c(r))}else{l.val(c(l.val()))}}if(this.createTextRange){var s=this.createTextRange();s.collapse(false);s.select()}}function h(r){if(a.browser.msie){p(r)}if(l.val()==""||l.val()==c(o())||l.val()==b.symbol){if(!b.allowZero){l.val("")}else{if(!b.symbolStay){l.val(o())}else{l.val(c(o()))}}}else{if(!b.symbolStay){l.val(l.val().replace(b.symbol,""))}else{if(b.symbolStay&&l.val()==b.symbol){l.val(c(o()))}}}}function k(r){if(r.preventDefault){r.preventDefault()}else{r.returnValue=false}}function e(r,t){var s=l.val().length;l.val(g(r.value));var u=l.val().length;t=t-(s-u);l.setCursorPosition(t)}function g(B){B=B.replace(b.symbol,"");var r="0123456789";var y=B.length;var A="",C="",w="";if(y!=0&&B.charAt(0)=="-"){B=B.replace("-","");if(b.allowNegative){w="-"}}if(y==0){if(!b.defaultZero){return C}C="0.00"}for(var x=0;x<y;x++){if((B.charAt(x)!="0")&&(B.charAt(x)!=b.decimal)){break}}for(;x<y;x++){if(r.indexOf(B.charAt(x))!=-1){A+=B.charAt(x)}}var u=parseFloat(A);u=isNaN(u)?0:u/Math.pow(10,b.precision);C=u.toFixed(b.precision);x=b.precision==0?0:1;var s,z=(C=C.split("."))[x].substr(0,b.precision);for(s=(C=C[0]).length;(s-=3)>=1;){C=C.substr(0,s)+b.thousands+C.substr(s)}return(b.precision>0)?c(w+C+b.decimal+z+Array((b.precision+1)-z.length).join(0)):c(w+C)}function q(){var r=l.val();l.val(g(r))}function o(){var r=parseFloat("0")/Math.pow(10,b.precision);return(r.toFixed(b.precision)).replace(new RegExp("\\.","g"),b.decimal)}function c(r){if(b.showSymbol){if(r.substr(0,b.symbol.length)!=b.symbol){return b.symbol+r}}return r}function f(s){if(b.allowNegative){var r=s.val();if(s.val()!=""&&s.val().charAt(0)=="-"){return s.val().replace("-","")}else{return"-"+s.val()}}else{return s.val()}}l.bind("keypress.maskMoney",p);l.bind("keydown.maskMoney",j);l.bind("blur.maskMoney",h);l.bind("focus.maskMoney",m);l.bind("mask",q);l.one("unmaskMoney",function(){l.unbind(".maskMoney");if(a.browser.msie){this.onpaste=null}else{if(a.browser.mozilla){this.removeEventListener("input",h,false)}}})})};a.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")};a.fn.mask=function(){return this.trigger("mask")};a.fn.setCursorPosition=function(b){this.each(function(d,e){if(e.setSelectionRange){e.focus();e.setSelectionRange(b,b)}else{if(e.createTextRange){var c=e.createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",b);c.select()}}});return this};a.fn.getInputSelection=function(f){var i=0,d=0,h,e,c,b,g;if(typeof f.selectionStart=="number"&&typeof f.selectionEnd=="number"){i=f.selectionStart;d=f.selectionEnd}else{e=document.selection.createRange();if(e&&e.parentElement()==f){b=f.value.length;h=f.value.replace(/\r\n/g,"\n");c=f.createTextRange();c.moveToBookmark(e.getBookmark());g=f.createTextRange();g.collapse(false);if(c.compareEndPoints("StartToEnd",g)>-1){i=d=b}else{i=-c.moveStart("character",-b);i+=h.slice(0,i).split("\n").length-1;if(c.compareEndPoints("EndToEnd",g)>-1){d=b}else{d=-c.moveEnd("character",-b);d+=h.slice(0,d).split("\n").length-1}}}}return{start:i,end:d}}})(jQuery);