<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:slot fill-slot="javascript_head_slot">
    <script language="javascript" type="text/javascript">
        jq(function() {
            jq("a.fancybox").fancybox(

              {
                  cyclic: 'true',
                  titlePosition: 'inside',
              }

            );

            // Vertical alignment for previewimages:

            jq(".preview img").each( function() {
                var iHeight = jq(this).height();
                var heightDiff = 128 - iHeight;             // 128px is max height for image_thumb
                var halfHeightDiff = heightDiff/2;
                jq(this).css('position','relative');
                jq(this).css('left','0');
                jq(this).css('top',halfHeightDiff+'px');
            });



            // Show arrow-down in title-box, if title is longer than one line or desc exists:

            jq(".title span").each( function() {

                var text = jq(this).text();
                var charAmount = text.length;
                if (charAmount>20 || jq(this).siblings(".desc").text().length != 0 ) {
                    //jq(this).parent(".title").css('border-bottom','3px solid #e6e6e6');
                    var arrowdown = document.createElement('div');
                    jq(arrowdown).prependTo(jq(this).parent(".title")).text('\u25BC').css('float','right').css('color','#82878c');
                }
            
            
            });


        });
    </script>
</metal:slot>
<body>
    <div metal:fill-slot="main">
    <metal:main-macro define-macro="main"
                      tal:define="kssClassesView context/@@kss_field_decorator_view;
                                  getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                                  templateId template/getId">

        <div tal:replace="structure provider:plone.abovecontenttitle" />
        <h1 metal:use-macro="here/kss_generic_macros/macros/generic_title_view">
            Title or id
        </h1>
        <div tal:replace="structure provider:plone.belowcontenttitle" />

        <p metal:use-macro="here/kss_generic_macros/macros/generic_description_view">
            Description
        </p>

        <div tal:replace="structure provider:plone.abovecontentbody" />

        <div metal:define-macro="text-field-view"
             id="parent-fieldname-text" class="stx"
             tal:define="kss_class python:getKssClasses('text',
                         templateId=templateId, macro='text-field-view');
                         has_text exists:context/aq_base/getText;
                         text python:has_text and here.getText() or '';
                         "
             tal:condition="text">
             <div metal:define-slot="inside" tal:replace="structure text">
                The body
             </div>
        </div>

        <div metal:define-macro="adi_gal_contentarea" >
          <div id="adi_fancybox_wrapper">
            <metal:listingmacro define-macro="listing">
              <tal:foldercontents define="contentFilter contentFilter|request/contentFilter|nothing;
                                  limit_display limit_display|request/limit_display|nothing;
                                  more_url more_url|request/more_url|string:folder_contents;
                                  folderContents python:here.portal_type=='Topic' and here.queryCatalog(contentFilter, batch=True) or here.getFolderContents(contentFilter, batch=True, b_size=limit_display or 100);
                                  use_view_action site_properties/typesUseViewActionInListings|python:();
                                  over_limit python: limit_display and len(folderContents) > limit_display;
                                  folderContents python: (over_limit and folderContents[:limit_display]) or folderContents;
                                  batch folderContents">
                <tal:listing condition="folderContents">
                    <tal:block tal:repeat="item folderContents">
                        <div class="tileItem visualIEFloatFix vevent" 
                             tal:define="item_url item/getURL|item/absolute_url;
                                               item_id item/getId|item/id;
                                               item_title_or_id item/pretty_title_or_id;
                                               item_description item/Description;
                                               item_type item/portal_type;
                                               item_type_lowercase python:item_type.lower().replace(' ', '_');
                                               item_type_title item/Type;
                                               item_modified item/ModificationDate;
                                               item_created item/CreationDate;
                                               item_wf_state item/review_state|python: wtool.getInfoFor(item, 'review_state', '');
                                               item_creator item/Creator;
                                               item_start item/start/ISO|item/StartDate|nothing;
                                               item_end item/end/ISO|item/EndDate|nothing;
                                               item_object item/getObject;
                                               item_remote_url item/getRemoteUrl;
                                               parent_title python:context.aq_parent.pretty_title_or_id;
                                               parent_desc python:context.aq_parent.Description;
                                               portal context/@@plone_portal_state/portal;
                                               portal_url portal/absolute_url;
                                               portal_title portal/pretty_title_or_id;
                                               portal_desc portal/Description;
                                               item_has_leadimage item/hasContentLeadImage;
                                           ">

<div class="adiGalItem">

    <tal:comment tal:condition="nothing">
        Known folderish contenttypes
    </tal:comment>

    <a tal:condition="python:item_type =='Folder' or item_type=='Gallery'"
       tal:attributes="href string:${item_url}/adi_call_galleryview;
                       title string:<div>${item_title_or_id}</div><div>${item_description}</div>;
                       class string:summary url fancybox iframe;">
        <div class="preview">
            <img tal:condition="item_has_leadimage" tal:attributes="src string:${item_url}/leadImage_thumb" />
            <img tal:condition="not: item_has_leadimage" tal:attributes="src string:${portal_url}/noprev.png" />
        </div>
        <div class="title">
            <img tal:attributes="src string:folder_icon.png"/>
            <span tal:content="item_title_or_id" />
            <div class ="desc" tal:content="item_description" />
        </div>
    </a>

    <tal:comment tal:condition="nothing">
        Files
    </tal:comment>
    <a tal:condition="python:item_type =='File'"
       tal:attributes="href string:${item_url}/adi_suite_flowplayer;
                       rel string:adigroup;
                       title string:<div>${item_title_or_id}</div><div>${item_description}</div>;
                       class string:summary url fancybox iframe;">
        <div class="preview">
            <img tal:condition="item_has_leadimage" tal:attributes="src string:${item_url}/leadImage_thumb" />
            <img tal:condition="not: item_has_leadimage" tal:attributes="src string:${portal_url}/noprev.png" />
        </div>
        <div class="title">
            <img tal:condition="python:item_url[-3:]=='swf'" tal:attributes="src string:flash.png"/>
            <img tal:condition="python:item_url[-3:]=='mp3'" tal:attributes="src string:audio.png"/>
            <img tal:condition="python:item_url[-3:]=='flv' or item_url[-3:]=='mp4'" tal:attributes="src string:movie.png;" />
            <span tal:content="item_title_or_id" />
            <div class ="desc" tal:content="item_description" />
        </div>
    </a>

    <tal:comment tal:condition="nothing">
        Images
    </tal:comment>
    <a tal:condition="python:item_type =='Image' and item_description == ''"
       tal:attributes="href string:${item_url};
                       rel string:adigroup;
                       class string:summary url fancybox iframe;
                       title string:${item_title_or_id};">
        <div class="preview">
            <img tal:condition="item_has_leadimage" 
                 tal:attributes="src string:${item_url}/leadImage_thumb" />
            <img tal:condition="not: item_has_leadimage" 
                 tal:attributes="src string:${item_url}/image_thumb" />
        </div>
        <div class="title">
            <img tal:attributes="src string:pic.png" />
            <span tal:content="item_title_or_id" />
            <div class ="desc" tal:content="item_description" />
        </div>
    </a>
    <a tal:condition="python:item_type =='Image' and item_description != ''"
       tal:attributes="href string:${item_url};
                       rel string:adigroup;
                       class string:summary url fancybox iframe;
                       title string:${item_title_or_id} <div>${item_description}</div>;">
            <div class="preview">
                <img tal:condition="item_has_leadimage" 
                     tal:attributes="src string:${item_url}/leadImage_thumb" />
                <img tal:condition="not: item_has_leadimage" 
                     tal:attributes="src string:${item_url}/image_thumb" />
            </div>
        <div class="title">
            <img tal:attributes="src string:pic.png" />
            <span tal:content="item_title_or_id" />
            <div class ="desc" tal:content="item_description" />
        </div>
    </a>

    <tal:comment tal:condition="nothing">
        All other contenttypes
    </tal:comment>
    <div tal:condition="python:item_type!='Folder' and item_type!='Image' and item_type!='File' and item_type!='Gallery'">
        <a tal:attributes="href string:${item_url}/adi_suite_content;
                           rel string:adigroup;
                           class string:summary url fancybox iframe;
                           title string:<div>${item_title_or_id}</div><div>${item_description}</div>;">
            <div class="preview">
                <img tal:condition="item_has_leadimage" 
                     tal:attributes="src string:${item_url}/leadImage_thumb" />
                <img tal:condition="not: item_has_leadimage" 
                     tal:attributes="src string:${portal_url}/noprev.png" />
            </div>
            <div class="title">
                <img tal:condition="python:item_type=='Document'" tal:attributes="src string:document_icon.png"/>
                <span tal:content="item_title_or_id" />
                <div class ="desc" tal:content="item_description" />
            </div>
        </a>
        
    </div>

</div><tal:comment tal:condition="nothing">EO adiGalItem</tal:comment>

                            <div class="visualClear"></div>
                        </div>
                    </tal:block>
                    <div metal:use-macro="here/batch_macros/macros/navigation" />
                </tal:listing>
                <metal:empty metal:define-slot="no_items_in_listing">
                    <p class="discreet"
                       tal:condition="not: folderContents"
                       i18n:translate="description_no_items_in_folder">
                        There are currently no items in this folder.
                    </p>
                </metal:empty>
                </tal:foldercontents>
            </metal:listingmacro>
          </div><tal:comment tal:condition="nothing">EO adi_fancybox_wrapper</tal:comment>
        </div><tal:comment tal:condition="nothing">EO adi_gal_contentarea</tal:comment>
        <metal:subtopics use-macro="here/atct_topic_view/macros/folderlisting_macro" />
        <div tal:replace="structure provider:plone.belowcontentbody" />
    </metal:main-macro>
    </div>
</body>
</html>
