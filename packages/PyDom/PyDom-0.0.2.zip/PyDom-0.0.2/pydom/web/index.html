<html> 
<head> 
	<title>Py Domotics</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="web/jquery.mobile-1.3.1.min.css" />
	<script src="web/jquery-1.9.1.min.js"></script>
	<script src="web/jquery.mobile-1.3.1.min.js"></script>
</head>

<body>
    <div data-role="page">
		<div data-role="header">
			<h1>Lights</h1>
		</div><!-- /header -->
	    <div id="content" data-role="content">
		</div><!-- /content -->
	</div><!-- /page -->
	
	<script>
	  (function() {
	    var deviceUrl = "/deviceList";
	  
		$.getJSON(deviceUrl, function(data) {
		  var items = [];
		  
		  $.each(data, function(deviceName, device) {
		  	  var item = '<div class="ui-block-a"><label for="' + deviceName + '">' + deviceName + ':</label></div>';
			  item = item + '<div class="ui-block-b"><select name="' + deviceName + '" id="' + deviceName + '" data-role="slider">';
			  item = item + '<option value="off">Off</option>';
			  item = item + '<option value="on">On</option></select></div>';
		      items.push(item);
		  });
		  		
		  // Element to append to
		  var target = $('#content');
		
		  $('<div />', {
		    'class': 'ui-grid-a',
		    html: items.join('')
		  }).appendTo(target).trigger("create");
		  
		});
		
		$('#content').on('change', function(event) {
			var target = $(event.target);
			var option = target.find("option:selected");
			$.get("doCommand?devices="+target[0].name+"&action="+option[0].value, function(data){});
		});
	  })();
	</script> 

</body>
</html>