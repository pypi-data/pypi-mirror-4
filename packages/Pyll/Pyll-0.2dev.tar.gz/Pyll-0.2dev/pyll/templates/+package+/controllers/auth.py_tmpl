import os
import time

import pyll
from pyll import tmpl_context as c, session
from pyll.decorators import xml, xml_render, html, html_render, jsonify, authorize,\
    credential, authenticated, redirect

from ${package}.model import User
from base import ControllerBase

class Auth(ControllerBase):

    @html('login.html')
    def login(self, *args, **kwargs):

        if self.request.method == 'POST':
            if 'username' in self.request.params:
                username = self.request.params['username']
                password = self.request.params['password']
                u = User.by_username(username)
                if u and u.validate_password(password):
                    session['user'] = u
                    session.save()
                    return redirect("/admin")
            else:
                return html_render()
        return html_render()

    def logout(self, *args, **kwargs):
        session.invalidate()
        session.delete()
        return self.login()
