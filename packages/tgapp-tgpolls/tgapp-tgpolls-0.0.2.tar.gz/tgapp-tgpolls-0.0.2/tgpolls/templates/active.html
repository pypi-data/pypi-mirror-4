<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">
<head>
    <meta charset="utf-8" />
    <title>TGPolls pluggable Application</title>
    <link rel="stylesheet" type="text/css" media="screen" href="${tg.url('/_pluggable/tgpolls/css/style.css')}" />
</head>
<body>
    <div py:for="poll in active_polls" class="tgpolls_poll_container">
        <script src="${tg.url('/_pluggable/tgpolls/js/jquery-1.7.1.min.js')}"></script>
        <h3 class="tgpolls_poll_title">${poll.body}</h3>
        <ul class="tgpolls_poll_answers_container">
            <li class="tgpolls_poll_answer" py:for="answer in poll.answers">
                <input type="checkbox" name="${poll.uid}" value="${answer.uid}">
                ${answer.text}
                </input>
            </li>
        </ul>
        <a py:if="not poll.expired" href="#" id="vote_for_poll_${poll.uid}" class="btn btn-primary ${'disabled' if 'poll_%s' % poll.uid in tg.session else ''}">VOTE</a>
        <script>
            jQuery('#vote_for_poll_${poll.uid}').click(function() {
                if (jQuery(this).hasClass('disabled')) return false;
                var votes = jQuery.map($('input:checkbox:checked[name=${poll.uid}]'), function(e,i) {
                    return +e.value;
                });
                jQuery.get("${h.plug_url('tgpolls', '/vote')}", { poll_uid: "${poll.uid}", votes: votes});
                jQuery(this).addClass('disabled');
            });
        </script>
    </div>
</body>
</html>