<div class="map" i18n:domain="ztfy.geoportal"
	 tal:define="api_key view/__parent__/geoportal_key"
	 tal:condition="api_key">
	<div id="mapviewer" class="mapviewer" style="width: 800px; height: 500px;"></div>
	<script type="text/javascript" tal:content="structure python:'''
		// <![CDATA[
		$(document).ready(function() {
			if (window.__Geoportal$timer === undefined) {
				var __Geoportal$timer = null;
			}
			initMap();
		});

		function initMap() {
			if (typeof(OpenLayers) === 'undefined' || typeof(Geoportal) === 'undefined') {
				setTimeout('initMap();', 300);
				return;
			}
			Geoportal.GeoRMHandler.getConfig(['%(key)s'], null, null, {
				onContractsComplete: loadMap
			});
		}

		function loadMap() {
			var map = $.ZTFY.geoportal.initViewer('mapviewer', '%(key)s');
		}
		// ]]>''' % { 'key': api_key }"></script>
	<script type="text/javascript"
			tal:define="devel python:'/lib/geoportal/lib/Geoportal.js' if view.__parent__.geoportal_devel else '/GeoportalExtended.js'"
			tal:attributes="src string:http://api.ign.fr/geoportail/api/js/${view/__parent__/geoportal_version}${devel}"></script>
</div>