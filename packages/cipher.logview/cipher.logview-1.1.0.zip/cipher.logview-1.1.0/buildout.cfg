[buildout]
develop = .
parts = test coverage coverage-test coverage-report python
versions = versions

[versions]
zc.recipe.testrunner = <2.0.0dev

[test]
recipe = zc.recipe.testrunner
eggs = cipher.logview[test]

[coverage]
recipe = z3c.recipe.scripts
eggs = coverage

[coverage-test]
recipe = zc.recipe.testrunner
eggs = cipher.logview [test]
defaults = ['--tests-pattern', '^f?tests$$', '-v']
initialization =
  # haaaaack because zc.testrunner 1.4.0 produces an _insane_ bin/test
  # that cannot be run with bin/coverage run bin/test, or even
  # bin/python bin/test
  import coverage, atexit
  c = coverage.coverage(data_file='../../../.coverage',
                        branch=True,
                        cover_pylib=False,
                        source=['cipher'])
  def _when_done(c=c): c.stop(), c.save()
  atexit.register(_when_done)
  c.start()

[coverage-report]
recipe = z3c.recipe.scripts
eggs = z3c.coverage
scripts = coveragereport=coverage-report

[python]
recipe = z3c.recipe.scripts
eggs = ${test:eggs}
interpreter = python
