var $,ajaxify,ajaxrequest,buildpage,buildrows,disable_links,exports,pagination,replacelink;$=jQuery;exports=this;exports.setitems_url=setitems_url;disable_links=function(e){if(exports.inprogress)e.preventDefault();return 1;};pagination=function(data){var html,linkpage,rows,tmpl,_i,_len,_ref;if(data.items.length){rows=[];if(data.next_page!==data.first_page&&data.page!==data.first_page)if(data.section)rows.push('<span><a href="/messages/quarantine/{{section}}/{{order_by}}/{{direction}}/{{first_page}}"><img src="{{media_url}}/imgs/first_pager.png" alt="first" title="first" /></a></span><span>...</span>');else rows.push('<span><a href="/messages/quarantine/{{order_by}}/{{direction}}/{{first_page}}"><img src="{{media_url}}/imgs/first_pager.png" alt="first" title="first" /></a></span><span>...</span>');if(data.previous_page)if(data.section)rows.push('<span><a href="/messages/quarantine/{{section}}/{{order_by}}/{{direction}}/{{previous_page}}"><img src="{{media_url}}/imgs/previous_pager.png" alt="prev" title="prev" /></a></span>');else rows.push('<span><a href="/messages/quarantine/{{order_by}}/{{direction}}/{{previous_page}}"><img src="{{media_url}}/imgs/previous_pager.png" alt="prev" title="prev" /></a></span>');_ref=data.page_nums;for(_i=0,_len=_ref.length;_i<_len;_i++){linkpage=_ref[_i];if(linkpage===data.page)rows.push('<span class="curpage">{{page}}</span>');else if(data.section)rows.push('<span><a href="/messages/quarantine/{{section}}/{{order_by}}/{{direction}}/'+linkpage+'">'+linkpage+'</a></span>');else rows.push('<span><a href="/messages/quarantine/{{order_by}}/{{direction}}/'+linkpage+'">'+linkpage+'</a></span>');}if(data.next_page)if(data.section)rows.push('<span><a href="/messages/quarantine/{{section}}/{{order_by}}/{{direction}}/{{next_page}}"><img src="{{media_url}}/imgs/next_pager.png" alt="next" title="next" /></a></span>');else rows.push('<span><a href="/messages/quarantine/{{order_by}}/{{direction}}/{{next_page}}"><img src="{{media_url}}/imgs/next_pager.png" alt="next" title="next" /></a></span>');if(data.next_page!==data.page_count&&data.page!==data.page_count&&data.page_count!==0)if(data.section)rows.push('<span>...</span><span><a href="/messages/quarantine/{{section}}/{{order_by}}/{{direction}}/{{last_page}}"><img src="{{media_url}}/imgs/last_pager.png" alt="last" title="last" /></a></span>');else rows.push('<span>...</span><span><a href="/messages/quarantine/{{order_by}}/{{direction}}/{{last_page}}"><img src="{{media_url}}/imgs/last_pager.png" alt="last" title="last" /></a></span>');tmpl=rows.join('\n');html=$.mustache(tmpl,data);}else html='-';return html;};ajaxify=function(e,url){e.preventDefault();$.address.value(url.replace(/\.json/,''));$.address.history($.address.baseURL()+url);ajaxrequest(url);return 1;};replacelink=function(html,style){$(style).html(html);return 1;};buildrows=function(items){var replacement,row,rows;row='<tr class="{{style}}_row"><td class="select_row">'+'<input type="checkbox" name="message_id" value="{{id}}" class="selector" /></td>'+'<td class="date_td"><a href="/messages/detail/{{id}}">{{timestamp}}</a></td>'+'<td class="from_row"><a href="/messages/detail/{{id}}">{{from_address}}</a></td>'+'<td class="to_row"><a href="/messages/detail/{{id}}">{{to_address}}</a></td>'+'<td class="subject_row"><a href="/messages/detail/{{id}}">{{subject}}</a></td>'+'<td class="score_row"><a href="/messages/detail/{{id}}">{{sascore}}</a></td>'+'<td class="status_row"><a href="/messages/detail/{{id}}">{{status}}</a></td></tr>';if(items.length){rows=[];$.each(items,function(i,n){var html;n.timestamp=BaruwaDateString(n.timestamp);html=$.mustache(row,n);return rows.push(html);});replacement=rows.join('');}else replacement='<tr><td colspan="7" class="spanrow">'+gettext('No messages found')+'</td></tr>';$('tbody').empty().append(replacement);return 1;};buildpage=function(data){var arrow,c,column,columns,html,i,linfo,newdirection,pages_html,pages_tmpl,style,title_html,title_tmpl,tmpl,_i,_len;buildrows(data.items);$('div.pages').html(pagination(data));if(data.items.length){pages_tmpl=gettext('Showing items {{first_item}} to {{last_item}} of {{item_count}}.');pages_html=$.mustache(pages_tmpl,data);title_tmpl=gettext('Messages :: Full message listing :: Showing page {{page}} of {{page_count}} pages.');title_html=$.mustache(title_tmpl,data);$('div.limiter').show();}else{pages_html=gettext('No items found');title_html=gettext('Messages :: Full message listing');$('div.limiter').hide();}$('div.toolbar p').html(pages_html);$('#title').html(title_html);$.address.title('.:. Baruwa :: '+title_html);$('div.pages a').click(function(e){var url;url=$(this).attr('href')+'.json';return ajaxify(e,url);});columns=['timestamp','from_address','to_address','subject','sascore'];linfo=[gettext('Date/Time'),gettext('From'),gettext('To'),gettext('Subject'),gettext('Score')];style=['.qdate_heading','.from_heading','.to_heading','.subject_heading','.score_heading'];tmpl='<a href="/messages/quarantine/{{order_by}}/{{direction}}/1">{{column}}</a>';for(i=_i=0,_len=columns.length;_i<_len;i=++_i){column=columns[i];html=$.mustache(tmpl,{'order_by':column,'direction':data.direction,'column':linfo[i]});if(column===data.order_by){if(data.direction==='dsc'){newdirection='asc';c='&nbsp;&uarr;';}else{newdirection='dsc';c='&nbsp;&darr;';}arrow=$.mustache(tmpl,{'order_by':data.order_by,'direction':newdirection,'column':c});html=html+arrow;}replacelink(html,style[i]);1;}$('thead a').click(function(e){var url;url=$(this).attr('href')+'.json';return ajaxify(e,url);});if($('#alertmsg').length){$('#alertmsg').empty();return $('#alertmsg').remove();}};ajaxrequest=function(url){if(!$('#shield').length)$('#wrap').after(exports.loading);else $('#shield').show();$.ajax(url,{type:'GET',cache:false,dataType:'json',beforeSend:function(XHR){exports.inprogress=true;return 1;},error:display_ajax_error,success:buildpage,complete:function(XHR,textStatus){exports.inprogress=false;$('#shield').hide();if($(window).scrollTop())$('html,body').animate({scrollTop:$("#header-bar").offset().top},1500);return 1;}});return 1;};$(document).ready(function(){$('#allchecker').click(function(){$('.selector').attr('checked',this.checked);return 1;});exports.inprogress=false;$('div.pages a').click(function(e){var url;url=$(this).attr('href')+'.json';return ajaxify(e,url);});$('thead a').click(function(e){var url;url=$(this).attr('href')+'.json';return ajaxify(e,url);});$('a').click(disable_links);$.address.externalChange(function(e){var url;if(e.path==='/'){$.address.history($.address.baseURL());return;}url=$.address.value()+'.json';ajaxify(e,url);return 1;});$('#squarantinetop, #squarantinebottom').change(function(){var n;n=$(this).val();return location.href=""+exports.setitems_url+"?n="+n;});$('.filter_add').bind('click',function(e){e.preventDefault();add_filters();return 1;});$('.filter_show').bind('click',function(e){e.preventDefault();show_filters();return 1;});return 1;});