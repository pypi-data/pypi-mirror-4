(function(a){if(typeof(a.ZTFY)=="undefined"){a.ZTFY={}}a.ZTFY.thesaurus={remove:function(c,d){jConfirm(a.ZTFY.I18n.CONFIRM_REMOVE,a.ZTFY.I18n.CONFIRM,function(f){if(f){var e={oid:c};a.ZTFY.ajax.post(window.location.href+"/@@ajax/ajaxRemove",e,window.location.reload,function(i,g,h){jAlert(i.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)})}})},tree:{showHideExtract:function(d){var c=a(d).attr("ztfy_extract");if(a(d).hasClass("hide")){a("DIV.tree SPAN.square[ztfy_extract="+c+"]").css("visibility","visible").each(function(){if(a(this).hasClass("used")){a(this).css("background-color","#"+a(d).attr("ztfy_color")).click(function(){a.ZTFY.thesaurus.tree.switchExtract(this)})}else{var e=a(this).parents("DIV").get(2);if(a(e).hasClass("form")||a("SPAN[ztfy_extract="+c+"]:first",e).hasClass("used")){a(this).css("background-color","white").click(function(){a.ZTFY.thesaurus.tree.switchExtract(this)})}else{a(this).css("background-color","silver")}}});a(d).css("background-image","url('/--static--/ztfy.thesaurus/img/visible.gif')").removeClass("hide")}else{a("DIV.tree SPAN.square[ztfy_extract="+c+"]").css("visibility","hidden").unbind("click");a(d).css("background-image","url('/--static--/ztfy.thesaurus/img/hidden.gif')").addClass("hide")}},expand:function(f){if(a(f).attr("src")=="/--static--/ztfy.thesaurus/img/plus.png"){a(f).attr("src","/--static--/ztfy.thesaurus/img/loader.gif");var d=a(f).parents("DIV.tree").attr("ztfy_base");var c=a("A",a(f).parents("DIV").get(0)).text();var e=a.data(a.ZTFY.thesaurus.tree,"source")||new Array();e[c]=f;a.data(a.ZTFY.thesaurus.tree,"source",e);a.ZTFY.ajax.post(d+"/@@terms.html/@@ajax/getNodes",{term:c},a.ZTFY.thesaurus.tree._expandCallback)}else{a.ZTFY.thesaurus.tree.collapse(f)}},_expandCallback:function(q,i){if(i=="success"){var h=q.term;var c=a.data(a.ZTFY.thesaurus.tree,"source")[h];var p=a(c).parents("DIV").get(0);var r=a(c).parents("DIV.tree");var o=r.attr("ztfy_details")!="off";var d=a("DIV.subnodes",a(c).parents("DIV").get(0));for(var k in q.nodes){var f=q.nodes[k];var m=a("<div></div>");a("<img />").addClass("plminus").attr("src",f.expand?"/--static--/ztfy.thesaurus/img/plus.png":"/--static--/ztfy.thesaurus/img/lline.png").click(function(){a.ZTFY.thesaurus.tree.expand(this)}).appendTo(m);a("<a></a>").addClass(o?"label":"").addClass(f.cssClass).click(function(){a.ZTFY.thesaurus.tree.openTerm(this)}).html(f.label).appendTo(m);a("<span> </span>").appendTo(m);for(var g in f.extensions){var n=f.extensions[g];a("<img />").addClass("extension").attr("src",n.icon).attr("ztfy_view",n.view).click(function(){a.ZTFY.thesaurus.tree.openExtension(this)}).appendTo(m)}f.extracts.reverse();for(var g in f.extracts){var j=f.extracts[g];var e=a("DIV.extract SPAN.showhide[ztfy_extract="+j.name+"]");var l=a("<span></span>").addClass("square").addClass(j.used?"used":null).attr("title",j.title).attr("ztfy_extract",j.name);if(a(e).hasClass("hide")){l.css("visibility","hidden")}else{if(a("SPAN[ztfy_extract="+j.name+"]:first",p).hasClass("used")){l.css("background-color",j.used?"#"+j.color:"white");l.click(function(){a.ZTFY.thesaurus.tree.switchExtract(this)})}else{l.css("background-color","silver")}}l.appendTo(m)}a("<div></div>").addClass("subnodes").appendTo(m);m.appendTo(d)}a(c).attr("src","/--static--/ztfy.thesaurus/img/minus.png")}},collapse:function(c){a("DIV.subnodes",a(c).parents("DIV").get(0)).empty();a(c).attr("src","/--static--/ztfy.thesaurus/img/plus.png")},openTerm:function(e){var c=a(e).parents("DIV.tree");if(c.attr("ztfy_details")=="off"){return}var d=a(e).text().replace(/ /g,"%20");if(a.browser.msie){d=a.UTF8.encode(d)}a.ZTFY.dialog.open("++terms++/"+d+"/@@properties.html")},openExtension:function(d){var c=a(d).attr("ztfy_view").replace("/ /g","%20");if(a.browser.msie){c=a.UTF8.encode(c)}a.ZTFY.dialog.open(c)},reloadTerm:function(d){a.ZTFY.dialog.close();var c=a("IMG.plminus:first",a("A:econtains("+d.replace("&#039;","'")+")").parent("DIV"));a.ZTFY.thesaurus.tree.collapse(c);a.ZTFY.thesaurus.tree.expand(c)},switchExtract:function(f){var e=a(f).attr("ztfy_extract");var d=a("DIV.extract SPAN.showhide[ztfy_extract="+e+"]");if(d.attr("ztfy_enabled")=="False"){return}var c=a("A.label",a(f).parents("DIV")).get(0);if(a.ZTFY.rgb2hex(a(f).css("background-color"))=="#ffffff"){a.ZTFY.thesaurus.tree._switchExtract(c,e)}else{if(a(c).parent("DIV").children("IMG").attr("src").endsWith("/lline.png")){a.ZTFY.thesaurus.tree._switchExtract(c,e)}else{jConfirm(a.ZTFY.thesaurus.I18n.CONFIRM_UNSELECT_WITH_CHILD,a.ZTFY.I18n.CONFIRM,function(g){if(g){a.ZTFY.thesaurus.tree._switchExtract(c,e)}})}}},_switchExtract:function(c,e){var d=a(c).text();a.ZTFY.ajax.post("@@terms.html/@@ajax/switchExtract",{term:d,extract:e},a.ZTFY.thesaurus.tree._switchExtractCallback)},_switchExtractCallback:function(c,d){if(d=="success"){var f=c.term;var e=a("A.label:withtext("+f+")");var g=a(e).parents("DIV").get(0);if(c.used){a("DIV.subnodes:first > DIV",g).children("SPAN[ztfy_extract="+c.extract+"]",g).css("background-color","white").unbind("click").click(function(){a.ZTFY.thesaurus.tree.switchExtract(this)});a("SPAN[ztfy_extract="+c.extract+"]:first",g).addClass("used").css("background-color","#"+c.color)}else{a("SPAN[ztfy_extract="+c.extract+"]",g).removeClass("used").css("background-color","silver").unbind("click");a("SPAN[ztfy_extract="+c.extract+"]:first",g).css("background-color","white").click(function(){a.ZTFY.thesaurus.tree.switchExtract(this)})}}}},findTerms:function(g,d,f){var c;var e={url:a.ZTFY.ajax.getAddr(),type:"POST",method:"findTerms",async:false,params:{query:g,thesaurus_name:d||"",extract_name:f||""},success:function(i,h){c=i.result},error:function(j,h,i){jAlert(j.responseText,"Error !",window.location.reload)}};a.jsonRpc(e);return c},download:function(c){a.ZTFY.form.check(function(){a.ZTFY.thesaurus._download(c)});return false},_download:function(d){var e=a(d).attr("action");var f=e+"/@@ajax/ajaxDownload";var c=a("<iframe></iframe>").hide().attr("name","downloadFrame").appendTo(a(d));a(d).attr("action",f).attr("target","downloadFrame").ajaxSubmit({success:function(){a.ZTFY.dialog.close()}});a(d).attr("action",e)}};var b=a("HTML").attr("lang")||a("HTML").attr("xml:lang")||"en";a.getScript("/--static--/ztfy.thesaurus/js/i18n/"+b+".js")})(jQuery);