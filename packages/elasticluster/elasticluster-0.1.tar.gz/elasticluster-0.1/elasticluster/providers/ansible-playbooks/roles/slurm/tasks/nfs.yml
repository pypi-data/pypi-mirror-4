---
# Ubuntu-specific actions
- name: install nfs server
  action: apt pkg=nfs-kernel-server state=present
  only_if: $is_ubuntu
  tags:
    -nfs

- name: install nfs client
  action: apt pkg=nfs-common state=present
  only_if: $is_ubuntu
  tags:
    -nfs

# CentOS-specific actions
- name: install nfs client
  action: yum pkg=nfs-utils state=present
  only_if: $is_centos
  tags:
    -nfs

# /etc/exports
- name: set /etc/exports
  action: template src=slurm/templates/exports.j2 dest=/etc/exports
  tags:
    - nfs

- name: reload nfs exports
  action: shell exportfs -r
  tags:
    - nfs

# CentOS does not start needed services after installation
- name: ensure nfs service is running
  action: service name=$item state=started
  only_if: $is_centos
  tags:
    - nfs
  with_items:
    - rpcbind
    - nfslock
    - nfs
