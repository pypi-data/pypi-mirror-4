

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>API &mdash; redis-completion 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="redis-completion 0.2.0 documentation" href="index.html" />
    <link rel="prev" title="Schema" href="schema.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="schema.html" title="Schema"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">redis-completion 0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="api">
<span id="id1"></span><h1>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="RedisEngine">
<em class="property">class </em><tt class="descname">RedisEngine</tt><big>(</big><em>min_length=2</em>, <em>prefix='ac'</em>, <em>stop_words=None</em>, <em>cache_timeout=300</em>, <em>**conn_kwargs</em><big>)</big><a class="headerlink" href="#RedisEngine" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>min_length</strong> (<em>integer</em>) &#8211; the minimum length a phrase has to be to return meaningful
search results</li>
<li><strong>prefix</strong> (<em>string</em>) &#8211; a prefix used for all keys stored in Redis to allow multiple
&#8220;indexes&#8221; to exist and to make deletion easier.</li>
<li><strong>stop_words</strong> (<em>set</em>) &#8211; a <tt class="docutils literal"><span class="pre">set</span></tt> of stop words to remove from index/search data</li>
<li><strong>cache_timeout</strong> (<em>integer</em>) &#8211; how long to keep around search results</li>
<li><strong>conn_kwargs</strong> &#8211; any named parameters that should be used when connecting
to Redis, e.g. <tt class="docutils literal"><span class="pre">host='localhost',</span> <span class="pre">port=6379</span></tt></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="#RedisEngine" title="RedisEngine"><tt class="xref py py-class docutils literal"><span class="pre">RedisEngine</span></tt></a> is responsible for storing and searching data suitable
for autocompletion.  There are many different options you can use to configure
how autocomplete behaves, but the defaults are intended to provide good general
performance for searching things like blog post titles and the like.</p>
<p>The underlying data structure used to provide autocompletion is a sorted set,
details are described <a class="reference external" href="http://antirez.com/post/autocomplete-with-redis.html">in this post</a>.</p>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">redis_completion</span> <span class="kn">import</span> <span class="n">RedisEngine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">RedisEngine</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="RedisEngine.store">
<tt class="descname">store</tt><big>(</big><em>obj_id</em><span class="optional">[</span>, <em>title=None</em><span class="optional">[</span>, <em>data=None</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#RedisEngine.store" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>obj_id</strong> &#8211; a unique identifier for the object</li>
<li><strong>title</strong> &#8211; a string to store in the index and allow autocompletion on,
which, if not provided defaults to the given <tt class="docutils literal"><span class="pre">obj_id</span></tt></li>
<li><strong>data</strong> &#8211; any data you wish to store and return when a given title is
searched for.  If not provided, defaults to the given <tt class="docutils literal"><span class="pre">title</span></tt> (or <tt class="docutils literal"><span class="pre">obj_id</span></tt>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Store an object in the index and allow it to be searched for.</p>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s">&#39;some phrase&#39;</span><span class="p">)</span>
<span class="n">engine</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s">&#39;some other phrase&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the following example a list of blog entries is being stored in the
index.  Note that arbitrary data can be stored in the index.  When a search
is performed this data will be returned.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">Entry</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="s">&#39;published&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">published</span><span class="p">,</span>
        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
        <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
    <span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="RedisEngine.store_json">
<tt class="descname">store_json</tt><big>(</big><em>obj_id</em>, <em>title</em>, <em>data</em><big>)</big><a class="headerlink" href="#RedisEngine.store_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#RedisEngine.store" title="RedisEngine.store"><tt class="xref py py-meth docutils literal"><span class="pre">store()</span></tt></a> except <tt class="docutils literal"><span class="pre">data</span></tt> is automatically serialized as JSON
before being stored in the index.  Best when used in conjunction with
<a class="reference internal" href="#RedisEngine.search_json" title="RedisEngine.search_json"><tt class="xref py py-meth docutils literal"><span class="pre">search_json()</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="RedisEngine.remove">
<tt class="descname">remove</tt><big>(</big><em>obj_id</em><big>)</big><a class="headerlink" href="#RedisEngine.remove" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>obj_id</strong> &#8211; a unique identifier for the object</td>
</tr>
</tbody>
</table>
<p>Removes the given object from the index.</p>
</dd></dl>

<dl class="method">
<dt id="RedisEngine.search">
<tt class="descname">search</tt><big>(</big><em>phrase</em><span class="optional">[</span>, <em>limit=None</em><span class="optional">[</span>, <em>filters=None</em><span class="optional">[</span>, <em>mappers=None</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#RedisEngine.search" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>phrase</strong> &#8211; search the index for the given phrase</li>
<li><strong>limit</strong> &#8211; an integer indicating the number of results to limit the
search to.</li>
<li><strong>filters</strong> &#8211; a list of callables which will be used to filter the search
results before returning to the user.  Filters should take a single parameter,
the <tt class="docutils literal"><span class="pre">data</span></tt> associated with a given object and should return either
<tt class="docutils literal"><span class="pre">True</span></tt> or <tt class="docutils literal"><span class="pre">False</span></tt>.  A <tt class="docutils literal"><span class="pre">False</span></tt> value returned by any of the filters
will prevent a result from being returned.</li>
<li><strong>mappers</strong> &#8211; a list of callables which will be used to transform the
raw data returned from the index.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">A list containing data returned by the index</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Mappers act upon data before it is passed to the filters</p>
</div>
<p>Assume we have stored some interesting blog posts, encoding some metadata
using JSON:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">,</span> <span class="n">mappers</span><span class="o">=</span><span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">])</span>
<span class="go">[{&#39;published&#39;: True, &#39;title&#39;: &#39;an entry about python&#39;, &#39;url&#39;: &#39;/blog/1/&#39;},</span>
<span class="go"> {&#39;published&#39;: False, &#39;title&#39;: &#39;using redis with python&#39;, &#39;url&#39;: &#39;/blog/3/&#39;}]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="RedisEngine.search_json">
<tt class="descname">search_json</tt><big>(</big><em>phrase</em><span class="optional">[</span>, <em>limit=None</em><span class="optional">[</span>, <em>filters=None</em><span class="optional">[</span>, <em>mappers=None</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#RedisEngine.search_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#RedisEngine.search" title="RedisEngine.search"><tt class="xref py py-meth docutils literal"><span class="pre">search()</span></tt></a> except <tt class="docutils literal"><span class="pre">json.loads</span></tt> is inserted as the very first
mapper.  Best when used in conjunction with <a class="reference internal" href="#RedisEngine.store_json" title="RedisEngine.store_json"><tt class="xref py py-meth docutils literal"><span class="pre">store_json()</span></tt></a>.</p>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="schema.html"
                        title="previous chapter">Schema</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/api.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="schema.html" title="Schema"
             >previous</a> |</li>
        <li><a href="index.html">redis-completion 0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, charles leifer.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>