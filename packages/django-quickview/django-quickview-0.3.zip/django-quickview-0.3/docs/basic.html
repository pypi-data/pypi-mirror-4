<html>
    <head>
        <link rel="stylesheet" href="https://d3oaxc4q5k2d6q.cloudfront.net/m/ab8a6712a20a/compressed/css/e421bfdb2059.css" type="text/css" />
        <link rel="stylesheet" href="https://d3oaxc4q5k2d6q.cloudfront.net/m/ab8a6712a20a/compressed/css/3e07fe91b215.css" type="text/css" />
        <style>
            body { margin: 50px; width: 900px; }
            .codehilite {
                padding: 20px;
                margin: 10px;
                border: dashed 1px gray;
                color: light-grey;
            }
        </style>
    </head>
    <body><h1>Django QuickView</h1>
<p><strong>Putting the nitro into django rapid web development.</strong></p>
<ul>
<li>Author: Thomas Augestad Weholt, <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#116;&#104;&#111;&#109;&#97;&#115;&#64;&#119;&#101;&#104;&#111;&#108;&#116;&#46;&#111;&#114;&#103;">&#116;&#104;&#111;&#109;&#97;&#115;&#64;&#119;&#101;&#104;&#111;&#108;&#116;&#46;&#111;&#114;&#103;</a>.</li>
<li>License: Modified BSD.</li>
<li>Source: https://bitbucket.org/weholt/django-quickview/src</li>
<li>
<p>Package: https://pypi.python.org/pypi/django-quickview/</p>
</li>
<li>
<p>Requirements:</p>
<ul>
<li>Django 1.5</li>
<li>Python 2.7.x or 3.3</li>
</ul>
</li>
</ul>
<h2>Wetting your appetite</h2>
<p>In models.py:</p>
<div class="codehilite"><pre>    <span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
    <span class="kn">from</span> <span class="nn">quickview</span> <span class="kn">import</span> <span class="n">ModelQuickView</span>

    <span class="nd">@ModelQuickView</span>
    <span class="k">class</span> <span class="nc">Friend</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>In global urls.py:</p>
<div class="codehilite"><pre>    <span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span>
    <span class="kn">from</span> <span class="nn">quickview</span> <span class="kn">import</span> <span class="n">discover_views</span>

    <span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">discover_views</span><span class="p">()</span>
</pre></div>


<p>That's all it takes to get full scaffolding (list, detail, add, update, delete) for your model with similar ajax API. Ok,
you might have to write some templates, but even that can be reduced to a minimum.</p>
<h2>Background</h2>
<p>After having used django for a while I noticed that how I worked with my views and urlpatterns followed very similar pattern
and that I should be able to replicate that pattern in a generic way, similar to class based views. My attempts at using
  CBV left me underwhelmed and motivated me to try and come up with a new way of doing things. QuickView are heavily inspired by
  CBV, but takes it all a bit further and removes the need to update urlpatterns all together for most common views. It actually
  removes the common views as well, but gives you the possibility to extend your app by adding custom views. You also get built-in
 ajax support, pagination, authentication and in the future an entire suite of tools to make rapid development using django even easier.</p>
<p>In the end QuickView reduces the time it takes to go from defining a model and getting a site up and running with scaffolding for
your models, with very nice ajax support and generation of templates for your views, styled by using Bootstrap for cross-browser, modern looking
 web sites.</p>
<p>Future development will focus on extending ajax and javascript support to enable users to create pages that don't rely as much on
 the old "request/response by posting/refreshing the whole page"-pattern, by using knockoutjs and handlebarsjs frameworks.</p>
<h2>Installation</h2>
<div class="codehilite"><pre>    <span class="n">pip</span> <span class="n">install</span> <span class="n">django</span><span class="o">-</span><span class="n">quickview</span>
</pre></div>


<p>In <code>settings.py</code> make sure you have the following enabled, which is not by default:</p>
<div class="codehilite"><pre>    <span class="n">TEMPLATE_CONTEXT_PROCESSORS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="o">...</span>
        <span class="s">&#39;django.core.context_processors.static&#39;</span><span class="p">,</span> <span class="c"># added this one</span>
        <span class="o">...</span>
    <span class="p">)</span>

    <span class="n">STATICFILES_FINDERS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="o">...</span>
        <span class="s">&#39;django.contrib.staticfiles.finders.DefaultStorageFinder&#39;</span><span class="p">,</span> <span class="c"># I commented this one in, was out as default.</span>
        <span class="o">...</span>
    <span class="p">)</span>

    <span class="c"># Also set the static root</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">),</span> <span class="s">&#39;static&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">STATIC_ROOT</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">STATIC_ROOT</span><span class="p">)</span>

    <span class="c"># Finally add quickview to your installed apps:</span>
    <span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="o">...</span>
        <span class="s">&#39;quickview&#39;</span><span class="p">,</span>
        <span class="o">...</span><span class="p">)</span>
</pre></div>


<h2>Getting started</h2>
<p><strong>NOTE! This assumes you know how django works and at least have followed the basic django tutorial.</strong></p>
<p>To illustrate how quickview works, take a look at this example. We're going to create a small testproject with one
app in it.</p>
<div class="codehilite"><pre>    <span class="n">django</span><span class="o">-</span><span class="n">admin</span><span class="o">.</span><span class="n">py</span> <span class="n">startproject</span> <span class="n">testsite</span>
    <span class="n">cd</span> <span class="n">testsite</span>
    <span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">startapp</span> <span class="n">friendslist</span>
</pre></div>


<p>Add <code>friendslist</code> to your installed apps and configure the database setup. In <code>friendslist/models.py</code>, define a model looking like this:</p>
<div class="codehilite"><pre>    <span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

    <span class="k">class</span> <span class="nc">Friend</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">zip_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>Do a <code>python manage.py syncdb</code>. So far we've not done but normal django work. To enable a quickview of this model,
<code>from quickview import ModelQuickView</code> and decorate your model like shown below:</p>
<div class="codehilite"><pre>    <span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
    <span class="kn">from</span> <span class="nn">quickview</span> <span class="kn">import</span> <span class="n">ModelQuickView</span>

    <span class="nd">@ModelQuickView</span>
    <span class="k">class</span> <span class="nc">Friend</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">zip_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>Next we have to do on more thing to get quickview up and running. Open the <code>urls.py</code> for project, not the one for your app,
but the one located alongside <code>settings.py</code>. Modify it to look like this:</p>
<div class="codehilite"><pre>    <span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span>
    <span class="kn">from</span> <span class="nn">quickview</span> <span class="kn">import</span> <span class="n">discover_views</span>

    <span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">discover_views</span><span class="p">()</span>
</pre></div>


<p>Run it with <code>python manage.py runserver</code> and head over to <code>http:\\localhost:8000</code> in your browser. You should be greeted
with a <code>Page not found (404)</code> with the following list:</p>
<div class="codehilite"><pre>    <span class="o">^</span><span class="n">accounts</span><span class="o">/</span><span class="n">login</span><span class="o">/</span><span class="err">$</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;login-view&#39;</span><span class="p">]</span>
    <span class="o">^</span><span class="n">accounts</span><span class="o">/</span><span class="n">logout</span><span class="o">/</span><span class="err">$</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;logout-view&#39;</span><span class="p">]</span>
    <span class="o">^</span><span class="n">api</span><span class="o">/</span><span class="n">friendslist</span><span class="o">/</span><span class="n">friend</span><span class="o">/</span><span class="n">get_url</span><span class="o">/</span><span class="err">$</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;api-friendslist-friend-get-url&#39;</span><span class="p">]</span>
    <span class="o">^</span><span class="n">friendslist</span><span class="o">/</span><span class="n">friend</span><span class="o">/</span><span class="nb">list</span><span class="o">/</span><span class="err">$</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;friendslist-friend-list&#39;</span><span class="p">]</span>
    <span class="o">^</span><span class="n">friendslist</span><span class="o">/</span><span class="n">friend</span><span class="o">/</span><span class="n">add</span><span class="o">/</span><span class="err">$</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;friendslist-friend-add&#39;</span><span class="p">]</span>
    <span class="o">^</span><span class="n">friendslist</span><span class="o">/</span><span class="n">friend</span><span class="o">/</span><span class="p">(</span><span class="err">?</span><span class="n">P</span><span class="o">&lt;</span><span class="n">pk</span><span class="o">&gt;</span>\<span class="n">d</span><span class="o">+</span><span class="p">)</span><span class="o">/</span><span class="err">$</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;friendslist-friend-detail&#39;</span><span class="p">]</span>
    <span class="o">^</span><span class="n">friendslist</span><span class="o">/</span><span class="n">friend</span><span class="o">/</span><span class="n">update</span><span class="o">/</span><span class="p">(</span><span class="err">?</span><span class="n">P</span><span class="o">&lt;</span><span class="n">pk</span><span class="o">&gt;</span>\<span class="n">d</span><span class="o">+</span><span class="p">)</span><span class="o">/</span><span class="err">$</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;friendslist-friend-update&#39;</span><span class="p">]</span>
    <span class="o">^</span><span class="n">friendslist</span><span class="o">/</span><span class="n">friend</span><span class="o">/</span><span class="n">delete</span><span class="o">/</span><span class="p">(</span><span class="err">?</span><span class="n">P</span><span class="o">&lt;</span><span class="n">pk</span><span class="o">&gt;</span>\<span class="n">d</span><span class="o">+</span><span class="p">)</span><span class="o">/</span><span class="err">$</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;friendslist-friend-delete&#39;</span><span class="p">]</span>
    <span class="o">^</span><span class="n">quickview</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="err">$</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;quickview-debug&#39;</span><span class="p">]</span>
</pre></div>


<p>So where did all those urlpatterns come from? Quickview generated those based on the model you decorated. All models get
 5 specific views by default:</p>
<ul>
<li>index</li>
<li>add</li>
<li>detail</li>
<li>update</li>
<li>delete</li>
</ul>
<p>Both the url and the name are based on the same pattern <code>app_label-model_name-view_name</code>, except the urls for
detail, update and delete which get the id/pk supplied as part of the request-path. Urlpatterns starting with <code>^api</code> are paths
used for ajax-based requests. <code>^accounts/login/</code> are enabled to support login/logout and uses the standard django generic views
for authentication. <code>^quickview/debug/</code> displays a page showing the same list of urlpatterns as above and are used to debug
your app. It will probably contain more information later on.</p>
<p>If you try to access for instance <code>http://localhost:8000/friendslist/friend/list/</code> you'll be greeted with another exception:</p>
<div class="codehilite"><pre>TemplateDoesNotExist at /friendslist/friend/list/
</pre></div>


<p>You haven't defined any templates for that view to use. It should be located in <code>friendslist/friend/index.html</code> in the template-folder
 in your apps-folder. At this point you could stop the django development server and do:</p>
<div class="codehilite"><pre>    <span class="nb">cd </span>friendslist
    mkdir templates
    <span class="nb">cd </span>templates
    mkdir friendslist
    <span class="nb">cd </span>friendslist
    mkdir friend
</pre></div>


<p>And add a index.html to that last folder and then create templates for detail.html, add.html, update.html and delete.html.</p>
<p>Or you could just do this instead:</p>
<div class="codehilite"><pre>    python manage.py generate_templates friendslist Friend
</pre></div>


<p>which will generate required templates and give you a starting point for your site in form of a <code>friendslist/friend/base_site.html</code> your
templates can extend. The default design is based on Bootstrap and comes with a few javascript goodies we will use in the more advanced user-scenarios
of quickview. The management command will only run once, ie. if the templates-folder exists etc it won't do anything at all.</p>
<p>The syntax for the command is <code>python manage.py generate_templates app-label model-name1 model-name2 etc</code>.</p>
<p>The process will also modify your <code>views.py</code> file and add a default quickview for the Friend-model so you can go ahead and
remove the <code>@ModelQuickView</code>-decorator you added in <code>models.py</code>. Now try running the development server again and
refresh <code>http://localhost:8000/friendslist/friend/list/</code>. It should show you a rather pretty page where you can add friends etc.
To be able to login you'll have to create some templates as well, but you could use the ones below, placed in a folder
called registration in the root of your templates-folder:</p>
<p>Login.html:</p>
<div class="codehilite"><pre>    {% extends &#39;friendslist/friend/base_site.html&#39; %}

    {% block content %}

    <span class="nt">&lt;h1&gt;</span>Please login<span class="nt">&lt;/h1&gt;</span>
    {% if form.errors %}
    <span class="nt">&lt;p&gt;</span>Your username and password didn&#39;t match. Please try again.<span class="nt">&lt;/p&gt;</span>
    {% endif %}

    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;{% url &#39;django.contrib.auth.views.login&#39; %}&quot;</span><span class="nt">&gt;</span>
        {% csrf_token %}
        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;</span>{{ form.username.label_tag }}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;</span>{{ form.username }}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;</span>{{ form.password.label_tag }}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;</span>{{ form.password }}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;login&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;next&quot;</span> <span class="na">value=</span><span class="s">&quot;{% url &#39;friendslist-friend-list&#39; %}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    {% endblock %}
</pre></div>


<p>logged_out.html:</p>
<div class="codehilite"><pre>    {% extends &#39;friendslist/friend/base_site.html&#39; %}

    {% block content %}

    <span class="nt">&lt;h1&gt;</span>You are now logged out<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{% url &#39;friendslist-friend-list&#39; %}&quot;</span><span class="nt">&gt;</span>Back to the list<span class="nt">&lt;/a&gt;</span>
    {% endblock %}
</pre></div>


<p>At this point you need to create a user to login, edit the provided templates to better display your data etc. You might also
want to either remove the base_site.html in your <code>friendslist/templates/friendslist/friend/</code>-folder or move it to the root
of your templates-folder to use it across apps.</p>
<h2>Advanced use</h2>
<h3>Authentication</h3>
<p>Probably the easiest thing to enable in a quickview:</p>
<div class="codehilite"><pre>    <span class="k">class</span> <span class="nc">FriendView</span><span class="p">(</span><span class="n">ModelQuickView</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Friend</span>
        <span class="n">authentication_required</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>


<p>Of course, as mentioned earlier, now you need to provide the generic django views for login and logged_out with some templates,
but examples of such templates are shown above.</p>
<h3>Pagination</h3>
<p>The default QuickView generated by using the management command <code>generate_templates</code> look like this:</p>
<div class="codehilite"><pre>    <span class="kn">from</span> <span class="nn">quickview</span> <span class="kn">import</span> <span class="n">ModelQuickView</span>
    <span class="kn">from</span> <span class="nn">friendslist.models</span> <span class="kn">import</span> <span class="n">Friend</span>

    <span class="k">class</span> <span class="nc">FriendView</span><span class="p">(</span><span class="n">ModelQuickView</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Friend</span>
        <span class="n">use_dynamic_ajax_page</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">use_pagination</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">items_per_page</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="c">#authentication_required = True</span>
</pre></div>


<p>As you can see it specifies what model to use and several other options. By using the list-view for your model you can enable
pagination of your querysets by setting <code>use_pagination = True</code> as seen above. The code uses django's normal pagination support.
To specify a specific page you add a page=page_number to either your form if you POST a request or to the request-url if using GET.
This will also be applied for ajax-calls which will be explained later.</p>
<h3>Ajax</h3>
<p>By default QuickView enables some handy javascript functions which will ease working with ajax in your apps. It relies on
jQuery to do most of the heavy lifting, but it also provides you with a very easy to use API for listing, fetching details, adding, updating and deleting
 rows in your database.</p>
<p>You don't have to bother with <code>csrf_tokens</code> using this API. Quickview has handled that for you. All communication from the server to the client side
 assumes <code>JSON</code> is being used.</p>
<p>If you have a working site from following the instructions in the <code>Getting started</code>-section quickview should have generated an API especially
for your model. Our model was called Friend and client-side we have an API called <code>friendApi</code> with the following methods and their parameters:</p>
<ul>
<li>
<p><code>list(page, success_handler, failure_handler)</code>. If no page is specified you'll get the first one. You need to supply a succes_handler since
ajax is async. This function takes one parameter and that is the data generated by the list call, namely a dictionary with a 'object_list'-key
pointing to the list of models. Failure_handler is specified if you want to handle failure to get the list manually. If not it will just be printed to the console by
a dummy handler.</p>
</li>
<li>
<p><code>details(pk, success_handler, failure_handler)</code>. Pk is the primary key or id of the object you want. As with list you need to supply a success_handler to
process the call and get hold of the result.</p>
</li>
<li>
<p><code>add(params, success_handler, failure_handler)</code>. Params is a dictionary containing data to create a new row in the database. You don't need to
supply a success_handler, but if you do you could handle the data returned by the add-process, which is a dictionary-representation of the newly
created object in addition to an 'added'-value indicating if the object was added or not.</p>
</li>
<li>
<p><code>update(pk, params, success_handler, failure_handler)</code>. Pk is the primary key or id of the object you want to update with params. Supply a
 success_handler if you want to handle the updated data related to the model, for instance update the client-side.</p>
</li>
<li>
<p><code>delete(pk, success_handler, failure_handler)</code>. Pk is the primary key or id of the object you want to delete. Success_handler can process any response from the server,
which in most cases are a dictionary containing {'deleted': True, 'pk': pk} on success or {'deleted': False, 'pk': pk} on failure.</p>
</li>
</ul>
<p>Adding and updating models using ajax uses the same validation rules as defined in the related form specified on the view. If an ajax call fails
due to validation issues you'll get an response from the server when handling the call in your success_handler looking like:</p>
<div class="codehilite"><pre>    <span class="p">{</span><span class="s">&#39;added&#39;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s">&#39;validation_errors&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="o">....</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>


<p>If you're running Chrome you can hit CTRL+SHIFT+J and go to the console and type:</p>
<div class="codehilite"><pre>    <span class="o">&gt;</span> <span class="nx">friendApi</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;Johnny&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="o">:</span> <span class="nx">j</span><span class="err">@</span><span class="nx">example</span><span class="p">.</span><span class="nx">com</span><span class="err">&#39;</span><span class="p">})</span>
</pre></div>


<p>and hit enter. You should see something like this being printed in the console:</p>
<div class="codehilite"><pre>    <span class="nb">Object</span> <span class="p">{</span><span class="nx">object</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">added</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
</pre></div>


<p>Being able to play around with the javascript ajax API makes it much easier to debug. And fun. Some more examples:</p>
<div class="codehilite"><pre>    <span class="o">&gt;</span> <span class="nx">friendApi</span><span class="p">.</span><span class="nx">list</span><span class="p">()</span>
      <span class="nb">Object</span> <span class="p">{</span><span class="nx">object_list</span><span class="o">:</span> <span class="nb">Array</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>

    <span class="o">&gt;</span> <span class="nx">friendApi</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="nb">Object</span> <span class="p">{</span><span class="nx">deleted</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">pk</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span><span class="p">}</span>
</pre></div>


<p>To update an model it gets a bit more complicated, but this example shows how:</p>
<div class="codehilite"><pre>    <span class="o">&gt;</span> <span class="nx">friendApi</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
            <span class="nx">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;New name of person&#39;</span><span class="p">;</span>
            <span class="nx">friendApi</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="nb">Object</span> <span class="p">{</span><span class="nx">pk</span><span class="o">:</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="nx">object</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">updated</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
</pre></div>


<p>The reason for this is simple; doing a simple friendApi.update(4, {'name': 'New name of person'}) would set all other properties
of the model to NULL. This is awkward and I'm hoping to fix this in the future.</p>
<p><strong>You should really have authentication enabled to avoid abuse of this functionality.</strong></p>
<h3>Forms, custom forms and pre/post-save hooks</h3>
<p>Quickview uses the default form generated from your model. You can override this completly by supplying your own form like this:</p>
<div class="codehilite"><pre>    <span class="k">class</span> <span class="nc">FriendView</span><span class="p">(</span><span class="n">ModelQuickView</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Friend</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">MySpecialForm</span>
</pre></div>


<p>You can also specify a set of fields to include or exclude fields like with normal ModelForms:</p>
<div class="codehilite"><pre>    <span class="k">class</span> <span class="nc">FriendView</span><span class="p">(</span><span class="n">ModelQuickView</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Friend</span>
        <span class="n">form_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;email&#39;</span><span class="p">]</span>
        <span class="n">form_fields_to_exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">]</span>
</pre></div>


<p>It normally doesn't make sense to specify both, but you can as with normal ModelForms.</p>
<p>You can also use <code>hooks</code>, like pre_save to avoid saving an object by throwing a specific exception or to clean-up data before saving it.
Typical usage is setting some property of the model to request.user. It can be done like this:</p>
<div class="codehilite"><pre>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">pre_save</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</pre></div>


<p>You always have access to the request itself and you got hooks for pre- and post-save called on add and update and pre- and post-delete
on deletion. To prevent saving you raise <code>PreSaveException</code> in pre_save or <code>PostSaveException</code> in post_save like this:</p>
<div class="codehilite"><pre>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">pre_save</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s">&#39;foobar&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PreSaveException</span><span class="p">(</span><span class="s">&#39;Text cannot be &quot;foobar&quot;.&#39;</span><span class="p">)</span>
</pre></div>


<h3>Context</h3>
<p>To provide context that will be available in all templates rendered by your quickview, you can do this:</p>
<div class="codehilite"><pre>    <span class="k">class</span> <span class="nc">FriendView</span><span class="p">(</span><span class="n">ModelQuickView</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;debug&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">}</span>
</pre></div>


<p>If you need access to the request itself to produce the context you can override the get_context-method like so:</p>
<div class="codehilite"><pre>    <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">&#39;advanced_features_enabled&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">()}</span>
</pre></div>


<h3>Custom views</h3>
<p>To add custom views to your quickview do:</p>
<div class="codehilite"><pre>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">view_add_comment</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
            <span class="c"># process the comment stored in request.POST</span>
            <span class="c"># then return to the list</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;comment.html&#39;</span><span class="p">)</span>
</pre></div>


<p>This will add an add_comment-view to your app, available at for instance /friendslist/friend/add_comment/ in our example app.
It uses a utility function called render to produce the actual http-response. You can also provide more context:</p>
<div class="codehilite"><pre>    <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;comment.html&#39;</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="p">{</span> <span class="o">....</span> <span class="p">})</span>
</pre></div>


<h2>References</h2>
<ul>
<li>[1]: http://https://docs.djangoproject.com/en/1.3/ref/class-based-views/</li>
<li>[2]: http://knockoutjs.com</li>
<li>[3]: http://handlebarsjs.com</li>
<li>[4]: http://bootstrap.com</li>
</ul>
    </body>
    </html>