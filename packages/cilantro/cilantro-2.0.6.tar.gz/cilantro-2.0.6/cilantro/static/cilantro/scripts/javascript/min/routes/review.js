define("serrano/channels",[],function(){return{DATACONTEXT_CHANGED:"datacontext/changed",DATACONTEXT_SYNCING:"datacontext/syncing",DATACONTEXT_SYNCED:"datacontext/synced",DATACONTEXT_PAUSE:"datacontext/pause",DATACONTEXT_RESUME:"datacontext/resume",DATACONTEXT_ADD:"datacontext/add",DATACONTEXT_REMOVE:"datacontext/remove",DATACONTEXT_CLEAR:"datacontext/clear",DATACONTEXT_HISTORY:"datacontext/history",DATAVIEW_CHANGED:"dataview/changed",DATAVIEW_SYNCING:"dataview/syncing",DATAVIEW_SYNCED:"dataview/synced",DATAVIEW_PAUSE:"dataview/pause",DATAVIEW_RESUME:"dataview/resume",DATAVIEW_COLUMNS:"dataview/columns",DATAVIEW_ORDERING:"dataview/ordering",DATAVIEW_HISTORY:"dataview/history"}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("views/columns",["environ","mediator","jquery","underscore","backbone","serrano/channels"],function(e,t,n,r,i,s){var o;return o=function(e){function i(){return this.remove=__bind(this.remove,this),this.add=__bind(this.add,this),this.render=__bind(this.render,this),i.__super__.constructor.apply(this,arguments)}return __extends(i,e),i.prototype.template=r.template('            <div id=columns-modal class="modal fade">                <div class=modal-header>                    <a class=close data-dismiss=modal>Ã—</a>                    <h3>Data Columns</h3>                </div>                <div class=modal-body>                    <ul class="available-columns span5"></ul>                    <ul class="selected-columns span5"></ul>                </div>                <div class=modal-footer>                    <button data-save class="btn btn-primary">Save</button>                    <button data-close class=btn>Close</button>                </div>            </div>        '),i.prototype.availableItemTemplate=r.template('            <li data-id={{ id }}>                {{ name }}                <span class=controls>                    <button class="btn btn-success btn-mini">+</button>                </span>            </li>        '),i.prototype.selectedItemTemplate=r.template('            <li data-id={{ id }}>                {{ name }}                <span class=controls>                    <button class="btn btn-danger btn-mini">-</button>                </span>            </li>        '),i.prototype.events={"click [data-close]":"hide","click [data-save]":"save","click .available-columns button":"clickAdd","click .selected-columns button":"clickRemove"},i.prototype.deferred={add:!1,remove:!1},i.prototype.initialize=function(){var e=this;return i.__super__.initialize.apply(this,arguments),this.setElement(this.template()),this.$available=this.$(".available-columns"),this.$selected=this.$(".selected-columns").sortable({cursor:"move",forcePlaceholderSize:!0,placeholder:"placeholder"}),this.$el.addClass("loading"),this.collection.when(function(){return e.$el.removeClass("loading"),e.render(),e.resolve()}),t.subscribe(s.DATAVIEW_SYNCED,function(t){var n,r,i,s,o;if(t.isSession()&&(r=t.get("json"))){o=r.columns;for(i=0,s=o.length;i<s;i++)n=o[i],e.add(n)}})},i.prototype.render=function(){var e,t,n,r,i,s;e=[],n=[],s=this.collection.filter(function(e){return e.get("formatter_name")});for(r=0,i=s.length;r<i;r++)t=s[r],e.push(this.availableItemTemplate(t.attributes)),n.push(this.selectedItemTemplate(t.attributes));return this.$available.html(e.join("")),this.$selected.html(n.join("")),this},i.prototype.show=function(){return this.$el.modal("show")},i.prototype.hide=function(){return this.$el.modal("hide")},i.prototype.save=function(){var e;return this.hide(),e=n.map(this.$selected.children(),function(e){var t;if((t=n(e).data()).selected&&t.id)return t.id}),t.publish(s.DATAVIEW_COLUMNS,e)},i.prototype.add=function(e){return this.$available.find("[data-id="+e+"]").closest("li").hide(),this.$selected.find("[data-id="+e+"]").appendTo(this.$selected).show().data("selected",!0)},i.prototype.remove=function(e){return this.$selected.find("[data-id="+e+"]").hide().data("selected",!1),this.$available.find("[data-id="+e+"]").closest("li").show()},i.prototype.clickAdd=function(e){return e.preventDefault(),this.add(n(e.target).closest("li").data("id"))},i.prototype.clickRemove=function(e){return e.preventDefault(),this.remove(n(e.target).closest("li").data("id"))},i}(i.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("views/table",["environ","mediator","jquery","underscore","backbone"],function(e,t,n,r,i){var s;return s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.template=r.template('            <div id="report-container">                <div id="report-alert" class="alert alert-block">                    <h4 class="alert-heading" data-alert-heading></h4>                    <span data-alert-message></span>                </div>                <table id="report-table" class="table table-striped">                    <div class="pinned-thead"></div>                    <thead></thead>                    <tbody></tbody>                </table>            </div>        '),t.prototype.events={scroll:"togglePinnedThead","click tbody tr":"highlightRow"},t.prototype.initialize=function(){var e=this;return this.setElement(this.template()),this.$table=this.$("table"),this.$thead=this.$("thead"),this.$tbody=this.$("tbody"),this.$pinnedThead=this.$(".pinned-thead"),n(window).on("resize",function(){return e.resizePinnedThead(),e.resizeBody()})},t.prototype.setBody=function(e,t){var n,r,i,s,o,u,a,f;t==null&&(t=!1),r=[];for(s=0,u=e.length;s<u;s++){i=e[s],r.push("<tr>"),f=i.values;for(o=0,a=f.length;o<a;o++)n=f[o],n||(n="<span class=no-data>(no data)</span>"),r.push("<td>"+n+"</td>");r.push("</tr>")}return t?this.$tbody.append(r.join("")):this.$tbody.html(r.join("")),this.resizeBody(),this.resizePinnedThead()},t.prototype.setHeader=function(e){var t,r,i,s,o,u,a,f;i=[],s=[];for(a=0,f=e.length;a<f;a++)t=e[a],u=n("<th data-id="+t.id+">"+t.name+"</th>"),r=n("<div data-id="+t.id+">"+t.name+"</div>"),t.direction&&(t.direction==="desc"?(u.append(n("<i class=icon-chevron-down></i>")),r.append(n("<i class=icon-chevron-down></i>"))):(u.append(n("<i class=icon-chevron-up></i>")),r.append(n("<i class=icon-chevron-up></i>"))),u.data("direction",t.direction),u.addClass(t.direction),r.data("direction",t.direction),r.addClass(t.direction)),i.push(u),s.push(r);return this.$pinnedThead.empty(),this.$thead.html((o=n("<tr>")).append.apply(o,i)),this.$pinnedThead.append.apply(this.$pinnedThead,s)},t.prototype.resizePinnedThead=function(){var e,t=this;return e=this.$thead.width(),this.$thead.find("th").each(function(r,i){var s,o;return o=n(i),s=n(t.$pinnedThead.children()[r]),s.css("width",o.width()/e*100+"%")})},t.prototype.resizeBody=function(){return this.$table.height()>n("#main-area").height()?this.$el.removeClass("short"):this.$el.addClass("short")},t.prototype.togglePinnedThead=function(e){var t,n;t=this.$el.scrollTop(),n=this.$pinnedThead.is(":visible");if(t<=0&&n)return this.$pinnedThead.hide();if(!n)return this.$pinnedThead.show()},t.prototype.highlightRow=function(e){var t;return t=n(e.target).parent(),t.toggleClass("highlight")},t}(i.View),s});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("routes/review",["environ","mediator","jquery","underscore","backbone","serrano/channels","views/columns","views/table"],function(e,t,n,r,i,s,o,u){var a,f;return f=r.template('<button class=btn title="Show/Hide Columns"><i class=icon-list alt="Show/Hide Columns"></i></button>'),a=function(e){function r(){return this.loadData=__bind(this.loadData,this),r.__super__.constructor.apply(this,arguments)}return __extends(r,e),r.prototype.id="review-area",r.prototype.options={perPage:100},r.prototype.events={"click table thead th":"sort","click .pinned-thead div":"sort"},r.prototype.deferred={loadData:!0},r.prototype.initialize=function(){var e,i=this;return r.__super__.initialize.apply(this,arguments),this.$el.hide().appendTo("#main-area .inner"),this.$toolbar=n("<ul>").addClass("nav pull-right").hide().appendTo("#subnav .container-fluid"),this.columns=new o({collection:App.DataConcept}),this.columns.$el.appendTo("body"),e=n(f()).on("click",function(e){return i.columns.show()}),this.$toolbar.append(n("<li>").html(e)),this.table=new u,this.$el.append(this.table.el),this.table.$("#report-table").scroller({autofill:!0,container:this.table.$el,trigger:function(){return i.loadData(!0)}}),t.subscribe(s.DATAVIEW_SYNCED,function(){return i.loadData()}),t.subscribe(s.DATACONTEXT_SYNCED,function(){return i.loadData()}),this.page=1,this.perPage=this.options.perPage,this.loadData()},r.prototype.load=function(){this.$el.fadeIn(100),this.$toolbar.fadeIn(100);if(this.tableScrollTop)return this.table.$el.scrollTop(this.tableScrollTop)},r.prototype.unload=function(){return this.tableScrollTop=this.table.$el.scrollTop(),this.$el.hide(),this.$toolbar.hide()},r.prototype.loadData=function(e){var t,n=this;e==null&&(e=!1);if(e&&this.page===this.numPages)return;return t=""+App.urls.preview+"?per_page="+this.perPage,e?t=""+t+"&page="+(this.page+1):this.table.$el.addClass("loading"),i.ajax({url:t,success:function(t){return e?n.page++:(n.page=1,n.numPages=t.num_pages,n.table.setHeader(t.keys)),n.table.setBody(t.objects,e)},complete:function(){return n.table.$el.removeClass("loading"),n.table.$("#report-table").scroller("reset")}})},r.prototype.sort=function(e){var r,i,o,u;return r=n(e.target),(u=r.data("direction"))?u==="asc"?i="desc":i=null:i="asc",r.data("direction",i),r.removeClass(u).addClass(i),i?o=[[r.data("id"),i]]:o=[],t.publish(s.DATAVIEW_ORDERING,o)},r}(i.View)});