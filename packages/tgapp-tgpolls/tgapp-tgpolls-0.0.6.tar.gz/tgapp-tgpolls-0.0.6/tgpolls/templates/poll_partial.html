<div xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">
    <h3 class="tgpolls_poll_title">${poll.body}</h3>
    <ul class="tgpolls_poll_answers_container">
        <li class="tgpolls_poll_answer" py:for="answer in poll.answers">
            <input type="checkbox" name="${poll.uid}" value="${answer.uid}">
                ${answer.text}
            </input>
            Votes: <span>${answer.votes or '0'}</span>
        </li>
    </ul>
    <a py:if="not poll.expired" href="#" id="vote_for_poll_${poll.uid}" class="btn btn-primary ${'disabled' if 'poll_%s' % poll.uid in tg.session else ''}">VOTE</a>
    <a py:if="request.identity and 'managers' in request.identity['groups']" href="${h.plug_url('tgpolls', '/delete?poll_uid=%s' % poll.uid)}"
       onclick="if (!confirm('${_('Do you really want delete this poll?')}')) return false;" 
       id="delete_for_poll_${poll.uid}" class="delete_poll_btn btn btn-primary">
       DELETE
    </a>
    <script py:if="not poll.expired">
        jQuery('#vote_for_poll_${poll.uid}').click(function() {
            if (jQuery(this).hasClass('disabled')) return false;
            var votes = jQuery.map(jQuery('input:checkbox:checked[name=${poll.uid}]'), function(e,i) {
                var vote = jQuery(e).siblings('span');
                vote.html(parseInt(vote.html()) + 1);
                return +e.value;
            });
            jQuery.get("${h.plug_url('tgpolls', '/vote')}", { poll_uid: "${poll.uid}", votes: votes });
            jQuery(this).addClass('disabled');
        });
    </script>
</div>
