

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pysyncml.context &mdash; pysyncml 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/theme_extras.js"></script>
    <link rel="top" title="pysyncml 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../index.html">
          <span>pysyncml 0.1 documentation</span></a></h1>
        <h2 class="heading"><span>pysyncml.context</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for pysyncml.context</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># file: $Id: context.py 53 2012-08-28 06:11:48Z griff1n $</span>
<span class="c"># lib:  pysyncml.context</span>
<span class="c"># auth: griffin &lt;griffin@uberdev.org&gt;</span>
<span class="c"># date: 2012/06/23</span>
<span class="c"># copy: (C) CopyLoose 2012 UberDev &lt;hardcore@uberdev.org&gt;, No Rights Reserved.</span>
<span class="c">#------------------------------------------------------------------------------</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">The ``pysyncml.context`` package provides the entry point into most</span>
<span class="sd">pysyncml operations via the :class:`pysyncml.Context</span>
<span class="sd">&lt;pysyncml.context.Context&gt;` class.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">sqlalchemy.ext.declarative</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm.exc</span> <span class="kn">import</span> <span class="n">NoResultFound</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">model</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">router</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">synchronizer</span>

<span class="c">#------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Context"><a class="viewcode-back" href="../../pysyncml/context.html#pysyncml.context.Context">[docs]</a><span class="k">class</span> <span class="nc">Context</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  The pysyncml Context object creates an environment for an Adapter to</span>
<span class="sd">  be created and evaluated in. The primary object is to provide access</span>
<span class="sd">  to a storage location so that SyncML state information can be stored</span>
<span class="sd">  across multiple synchronization messages, sessions and</span>
<span class="sd">  peers. However, it can also be used to specify operational</span>
<span class="sd">  parameters, such as whether or not to support specific codecs and</span>
<span class="sd">  which to use as the default.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="c">#----------------------------------------------------------------------------</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">engine</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;pysyncml&#39;</span><span class="p">,</span> <span class="n">owner</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">autoCommit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">router</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">synchronizer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The Context constructor accepts the following parameters, of which</span>
<span class="sd">    all are optional:</span>

<span class="sd">    :param owner:</span>

<span class="sd">      an integer owner ID. Necessary primarily when the adapter</span>
<span class="sd">      storage is shared between multiple users/adapter agents</span>
<span class="sd">      (i.e. in server contexts). If it is not shared, `owner` can be</span>
<span class="sd">      left as ``None`` (the default).</span>

<span class="sd">    :param storage:</span>

<span class="sd">      the sqlalchemy storage specification where all the SyncML-</span>
<span class="sd">      related data should be stored.</span>

<span class="sd">      NOTE: can be overridden by parameter `engine`.</span>

<span class="sd">      NOTE: the storage driver **MUST** support cascading deletes;</span>
<span class="sd">      this is done automatically for connections created directly by</span>
<span class="sd">      pysyncml for mySQL and sqlite, but it is up to the calling</span>
<span class="sd">      program to ensure this for other databases or if the database</span>
<span class="sd">      engine is passed in via parameter `engine`. Specifically, when</span>
<span class="sd">      pysyncml creates the sqlalchemy engine (i.e. by calling</span>
<span class="sd">      ``sqlalchemy.create_engine(storage)``), then InnoDB is requested</span>
<span class="sd">      for mySQL tables and ``PRAGMA foreign_keys=ON`` is issued for</span>
<span class="sd">      sqlite databases. pysyncml provides a helper function to ensure</span>
<span class="sd">      that sqlite databases have cascading deletes enabled::</span>

<span class="sd">        import sqlalchemy, pysyncml</span>
<span class="sd">        db = sqlalchemy.create_engine(...)</span>
<span class="sd">        pysyncml.enableSqliteCascadingDeletes(db)</span>

<span class="sd">    :param engine:</span>

<span class="sd">      the sqlalchemy storage engine where all the SyncML-related</span>
<span class="sd">      data should be stored.</span>

<span class="sd">      NOTE: overrides parameter `storage`.</span>

<span class="sd">      NOTE: see notes under parameter `storage` for details on</span>
<span class="sd">      cascading delete support.</span>

<span class="sd">      TODO: it would be great to add a check to ensure that provided</span>
<span class="sd">      storage engines have cascading deletes enabled.</span>

<span class="sd">    :param prefix:</span>

<span class="sd">      sets a database table name prefix. This is primarily useful when</span>
<span class="sd">      using the `engine` parameter, as multiple pysyncml contexts can</span>
<span class="sd">      then be defined within the same database namespace. Defaults to</span>
<span class="sd">      ``pysyncml``.</span>

<span class="sd">    :param autoCommit:</span>

<span class="sd">      whether or not to execute a storage engine &quot;commit&quot; when syncing</span>
<span class="sd">      is complete. The default behavior is dependent on if `engine` is</span>
<span class="sd">      provided: if not ``None``, then `autoCommit` defaults to</span>
<span class="sd">      ``False``, otherwise, defaults to ``True``.</span>

<span class="sd">    :param router:</span>

<span class="sd">      overrides the default router with an object that must implement</span>
<span class="sd">      the interface specified by :class:`pysyncml.router.Router`.</span>

<span class="sd">    :param protocol:</span>

<span class="sd">      sets the semantic objective to/from protocol evaluation and</span>
<span class="sd">      resolution object, which must implement the</span>
<span class="sd">      :class:`pysyncml.protocol.Protocol` interface.</span>

<span class="sd">    :param synchronizer:</span>

<span class="sd">      this is the engine for handling sync requests and dispatching</span>
<span class="sd">      them to the various agents. If specified, the object must</span>
<span class="sd">      implement the :class:`pysyncml.synchronizer.Synchronizer`</span>
<span class="sd">      interface.</span>

<span class="sd">    :param codec:</span>

<span class="sd">      specify the codec used to encode the SyncML commands - typically</span>
<span class="sd">      either ``\&#39;xml\&#39;`` (the default) or ``\&#39;wbxml\&#39;``. It can also</span>
<span class="sd">      be an object that implements the :class:`pysyncml.codec.Codec`</span>
<span class="sd">      interface.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoCommit</span> <span class="o">=</span> <span class="n">autoCommit</span> <span class="k">if</span> <span class="n">autoCommit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">engine</span> <span class="ow">is</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">createModel</span><span class="p">(</span>
      <span class="n">engine</span>     <span class="o">=</span> <span class="n">engine</span><span class="p">,</span>
      <span class="n">storage</span>    <span class="o">=</span> <span class="n">storage</span><span class="p">,</span>
      <span class="n">prefix</span>     <span class="o">=</span> <span class="n">prefix</span><span class="p">,</span>
      <span class="n">owner_id</span>   <span class="o">=</span> <span class="n">owner</span><span class="p">,</span>
      <span class="n">context</span>    <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
      <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">router</span>       <span class="o">=</span> <span class="n">router</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span>     <span class="o">=</span> <span class="n">protocol</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">synchronizer</span> <span class="o">=</span> <span class="n">synchronizer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">codec</span>        <span class="o">=</span> <span class="n">codec</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;DatabaseObject&#39;</span><span class="p">,</span> <span class="s">&#39;RawDatabaseObject&#39;</span><span class="p">,</span> <span class="s">&#39;Version&#39;</span><span class="p">,</span> <span class="s">&#39;Adapter&#39;</span><span class="p">):</span>
        <span class="k">continue</span>
      <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">declarative</span><span class="o">.</span><span class="n">DeclarativeMeta</span><span class="p">)</span> \
         <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">DatabaseObject</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

  <span class="c">#----------------------------------------------------------------------------</span>
  <span class="c"># TODO: add a method to delete all entries with a specific owner...</span>
  <span class="c">#----------------------------------------------------------------------------</span>

  <span class="c">#----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Context.Adapter"><a class="viewcode-back" href="../../pysyncml/context.html#pysyncml.context.Context.Adapter">[docs]</a>  <span class="k">def</span> <span class="nf">Adapter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. TODO:: move this documentation into model/adapter.py?...</span>

<span class="sd">    The Adapter constructor supports the following parameters:</span>

<span class="sd">    :param devID:</span>

<span class="sd">      sets the local adapter\&#39;s device identifier. For servers, this</span>
<span class="sd">      should be the externally accessible URL that launches the SyncML</span>
<span class="sd">      transaction, and for clients this should be a unique ID, such as</span>
<span class="sd">      the IMEI number (for mobile phones). If not specified, it will</span>
<span class="sd">      be defaulted to the `devID` of the `devinfo` object. If it</span>
<span class="sd">      cannot be loaded from the database or from the `devinfo`, then</span>
<span class="sd">      it must be provided before any synchronization can begin.</span>

<span class="sd">    :param name:</span>

<span class="sd">      sets the local adapter\&#39;s device name - usually a human-friendly</span>
<span class="sd">      description of this SyncML\&#39;s function.</span>

<span class="sd">    :param devinfo:</span>

<span class="sd">      sets the local adapter :class:`pysyncml.devinfo.DeviceInfo`.  If</span>
<span class="sd">      not specified, it will be auto-loaded from the database. If it</span>
<span class="sd">      cannot be loaded from the database, then it must be provided</span>
<span class="sd">      before any synchronization can begin.</span>

<span class="sd">    :param peer:</span>

<span class="sd">      TODO: document...</span>

<span class="sd">    :param maxGuidSize:</span>

<span class="sd">      TODO: document...</span>

<span class="sd">    :param maxMsgSize:</span>

<span class="sd">      TODO: document...</span>

<span class="sd">    :param maxObjSize:</span>

<span class="sd">      TODO: document...</span>

<span class="sd">    :param conflictPolicy:</span>

<span class="sd">      sets the default conflict handling policy for this adapter,</span>
<span class="sd">      and can be overriden on a per-store basis (applies only when</span>
<span class="sd">      operating as the server role).</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">Adapter</span><span class="o">.</span><span class="n">q</span><span class="p">(</span><span class="n">isLocal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">NoResultFound</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">Adapter</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
      <span class="n">ret</span><span class="o">.</span><span class="n">isLocal</span> <span class="o">=</span> <span class="bp">True</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">devID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">ret</span><span class="o">.</span><span class="n">context</span>       <span class="o">=</span> <span class="bp">self</span>
    <span class="c"># todo: is this really the best place to do this?...</span>
    <span class="n">ret</span><span class="o">.</span><span class="n">router</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span> <span class="ow">or</span> <span class="n">router</span><span class="o">.</span><span class="n">Router</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
    <span class="n">ret</span><span class="o">.</span><span class="n">protocol</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="ow">or</span> <span class="n">protocol</span><span class="o">.</span><span class="n">Protocol</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
    <span class="n">ret</span><span class="o">.</span><span class="n">synchronizer</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">synchronizer</span> <span class="ow">or</span> <span class="n">synchronizer</span><span class="o">.</span><span class="n">Synchronizer</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
    <span class="n">ret</span><span class="o">.</span><span class="n">codec</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec</span> <span class="ow">or</span> <span class="s">&#39;xml&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">codec</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
      <span class="n">ret</span><span class="o">.</span><span class="n">codec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="n">Codec</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">codec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">devID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">peers</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">getKnownPeers</span><span class="p">()</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">peers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">_peer</span> <span class="o">=</span> <span class="n">peers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ret</span>

  <span class="c">#----------------------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Context.RemoteAdapter"><a class="viewcode-back" href="../../pysyncml/context.html#pysyncml.context.Context.RemoteAdapter">[docs]</a>  <span class="k">def</span> <span class="nf">RemoteAdapter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. TODO:: move this documentation into model/adapter.py?...</span>

<span class="sd">    The RemoteAdapter constructor supports the following parameters:</span>

<span class="sd">    :param url:</span>

<span class="sd">      specifies the URL that this remote SyncML server can be reached</span>
<span class="sd">      at. The URL must be a fully-qualified URL.</span>

<span class="sd">    :param auth:</span>

<span class="sd">      set what kind of authentication scheme to use, which generally is</span>
<span class="sd">      one of the following values:</span>

<span class="sd">        **None**:</span>

<span class="sd">          indicates no authentication is required.</span>

<span class="sd">        **pysyncml.NAMESPACE_AUTH_BASIC**:</span>

<span class="sd">          specifies to use &quot;Basic-Auth&quot; authentication scheme.</span>

<span class="sd">        **pysyncml.NAMESPACE_AUTH_MD5**:</span>

<span class="sd">          specifies to use MD5 &quot;Digest-Auth&quot; authentication scheme.</span>
<span class="sd">          NOTE: this may not be implemented yet...</span>

<span class="sd">    :param username:</span>

<span class="sd">      if the `auth` is not ``None``, then the username to authenticate</span>
<span class="sd">      as must be provided via this parameter.</span>

<span class="sd">    :param password:</span>

<span class="sd">      if the `auth` is not ``None``, then the password to authenticate</span>
<span class="sd">      with must be provided via this parameter.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># TODO: is this really the right way?...</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">Adapter</span><span class="p">(</span><span class="n">isLocal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">devID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ret</span>

  <span class="c">#----------------------------------------------------------------------------</span></div>
  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">getAuthInfo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">authorizer</span><span class="p">):</span>
    <span class="n">xtree</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="n">Codec</span><span class="o">.</span><span class="n">autoDecode</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">protocol</span><span class="o">.</span><span class="n">Protocol</span><span class="o">.</span><span class="n">getAuthInfo</span><span class="p">(</span><span class="n">xtree</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">authorizer</span><span class="p">)</span>

  <span class="c">#----------------------------------------------------------------------------</span>
  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">getTargetID</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">xtree</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="n">Codec</span><span class="o">.</span><span class="n">autoDecode</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">protocol</span><span class="o">.</span><span class="n">Protocol</span><span class="o">.</span><span class="n">getTargetID</span><span class="p">(</span><span class="n">xtree</span><span class="p">)</span>

  <span class="c">#----------------------------------------------------------------------------</span>
  <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># TODO: is this just here for the test classes?... might this be better</span>
    <span class="c">#       marked as an internal method?...</span>
    <span class="c"># todo: is the &quot;flush&quot; really necessary?...</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoCommit</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># end of $Id: context.py 53 2012-08-28 06:11:48Z griff1n $</span>
<span class="c">#------------------------------------------------------------------------------</span></div>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012-2012, UberDev, No Rights Reserved.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>