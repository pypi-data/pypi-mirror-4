<input type="text"
       name="${field.name}"
       value="${cstruct}"
       id="${field.oid}"/>
<script type="text/javascript">
  $(function() {

    var displayParents = function() {
      // initialize array
      var labels = [];
      $(this)
        // find all select
        .siblings('select')
        // and their current options
        .find(':selected')
        .each(function() {
          // and add option text to array
          labels.push($(this).text());
        });
      $('')
        .text(this.value + ':' + labels.join(' > '))
        // and display the labels
        .appendTo('#${field.oid}-result');
    }

    function preselectedArray(str) {
      var values = str.split('');
      var value = '';
      var preselect = [];
      for (var i = 0; i < values.length; i++) {
        value = value + values[i];
        preselect.push(value)
      }
      return preselect;
    }

    $.getJSON(
      "${field.widget.json_url}",
      function(tree) {
        var options = {
          empty_value: '',
          indexed: true,
          on_each_change: "${field.widget.json_url}",
          set_value_on: 'each',
          choose: ' ',
          // array of default values
          // if on any level option value will be in this list, it will be selected
          // be careful of variable types - '111' !== 111
          preselect: {
            '${field.name}': preselectedArray('${cstruct}')
          },
          // prevent auto selecting whole branch when user maniputales one of branch levels
          preselect_only_once: true,
          get_parent_value_if_empty: true,
          // we'll use input id instead of name
          attr: "id"
        };
        $('#${field.oid}').optionTree(tree, options).change(displayParents);
      }
    );
});

</script>
