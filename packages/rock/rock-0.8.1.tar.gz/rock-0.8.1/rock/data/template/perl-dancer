if [[ -z $ROCK_NAME || $ROCK_NAME == 1 ]]; then
  die 'name required (ex: --name=Sample::App)'
fi

cat << EOF > .rock.yml
runtime: ${ROCK_RUNTIME-perl516}

run: app.pl
EOF

cat << EOF > cpanfile
requires 'Dancer';
requires 'YAML';
EOF

rock build

name="$( echo $ROCK_NAME | sed 's|::|-|g' )"

rock run dancer -x -a "$ROCK_NAME" | \
  sed "s|${name}/||g" | \
  grep -v "+ ${name}"

shopt -s dotglob

mv ${name}/* .

rmdir $name
