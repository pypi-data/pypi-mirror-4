<div metal:define-macro="portlet" tal:omit-tag="">

    <tal:block>

        <dl id="category-selector" class="portlet">

            <dt class="portletHeader" tal:content="view/Portlet_title">Tag Portlet</dt>
            
            <div class="cn-description" tal:content="view/Description">
                description
            </div>

            <dd class="portletItemSingle odd" tal:define="selectedCategories request/Subject | nothing;
                                                          portal context/@@plone_portal_state/portal;">
                <div tal:condition="view/vtcExists" class="" tal:attributes="class python:'tagNavigator ' + 'collapse_' + str(view.Collapse)">
                    <ul>
                         <li tal:repeat="vtcCat python:view.getVTCategories('/')">
                                 <div class="cn-category-title" tal:content="python: vtcCat.title">
                                     category
                                 </div>                 
                                <ul tal:condition="python:len(view.getVTCategories('/'+vtcCat.id)) > 0" class="subcategory">
                                    <li tal:repeat="sub_cat python:view.getVTCategories('/'+vtcCat.id)">
                                        <div class="cn-category-title" tal:content="python:view.Collapse < 2 and '- ' + sub_cat.title or '+ ' + sub_cat.title">
                                            sub-category
                                        </div>  
                                        <ul>
                                            <li class="nc-category" tal:attributes="class python:selectedCategories is not None and cat in selectedCategories and 'nc-category nc-category_selected' or 'nc-category'" tal:repeat="cat sub_cat/keywords">
                                                <a href="" tal:attributes="href python:selectedCategories is not None and cat in selectedCategories and context.absolute_url() + view.generateQueryString([], subtracting=cat) or context.absolute_url() + view.generateQueryString([], adding=cat)">
                                                    <span tal:condition="python:selectedCategories is not None and cat in selectedCategories" tal:omit-tag="">
                                                        &gt;
                                                    </span>
                                                    <span tal:condition="python:selectedCategories is None or cat not in selectedCategories" tal:omit-tag="">
                                                           +
                                                    </span>
                                                    <span tal:content="cat">
                                                        category
                                                    </span>
                                                </a>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                                <ul>
                                    <li class="nc-category" tal:attributes="class python:selectedCategories is not None and cat in selectedCategories and 'nc-category nc-category_selected' or 'nc-category'" tal:repeat="cat vtcCat/keywords">
                                        <a href="" tal:attributes="href python:selectedCategories is not None and cat in selectedCategories and context.absolute_url() + view.generateQueryString([], subtracting=cat) or context.absolute_url() + view.generateQueryString([], adding=cat)">
                                            <span tal:condition="python:selectedCategories is not None and cat in selectedCategories" tal:omit-tag="">
                                                &gt;
                                            </span>
                                            <span tal:condition="python:selectedCategories is None or cat not in selectedCategories" tal:omit-tag="">
                                                   +
                                            </span>
                                            <span tal:content="cat">
                                                category
                                            </span>
                                        </a>
                                    </li>
                                </ul>
                         </li>
                    </ul>
                 </div>
                 
                 <div tal:condition="not: view/vtcExists">
                    <ul>
                         <li tal:repeat="cat view/getSiteCategoriesAsList" tal:attributes="class python:selectedCategories is not None and cat in selectedCategories and 'nc-category nc-category_selected' or 'nc-category'">
                            <a href="" tal:attributes="href python:selectedCategories is not None and cat in selectedCategories and context.absolute_url() + view.generateQueryString([], subtracting=cat) or context.absolute_url() + view.generateQueryString([], adding=cat)">
                                <span tal:condition="python:selectedCategories is not None and cat in selectedCategories" tal:omit-tag="">
                                    &gt;
                                </span>
                                <span tal:condition="python:selectedCategories is None or cat not in selectedCategories" tal:omit-tag="">
                                       +
                                </span>
                                <span tal:content="cat">
                                    category
                                </span>
                             </a>
                         </li>
                    </ul>
                 </div>
            </dd>

        </dl>

    </tal:block>

</div>