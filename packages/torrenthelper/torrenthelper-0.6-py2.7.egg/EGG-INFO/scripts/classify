#!/usr/bin/python
import sys
sys.path.append("..")

from torrenthelper.classify import classify
from torrenthelper import Config

from optparse import OptionParser

parser = OptionParser()
parser.add_option("-P", "--pretend", help="Just pretend", default=False, action="store_true")
parser.add_option("-v", "--verbose", help="Be verbose",   default=False, action="store_true")
parser.add_option("-H", "--host",   help="Transmission host:port", default="localhost:9091")
parser.add_option("-a", "--auth",   help="Transmission authentication", default="admin:tradmin")

(options, args) = parser.parse_args()

config = Config()
config.pretend = options.pretend
config.verbose = options.verbose

config.incomingdir = "/data/Incoming/"
config.folders['music']   =  "/data/Music/INCOMING/"
config.folders['movies']  = "/data/Movies/"
config.folders['tvshows'] = "/data/Series/"

files = [s.strip() for s in sys.stdin.readlines()]

classes = classify(files, "")

for cls in classes:
    print cls
    clsActions = config.get_actions(cls)
    try:
        for a in clsActions:
            a.process()
    except OSError, e:
        print "*** OS Error:", e
    
