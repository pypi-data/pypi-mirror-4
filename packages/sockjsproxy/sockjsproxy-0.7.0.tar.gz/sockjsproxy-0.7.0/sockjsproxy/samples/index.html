<!DOCTYPE html>

<html>
<head>
    <title>sockjsproxy</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <script type="text/javascript" src="js/sockjs-0.3.js"></script>
    <script type="text/javascript" src="js/jquery-1.8.3.js"></script>
    <script type="text/javascript">
        $(function () {
            var $log = $('#log');
            var log = function (message) {
                if (console && console.log) {
                    console.log(message);
                }
                $log.append($('<li></li>').text(message))
            }

            var State = {
                isConnected: false,
                connected: function () {
                    this.isConnected = true;
                    $('#connect').attr('disabled', true);
                    $('#disconnect').attr('disabled', false);
                    $('#send').attr('disabled', false);
                    $('#status').html("Connected");

                },

                disconnected: function () {
                    this.isConnected = false;
                    $('#connect').attr('disabled', false);
                    $('#disconnect').attr('disabled', true);
                    $('#send').attr('disabled', true);
                    $('#status').html("Disconnected");
                }
            };

            var Connection = {
                socket: null,
                connect: function () {
                    var socket = this.socket = new SockJS(location.protocol + '//' + location.host + '/');
                    socket.onopen = function () {
                        log('Connection opened');
                        log('Sending: echo');
                        socket.send("echo");
                        State.connected();
                    };
                    socket.onmessage = function (e) {
                        log('Recieved: ' + e.data);
                    }
                    socket.onclose = function () {
                        log('Connection closed');
                        State.disconnected();
                    }
                },
                disconnect: function () {
                    if (this.socket) {
                        this.socket.close()
                        this.socket = null;
                    }
                },
                send: function (message) {
                    log("Sending: " + message)
                    this.socket.send(message);
                }
            }


            var $message = $('#message')
            $('#send-form').submit(function (e) {
                Connection.send($message.val());
                e.preventDefault();
            });

            $('#connect').click(function (e) {
                Connection.connect();
                e.preventDefault();
            });

            $('#disconnect').click(function (e) {
                Connection.disconnect();
                e.preventDefault();
            });

        });
    </script>

</head>
<body>
<h1>Wellcome to sockjsproxy server</h1>

<p>If you are seeing this it seems the server is working.</p>

<p id="status">Disconnected</p>

<form action="" id="send-form">
    <input type="text" id="message">
    <input type="submit" value="Send" id="send">
</form>

<button id="connect">Connect</button>
<button id="disconnect">Disconnect</button>

<ul id="log"></ul>
</body>
</html>