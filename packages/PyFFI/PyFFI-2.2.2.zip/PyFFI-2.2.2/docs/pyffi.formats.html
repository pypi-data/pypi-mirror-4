

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyffi.formats — File format interfaces &mdash; PyFFI 2.2.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PyFFI 2.2.2 documentation" href="index.html" />
    <link rel="up" title="pyffi — Interfacing block structured files" href="pyffi.html" />
    <link rel="next" title="pyffi.formats.bsa — Bethesda Archive (.bsa)" href="pyffi.formats.bsa.html" />
    <link rel="prev" title="pyffi — Interfacing block structured files" href="pyffi.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pyffi.formats.bsa.html" title="pyffi.formats.bsa — Bethesda Archive (.bsa)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pyffi.html" title="pyffi — Interfacing block structured files"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PyFFI 2.2.2 documentation</a> &raquo;</li>
          <li><a href="pyffi.html" accesskey="U"><tt class="docutils literal docutils literal docutils literal docutils literal"><span class="pre">pyffi</span></tt> &#8212; Interfacing block structured files</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="module-pyffi.formats"></span><div class="section" id="pyffi-formats-file-format-interfaces">
<h1><a class="reference internal" href="#module-pyffi.formats" title="pyffi.formats"><tt class="xref py py-mod docutils literal"><span class="pre">pyffi.formats</span></tt></a> &#8212; File format interfaces<a class="headerlink" href="#pyffi-formats-file-format-interfaces" title="Permalink to this headline">¶</a></h1>
<p>When experimenting with any of the supported file formats, you can specify
an alternate location where you store your modified format description by means
of an environment variable. For instance,
to tell the library to use your version of <tt class="file docutils literal"><span class="pre">cgf.xml</span></tt>,
set the <span class="target" id="index-0"></span><tt class="xref std std-envvar docutils literal"><span class="pre">CGFXMLPATH</span></tt> environment variable to the directory where
<tt class="file docutils literal"><span class="pre">cgf.xml</span></tt> can be found. The environment variables <span class="target" id="index-1"></span><tt class="xref std std-envvar docutils literal"><span class="pre">NIFXMLPATH</span></tt>,
<span class="target" id="index-2"></span><tt class="xref std std-envvar docutils literal"><span class="pre">KFMXMLPATH</span></tt>, <span class="target" id="index-3"></span><tt class="xref std std-envvar docutils literal"><span class="pre">DDSXMLPATH</span></tt>, and <span class="target" id="index-4"></span><tt class="xref std std-envvar docutils literal"><span class="pre">TGAXMLPATH</span></tt>
work similarly.</p>
<div class="section" id="supported-formats">
<h2>Supported formats<a class="headerlink" href="#supported-formats" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="pyffi.formats.bsa.html"><tt class="docutils literal"><span class="pre">pyffi.formats.bsa</span></tt> &#8212; Bethesda Archive (.bsa)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.bsa.html#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.bsa.html#regression-tests">Regression tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyffi.formats.cgf.html"><tt class="docutils literal"><span class="pre">pyffi.formats.cgf</span></tt> &#8212; Crytek (.cgf and .cga)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.cgf.html#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.cgf.html#regression-tests">Regression tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyffi.formats.dae.html"><tt class="docutils literal"><span class="pre">pyffi.formats.dae</span></tt> &#8212; COLLADA (.dae)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.dae.html#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.dae.html#regression-tests">Regression tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyffi.formats.dds.html"><tt class="docutils literal"><span class="pre">pyffi.formats.dds</span></tt> &#8212; DirectDraw Surface (.dds)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.dds.html#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.dds.html#regression-tests">Regression tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyffi.formats.egm.html"><tt class="docutils literal"><span class="pre">pyffi.formats.egm</span></tt> &#8212; EGM (.egm)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.egm.html#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.egm.html#regression-tests">Regression tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyffi.formats.kfm.html"><tt class="docutils literal"><span class="pre">pyffi.formats.kfm</span></tt> &#8212; NetImmerse/Gamebryo Keyframe Motion (.kfm)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.kfm.html#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.kfm.html#regression-tests">Regression tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyffi.formats.nif.html"><tt class="docutils literal"><span class="pre">pyffi.formats.nif</span></tt> &#8212; NetImmerse/Gamebryo (.nif and .kf)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.nif.html#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.nif.html#regression-tests">Regression tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyffi.formats.tga.html"><tt class="docutils literal"><span class="pre">pyffi.formats.tga</span></tt> &#8212; Targa (.tga)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.tga.html#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.tga.html#regression-tests">Regression tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyffi.formats.tri.html"><tt class="docutils literal"><span class="pre">pyffi.formats.tri</span></tt> &#8212; TRI (.tri)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.tri.html#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyffi.formats.tri.html#regression-tests">Regression tests</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="adding-new-formats">
<h2>Adding new formats<a class="headerlink" href="#adding-new-formats" title="Permalink to this headline">¶</a></h2>
<p>This section tries to explain how you can implement your own format in pyffi.</p>
<div class="section" id="getting-started">
<h3>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<p>Note that the files which make up the following example can all be found in
the examples/simple directory of the source distribution of pyffi.</p>
<p>Suppose you have a simple file format, which consists of an integer,
followed by a list of integers as many as described by the first
integer. We start by creating an XML file, call it <tt class="file docutils literal"><span class="pre">simple.xml</span></tt>,
which describes this format in a way that pyffi can understand:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE fileformat&gt;</span>
<span class="nt">&lt;fileformat</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;basic</span> <span class="na">name=</span><span class="s">&quot;Int&quot;</span><span class="nt">&gt;</span>A signed 32-bit integer.<span class="nt">&lt;/basic&gt;</span>
    <span class="nt">&lt;struct</span> <span class="na">name=</span><span class="s">&quot;Example&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;Num Integers&quot;</span> <span class="na">type=</span><span class="s">&quot;Int&quot;</span><span class="nt">&gt;</span>
            Number of integers that follow.
        <span class="nt">&lt;/add&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;Integers&quot;</span> <span class="na">type=</span><span class="s">&quot;Int&quot;</span> <span class="na">arr1=</span><span class="s">&quot;Num Integers&quot;</span><span class="nt">&gt;</span>
            A list of integers.
        <span class="nt">&lt;/add&gt;</span>
    <span class="nt">&lt;/struct&gt;</span>
<span class="nt">&lt;/fileformat&gt;</span>
</pre></div>
</div>
<p>What pyffi does is convert this simple XML description into Python classes
which automatically can read and write the structure you&#8217;ve just described.
Say this is the contents of <tt class="file docutils literal"><span class="pre">simple.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pyffi.object_models.xml</span>
<span class="kn">import</span> <span class="nn">pyffi.object_models.common</span>

<span class="k">class</span> <span class="nc">SimpleFormat</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">FileFormat</span><span class="p">):</span>
    <span class="n">xml_file_name</span> <span class="o">=</span> <span class="s">&#39;simple.xml&#39;</span>
    <span class="n">xml_file_path</span> <span class="o">=</span> <span class="p">[</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span> <span class="p">]</span>

    <span class="c"># basic types</span>

    <span class="n">Int</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Int</span>

    <span class="c"># extensions of generated types</span>

    <span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">FileFormat</span><span class="o">.</span><span class="n">Data</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">example</span> <span class="o">=</span> <span class="n">SimpleFormat</span><span class="o">.</span><span class="n">Example</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Example</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">addInteger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numIntegers</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">integers</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">integers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">numIntegers</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>
</div>
<p>What happens in this piece of code?</p>
<blockquote>
<div><ul class="simple">
<li>The <tt class="xref py py-class docutils literal"><span class="pre">pyffi.object_models.xml.FileFormat</span></tt>
base class triggers the transformation of xml into Python classes;
how these classes can be used will be explained further.</li>
<li>The <tt class="xref py py-attr docutils literal"><span class="pre">xml_file_name</span></tt>
class attribute provides the name of the xml file that describes
the structures we wish to generate. The
<tt class="xref py py-attr docutils literal"><span class="pre">xml_file_path</span></tt>
attribute gives a list of locations of where to look for this
file; in our case we have simply chosen to put <tt class="file docutils literal"><span class="pre">simple.xml</span></tt>
in the same directory as <tt class="file docutils literal"><span class="pre">simple.py</span></tt>.</li>
<li>The <tt class="xref py py-class docutils literal"><span class="pre">SimpleFormat.Example</span></tt> class
provides the generated class with a function <tt class="xref py py-meth docutils literal"><span class="pre">addInteger()</span></tt> in
addition to the attributes <tt class="xref py py-attr docutils literal"><span class="pre">numIntegers</span></tt> and
<tt class="xref py py-attr docutils literal"><span class="pre">integers</span></tt> which have been created from the XML.</li>
<li>Finally, the <tt class="xref py py-mod docutils literal"><span class="pre">pyffi.object_models.common</span></tt> module implements
the most common basic types, such as integers, characters, and
floats. In the above example we have taken advantage of
<tt class="xref py py-class docutils literal"><span class="pre">pyffi.object_models.common.Int</span></tt>, which defines a signed
32-bit integer, exactly the type we need.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="reading-and-writing-files">
<h3>Reading and Writing Files<a class="headerlink" href="#reading-and-writing-files" title="Permalink to this headline">¶</a></h3>
<p>To read the contents of a file of the format described by
simple.xml:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">simple</span> <span class="kn">import</span> <span class="n">SimpleFormat</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">SimpleFormat</span><span class="o">.</span><span class="n">Data</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;somefile.simple&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">example</span><span class="p">)</span>
</pre></div>
</div>
<p>Or, to create a new file in this format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">simple</span> <span class="kn">import</span> <span class="n">SimpleFormat</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">SimpleFormat</span><span class="o">.</span><span class="n">Data</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">num_integers</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">x</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">integers</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">integers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">x</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">integers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">integers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">x</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">integers</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">integers</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;pi.simple&#39;</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="further-references">
<h3>Further References<a class="headerlink" href="#further-references" title="Permalink to this headline">¶</a></h3>
<p>With the above simple example in mind, you may wish to browse through
the source code of <a class="reference internal" href="pyffi.formats.cgf.html#module-pyffi.formats.cgf" title="pyffi.formats.cgf"><tt class="xref py py-mod docutils literal"><span class="pre">pyffi.formats.cgf</span></tt></a> or
<a class="reference internal" href="pyffi.formats.nif.html#module-pyffi.formats.nif" title="pyffi.formats.nif"><tt class="xref py py-mod docutils literal"><span class="pre">pyffi.formats.nif</span></tt></a> to see how pyffi works for more complex file
formats.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><tt class="docutils literal"><span class="pre">pyffi.formats</span></tt> &#8212; File format interfaces</a><ul>
<li><a class="reference internal" href="#supported-formats">Supported formats</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#adding-new-formats">Adding new formats</a><ul>
<li><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li><a class="reference internal" href="#reading-and-writing-files">Reading and Writing Files</a></li>
<li><a class="reference internal" href="#further-references">Further References</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pyffi.html"
                        title="previous chapter"><tt class="docutils literal docutils literal docutils literal"><span class="pre">pyffi</span></tt> &#8212; Interfacing block structured files</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pyffi.formats.bsa.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">pyffi.formats.bsa</span></tt> &#8212; Bethesda Archive (.bsa)</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/pyffi.formats.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pyffi.formats.bsa.html" title="pyffi.formats.bsa — Bethesda Archive (.bsa)"
             >next</a> |</li>
        <li class="right" >
          <a href="pyffi.html" title="pyffi — Interfacing block structured files"
             >previous</a> |</li>
        <li><a href="index.html">PyFFI 2.2.2 documentation</a> &raquo;</li>
          <li><a href="pyffi.html" ><tt class="docutils literal docutils literal docutils literal docutils literal"><span class="pre">pyffi</span></tt> &#8212; Interfacing block structured files</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2007-2012, Amorilia.
      Last updated on Nov 17, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    <br/><a href="http://sourceforge.net/projects/pyffi"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=199269&amp;type=10" width="80" height="15" alt="Get Python File Format Interface at SourceForge.net." /></a>
    </div>
  </body>
</html>