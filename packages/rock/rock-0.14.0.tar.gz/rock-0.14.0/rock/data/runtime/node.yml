env:
  PATH: "${ROCK_PATH}/bin:${ROCK_PATH}/node_modules/.bin:${PATH}"
  ROCK_NPM_INSTALL: "install"
  ROCK_NPM_INSTALL_DEPLOYMENT: "--verbose --no-color install"
  ROCK_NPM_REBUILD_DEPLOYMENT: "--verbose --no-color rebuild"

build: |

  if [[ "${ROCK_ARGS_HELP}" == "true" ]]; then
    echo 'Usage: rock build [--deployment]'
    echo
    echo '  --help             show help message'
    echo '  --deployment       run build in deployment mode'
    exit
  fi

  if [[ "${ROCK_ARGS_DEPLOYMENT}" != "true" ]]; then
    if [[ -f ./package.json ]]; then
      npm ${ROCK_NPM_INSTALL}
    else
      warn 'no "package.json" file found'
    fi
    if [[ "${ROCK_NPM_SHRINKWRAP}" != "false" ]]; then
      npm shrinkwrap
    fi
  else
    if [[ ! -f ./npm-shrinkwrap.json ]]; then
      die 'no "npm-shrinkwrap.json" file found'
    fi
    npm ${ROCK_NPM_INSTALL_DEPLOYMENT}
    npm ${ROCK_NPM_REBUILD_DEPLOYMENT}
  fi

test: |

  if [[ "${ROCK_ARGS_HELP}" == "true" ]]; then
    echo 'Usage: rock test'
    echo
    echo '  --help             show help message'
    exit
  fi

  npm test

clean: |

  if [[ "${ROCK_ARGS_HELP}" == "true" ]]; then
    echo 'Usage: rock clean'
    echo
    echo '  --help             show help message'
    exit
  fi

  if [[ -d ./node_modules ]]; then
    rm -fr ./node_modules
  fi
