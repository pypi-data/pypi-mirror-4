{% extends "admin/import_export/base.html" %}
{% load url from future %}
{% load i18n %}
{% load admin_urls %}
{% load import_export_tags %}

{% block breadcrumbs_last %}
{% trans "Import" %}
{% endblock %}

{% block content %}
<div class="inner">
<h1>{% trans "Import" %}</h1>

{% if confirm_form %}
  <form action="{% url opts|admin_urlname:"process_import" %}" method="POST">
    {% csrf_token %}
    {{ confirm_form.as_p }}
    <p>
      {% trans "Below is a preview of applied import data. If you are satisfied with a result click Confirm import" %}
    </p>
    <div class="submit-row">
      <input type="submit" class="default" name="confirm" value="{% trans "Confirm import" %}">
    </div>
  </form>

{% else %}
  <form action="{{ form_url }}" method="post" id="{{ opts.module_name }}_form" enctype="multipart/form-data" class="form-horizontal">
    {% csrf_token %}

    <p>
      {% trans "This importer expect and will import following fields: " %}
      {% for f in fields  %}
        {% if forloop.counter0 %}
        , 
        {% endif %}
        <tt>{{ f }}</tt>
      {% endfor %}
    </p>

    <fieldset class="module aligned">
      {% for field in form %}
        <div class="form-row{% if field.errors %} errors{% endif %}{% if field.field.name %} field-{{ field.field.name }}{% endif %}">
        {{ field.errors }}
        
          <div class="control-group">
            

            <div class="control-label" for="{{field.id}}">{{ field.label_tag }}</div>
            <div class="controls">{{ field }}</div>
            

            {% if field.field.help_text %}
            <p class="help-block">{{ field.field.help_text|safe }}</p>
            {% endif %}
          </div>
        </div>
        {% endfor %}
    </fieldset>

    <div class="form-actions">
      <input type="submit" class="default" value="{% trans "Import" %}">
    </div>
  </form>
{% endif %}

{% if result %}

  {% if result.has_errors %}
    <h2>{% trans "Errors" %}</h2>
    <ul>
      {% for error in result.base_errors  %}
      <li>{{ error.error }}</li>
      {% endfor %}
      {% for line, errors in result.row_errors %}
        {% for error in errors %}
          <li>
            {% trans "Line number" %}: {{ line }} - {{ error.error }}
            <div class="traceback">{{ error.traceback|linebreaks }}</div>
          </li>
        {% endfor %}
      {% endfor %}
    </ul>
  {% else %}

  <h2>
    {% trans "Preview" %}
  </h2>
  <table>
    <thead>
      <tr>
        <th></th>
        {% for field in fields %}
          <th>{{ field }}</th>
        {% endfor %}
      </tr>
    </thead>
    {% for row in result.rows %}
    <tr>
      <td>
        {% if row.import_type == 'new' %}
          {% trans "New" %}
        {% elif row.import_type == 'skip' %}
          {% trans "Skipped" %}
        {% elif row.import_type == 'delete' %}
          {% trans "Delete" %}
        {% elif row.import_type == 'update' %}
          {% trans "Update" %}
        {% endif %}
      </td>
      {% for field in row.diff %}
      <td>
        {{ field }}
      </td>
      {% endfor %}
    </etr>
    {% endfor %}
  </table>
  {% endif %}

  {% endif %}
</div>
{% endblock %}
