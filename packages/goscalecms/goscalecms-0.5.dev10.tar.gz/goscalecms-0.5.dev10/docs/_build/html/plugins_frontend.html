

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. Plugins front-end &mdash; goscalecms 0.3 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="goscalecms 0.3 documentation" href="index.html" />
    <link rel="next" title="Themes support" href="themes.html" />
    <link rel="prev" title="1. Template tags" href="tags.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="themes.html" title="Themes support"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tags.html" title="1. Template tags"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">goscalecms 0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="plugins-front-end">
<h1>2. Plugins front-end<a class="headerlink" href="#plugins-front-end" title="Permalink to this headline">¶</a></h1>
<p>All the plugins are located in the goscalecms app &#8220;goscale&#8221; folder, then in &#8220;plugins&#8221;. There is also a second subfolder, &#8220;static&#8221; containing the media files used by these plugins (js, css and images).</p>
<div class="section" id="templates">
<h2>2.1. Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h2>
<p>The &#8220;plugins&#8221; folder contains all the plugins (each plugin having its own folder at its name).
In their &#8220;templates&#8221; sub folders are their templates, each one corresponding to a specific view, that you can choose in the &#8220;template&#8221; dropdown of a plugin in the admin.</p>
<p>In all these templates you have access to 2 main variables :</p>
<ul class="simple">
<li>{{ title }} : a string containing the title of the page, set in the &#8220;title&#8221; field of a plugin in the admin</li>
<li>{{ posts }} : a dictionary containig the content to display on the page (videos, rss feeds, pictures, ...)</li>
</ul>
<p>Then, each plugin has it&#8217;s own specific secondary variables to display additional information or choose a specific layout.</p>
<p>For each new plugin, always use the same structure as the other plugin&#8217;s templates (to include the base css and js files). To include plugin&#8217;s specific js and css files (used by dependencies like jquery plugins), use these URLs:</p>
<div class="highlight-python"><pre>{{ STATIC_URL }}goscale/css/your.css.file.css
{{ STATIC_URL }}goscale/js/your.js.file.js</pre>
</div>
<p>Also, if your plugin needs you to add specific css to make its default style and/or specific js to make it run, use these URLs:</p>
<div class="highlight-python"><pre>{{ STATIC_URL }}goscale/css/goscale.plugins.pluginname.css
{{ STATIC_URL }}goscale/js/goscale.plugins.pluginname.js</pre>
</div>
<p>In these URLs, replace pluginname by the name of your plugin.</p>
</div>
<div class="section" id="static-files">
<h2>2.2. Static files<a class="headerlink" href="#static-files" title="Permalink to this headline">¶</a></h2>
<p>They should all be in the &#8220;static&#8221; subfolder, in &#8220;js&#8221; for the javascript files, &#8220;css&#8221; for the css files and &#8220;img&#8221; for the images.</p>
<p>In the specific js file, you should create a jquery plugin that&#8217;s called only if a certain class is found on the page, example:</p>
<div class="highlight-python"><pre>(function($) {
    $.fn.goscalePluginsVideos = function() { // jquery plugin creation
                // your plugin's js here
        };
        $('.goscale-plugins-videos').goscalePluginsVideos(); // check for the specific class to run the jquery plugin
})(jQuery);</pre>
</div>
<p>Eventually, always include at the end of the css block a css file located in the themes&#8217;s folder of the &#8220;django_cms_template&#8221; project that can be used to override the style of the plugin for each theme to make it fit to it&#8217;s design using this exact URL:</p>
<div class="highlight-python"><pre>{{ STATIC_THEME_URL }}css/plugins-override.css</pre>
</div>
</div>
<div class="section" id="ajaxlinks">
<h2>2.3. Ajaxlinks<a class="headerlink" href="#ajaxlinks" title="Permalink to this headline">¶</a></h2>
<p>In order to make the ajalinks plugin work with the goscale&#8217;s plugins, you&#8217;ll need to add this piece of code in ajaxlink&#8217;s callback:</p>
<div class="highlight-python"><pre>var $plugin = $(content).find('[data-pluginjs]');

if($plugin.length &gt; 0) {
        var file = $plugin.eq(0).data('pluginjs'),
                callback = $plugin.eq(0).data('plugincb');

        if($(['head script[src*="', file, '"]'].join('')).length &gt; 0) {
                plugins[callback]();
        }
        else {
                head.js(file);
        }
}</pre>
</div>
<p>Please make sure that you&#8217;re using the javascript plugin &#8220;head.js&#8221;.</p>
<p>Then, your goscale plugin&#8217;s template should have a &#8220;data-pluginjs&#8221; and a &#8220;data-plugincb&#8221; data attribute on any of it&#8217;s html element containing the plugin&#8217;s main javascript file and the function to call it, example:</p>
<div class="highlight-python"><pre>&lt;div class="goscale-plugins-videos" data-pluginjs="{{ STATIC_URL }}goscale/js/goscale.plugins.videos.js" data-plugincb="goscalePluginsVideos"&gt;</pre>
</div>
<p>According to this example, your main js file is &#8220;goscale.plugins.videos.js&#8221; and it should initialize the &#8220;plugins&#8221; namespace (if it doesn&#8217;t exist), and add a &#8220;plugins.goscalePluginsVideos&#8221; function that will be called by ajaxlinks&#8217; callback and initiate the goscale&#8217;s plugin. All the needed js files should be removed from the template and put in the plugin&#8217;s main js file. To continue on the videos plugin example, it&#8217;s main js will then be:</p>
<div class="highlight-python"><pre>var plugins = plugins || {}; // initiates/uses the plugins namespace

(function($) {
        $.fn.goscalePluginsVideos = function() { // your jquery plugin
                //your plugin's needed variables here
                var loadJSFiles = function() { // function to call to load the needed js files, that were in the plugin's template before
                        var src = [$('head script[src*="goscale.plugins.videos.js"]').attr('src').split('goscale/js/')[0], 'goscale/js/'].join(''),
                                scripts = [
                                        [src, 'swfobject.js'].join(''), // ------------------
                                        [src, 'jquery.mousewheel.js'].join(''), // ----------
                                        [src, 'tools.scrollable-1.0.5.min.js'].join(''), // --&gt; the names of the js files taken from the template
                                        [src, 'jquery.fancybox-1.3.4.pack.js'].join(''), // -
                                        [src, 'jquery.easing.1.3.js'].join('') // -----------
                                ],
                                callback = function() { // callback called after the last js file is loaded
                                        $('head script[src*="goscale.plugins.videos.js"]').attr('rel', 'ready'); // this js file's name
                                        initPlugin(); // calling you plugin's code
                                },
                                checkFiles = function() { // function to check which js file to load (if they aren't already loaded by any other plugin)
                                        var tmp = [];
                                        for(var i = 0, ln = scripts.length; i &lt; ln; i++) {
                                                if($(['head script[src*="', scripts[i], '"]'].join('')).length == 0) {
                                                        tmp.push(scripts[i]);
                                                }
                                        }
                                        scripts = tmp;
                                },
                                loadJSFile = function(filename, last) { // function to load the remaining needed js files
                                        var fileref = document.createElement('script');
                                        fileref.type = 'text/javascript';
                                        fileref.src = filename;
                                        if(last) {
                                                fileref.onload = callback;
                                        }
                                        document.getElementsByTagName("head")[0].appendChild(fileref);
                                };

                        checkFiles(); // checking which js files to load
                        if(scripts.length == 0) { // if no files to load, calling your plugin's code
                                callback();
                        }
                        else { // else loading all the needed js files
                                for(var i = 0, ln = scripts.length; i &lt; ln; i++) {
                                        loadJSFile(scripts[i], (i == (ln - 1)));
                                }
                        }
                },
                initPlugin = function() { // function to call if/when the needed js files are loaded
                        // your plugin's code here
                }; // end of your code

                if($('head script[src*="goscale.plugins.form.js"]').length &gt; 0) { // if the main js files are there
                        if($('head script[src*="goscale.plugins.videos.js"][rel="ready"]').length &gt; 0) { // and the videos plugin's js files too
                                initPlugin(); // run your plugin's code
                        }
                        else {
                                loadJSFiles(); // else load the plugin's needed js files
                        }
                }
                else {
                        head.ready('goscale.plugins.form.js', function() { // else we're waiting for them to then load the plugin's js files
                                loadJSFiles();
                        });
                }
        }; // end of your jquery plugin

        plugins.goscalePluginsVideos = function() { // the needed "plugins" namespace function to run your plugin's code from ajaxlinks' callback
                $('.goscale-plugins-videos').goscalePluginsVideos(); // your plugin's call
        };

        plugins.goscalePluginsVideos(); // runs the first time this file is loaded (or each time it's loaded if ajaxlinks isn't used)
})(jQuery); // end of file</pre>
</div>
<p>And the plugin&#8217;s template js section should look like this (in videos.html for example):</p>
<div class="highlight-python"><pre>{% goscale_addtoblock "js" %} // goscale's sekizai tag
        &lt;script type="text/javascript"&gt;
                head.ready('scripts', function() { // where scripts is the head.js label of the last of your local main js files, to be sure that they are ready before the plugin is called
                        head.js('{{ STATIC_URL }}goscale/js/goscale.plugins.videos.js'); // your plugin's main js file
                });
        &lt;/script&gt;
{% endaddtoblock %}</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. Plugins front-end</a><ul>
<li><a class="reference internal" href="#templates">2.1. Templates</a></li>
<li><a class="reference internal" href="#static-files">2.2. Static files</a></li>
<li><a class="reference internal" href="#ajaxlinks">2.3. Ajaxlinks</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tags.html"
                        title="previous chapter">1. Template tags</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="themes.html"
                        title="next chapter">Themes support</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/plugins_frontend.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="themes.html" title="Themes support"
             >next</a> |</li>
        <li class="right" >
          <a href="tags.html" title="1. Template tags"
             >previous</a> |</li>
        <li><a href="index.html">goscalecms 0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Sterno.Ru.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>