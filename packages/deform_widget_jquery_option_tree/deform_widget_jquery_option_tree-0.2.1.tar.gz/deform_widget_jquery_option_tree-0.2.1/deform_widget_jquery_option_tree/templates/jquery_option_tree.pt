<input type="text"
       name="${field.name}"
       value="${cstruct}"
       id="${field.oid}"/>
<script type="text/javascript">
  $(function() {

    var displayParents = function() {
      var labels = [];
      $(this)
        .siblings('select')
        .find(':selected')
        .each(
          function() {
            labels.push($(this).text());
          }
        );
      $('')
        .text(this.value + ':' + labels.join(' > '))
        .appendTo('#${field.oid}-result');
    };

    var initTree = function(lineage) {
      $.getJSON(
        "${field.widget.json_url}",
        function(tree) {
          var options = {
            empty_value: '',
            indexed: true,
            on_each_change: "${field.widget.json_url}",
            set_value_on: 'each',
            choose: ' ',
            preselect: {
              '${field.name}': lineage
            },
            preselect_only_once: true,
            get_parent_value_if_empty: true,
            attr: "id"
          };
          $('#${field.oid}').optionTree(tree, options).change(displayParents);
        }
      );
    };

    var initTreeWithValue = function(value){
      $.getJSON(
        "${field.widget.json_url}/" + value + "/lineage",
        initTree
      );

    };

    if ('${cstruct}') {
      initTreeWithValue('${cstruct}');
    } else {
      initTree([]);
    }
});
</script>
