
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Launch Rockets through a queue &mdash; FireWorks 0.1dev1.6 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1dev1.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="FireWorks 0.1dev1.6 documentation" href="index.html" />
    <link rel="next" title="Using Python to command FireWorks" href="python_tutorial.html" />
    <link rel="prev" title="Dynamic Workflows" href="dynamic_wf_tutorial.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="python_tutorial.html" title="Using Python to command FireWorks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dynamic_wf_tutorial.html" title="Dynamic Workflows"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">FireWorks 0.1dev1.6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="launch-rockets-through-a-queue">
<h1>Launch Rockets through a queue<a class="headerlink" href="#launch-rockets-through-a-queue" title="Permalink to this headline">¶</a></h1>
<p>If your FireWorker is a large, shared resource (such as a computing cluster or supercomputing center), you probably won&#8217;t be able to launch Rockets directly. Instead, you&#8217;ll submit Rockets through an existing queueing system that allocates computer resources.</p>
<p>The simplest way to submit jobs through a queue is to submit scripts to your queue manager that run <tt class="docutils literal"><span class="pre">rlauncher_run.py</span></tt>. This method is just like typing <tt class="docutils literal"><span class="pre">rlauncher_run.py</span></tt> into a Terminal window like in the core tutorials, except that now we are submitting a queue script that does the typing for us (it&#8217;s very low-tech!). In particular, FireWorks is <em>completely unaware</em> that you are running through a queue!</p>
<p>The jobs we will submit to the queue are basically placeholder jobs that are asleep until the job starts running. When the job is actually assigned computer resources and runs, the script &#8220;wakes&#8221; up and figures out what FireWork to run.</p>
<p>The advantage of this low-tech system is that it is quite durable; if your queue system goes down or you delete a job from the queue, there are zero repercussions. You don&#8217;t have to tell FireWorks to run those jobs somewhere else, because FireWorks never knew about your queue in the first place. In addition, if you are running on multiple machines and the queue becomes backlogged on one of them, it does not matter at all. Your job stuck in the queue is not preventing high-priority jobs from running on other machines.</p>
<p>There are also some disadvantages to this simple system, and we&#8217;ll discuss a more advanced system in which FireWorks is aware of your queue in a future tutorial. However, we suggest that you get things working simply first.</p>
<div class="section" id="launch-a-single-job-through-a-queue">
<h2>Launch a single job through a queue<a class="headerlink" href="#launch-a-single-job-through-a-queue" title="Permalink to this headline">¶</a></h2>
<p>To get warmed up, let&#8217;s set things up a <em>Queue Launcher</em> to launch a single Rocket through a queueing system.</p>
<div class="section" id="configure-the-queue-launcher">
<h3>Configure the Queue Launcher<a class="headerlink" href="#configure-the-queue-launcher" title="Permalink to this headline">¶</a></h3>
<p>The Queue Launcher needs to know how to communicate with your queue system and the executable to submit to the queue (in our case, a Rocket). These parameters are defined through a QueueParams file.</p>
<ol class="arabic">
<li><p class="first">Move to the <tt class="docutils literal"><span class="pre">queue</span></tt> tutorial directory on your FireWorker:</p>
<div class="highlight-python"><pre>cd &lt;INSTALL_DIR&gt;/fw_tutorials/queue</pre>
</div>
</li>
<li><p class="first">Locate an appropriate QueueParams file. The files are usually named <tt class="docutils literal"><span class="pre">queueparams_&lt;QUEUE&gt;.yaml</span></tt> where <tt class="docutils literal"><span class="pre">&lt;QUEUE&gt;</span></tt> is the supported queue system.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you cannot find a working QueueParams file for your specific queuing system, please contact us for help! (see <a class="reference internal" href="index.html#contributing-label"><em>Contributing and Contact</em></a>) We would like to support more queueing systems in FireWorks.</p>
</div>
<ol class="arabic">
<li><p class="first">Copy your chosen QueueParams file to a new name:</p>
<div class="highlight-python"><pre>cp queueparams_&lt;QUEUE&gt;.yaml my_qp.yaml</pre>
</div>
</li>
<li><p class="first">Navigate to clean working directory on the FireWorker. For example:</p>
<div class="highlight-python"><pre>mkdir ~/queue_tests
cd ~/queue_tests</pre>
</div>
</li>
<li><p class="first">Copy over your queue file and the test FW to this directory:</p>
<div class="highlight-python"><pre>cp &lt;INSTALL_DIR&gt;/fw_tutorials/queue/my_qp.yaml .
cp &lt;INSTALL_DIR&gt;/fw_tutorials/queue/fw_test.yaml .</pre>
</div>
</li>
<li><p class="first">Copy over your LaunchPad and FireWorker files from the second installation tutorial:</p>
<div class="highlight-python"><pre>cp &lt;INSTALL_DIR&gt;/fw_tutorials/installation_pt2/my_fworker.yaml .
cp &lt;INSTALL_DIR&gt;/fw_tutorials/installation_pt2/my_launchpad.yaml .</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do not have these files, please go back and regenerate them according to the instructions <a class="reference internal" href="installation_tutorial_pt2.html"><em>here</em></a>.</p>
</div>
</li>
<li><p class="first">Open <tt class="docutils literal"><span class="pre">my_qp.yaml</span></tt> and modify it as follows:</p>
<ol class="loweralpha simple">
<li>In the part that specifies running <tt class="docutils literal"><span class="pre">rlauncher_run.py</span></tt>, modify the <tt class="docutils literal"><span class="pre">path/to/my_fworker.yaml</span></tt> to contain the <strong>absolute path</strong> of the <tt class="docutils literal"><span class="pre">my_fworker.yaml</span></tt> file on your machine.</li>
<li>On the same line, modify the <tt class="docutils literal"><span class="pre">path/to/my_launchpad.yaml</span></tt> to contain the <strong>absolute path</strong> of the <tt class="docutils literal"><span class="pre">my_launchpad.yaml</span></tt> file on your machine.</li>
<li>For the logging_dir parameter, modify the <tt class="docutils literal"><span class="pre">path/to/logging</span></tt> text to contain the <strong>absolute path</strong> of where you would like FireWorks logs to go. For example, you might create a <tt class="docutils literal"><span class="pre">fw_logs</span></tt> directory inside your home directory, and point the logging_dir parameter there.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be sure to indicate the full, absolute path name; do not use BASH shortcuts like &#8216;.&#8217;, &#8216;..&#8217;, or &#8216;~&#8217;, and do not indicate a relative path.</p>
</div>
</li>
</ol>
<p>You are now ready to begin!</p>
</div>
<div class="section" id="add-some-fireworks">
<h3>Add some FireWorks<a class="headerlink" href="#add-some-fireworks" title="Permalink to this headline">¶</a></h3>
<p>Staying in your testing directory, let&#8217;s reset our database and add a new FireWork, all from our FireWorker:</p>
<div class="highlight-python"><pre>lp_run.py -l my_launchpad.yaml reset &lt;TODAY'S DATE&gt;
lp_run.py -l my_launchpad.yaml add fw_test.yaml</pre>
</div>
</div>
<div class="section" id="submit-a-job">
<h3>Submit a job<a class="headerlink" href="#submit-a-job" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Try submitting a job using the command:</p>
<div class="highlight-python"><pre>qlauncher_run.py -l my_launchpad.yaml -w my_fworker.yaml singleshot my_qp.yaml</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The LaunchPad and FireWorker are not always used when running the Queue Launcher (this is the case here). But, it is good practice to always specify them.</p>
</div>
</li>
<li><p class="first">This should have submitted a job to the queue in the current directory. You can read the log files in the logging directory, and/or check the status of your queue to ensure your job appeared.</p>
</li>
<li><p class="first">After your queue manager runs your job, you should see the file <tt class="docutils literal"><span class="pre">howdy.txt</span></tt> in the current directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In some cases, firewall issues on shared resources prevent your compute node from accessing your FireServer database. If you think this might be responsible for your problem, you might try to submit an interactive job to your queue. Once on the compute node, you can try connecting to your FireServer database through Mongo: <tt class="docutils literal"><span class="pre">mongo</span> <span class="pre">&lt;hostname&gt;:&lt;port&gt;/fireworks</span> <span class="pre">-u</span> <span class="pre">&lt;USERNAME&gt;</span> <span class="pre">-p</span> <span class="pre">&lt;PASSWORD&gt;</span></tt>. (You could also try running <tt class="docutils literal"><span class="pre">lp_run.py</span> <span class="pre">-l</span> <span class="pre">my_launchpad.yaml</span> <span class="pre">get_fw</span> <span class="pre">1</span></tt> to test the DB connection, but make sure you do this from a compute node). If you cannot connect to the FireServer database from your compute node, you might contact a system administrator for assistance.</p>
</div>
</li>
</ol>
<p>If everything ran successfully, congratulations! You just executed a complicated sequence of instructions:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>The Queue Launcher submitted a Rocket to your queue manager</li>
<li>Your queue manager executed the Rocket when resources were ready</li>
<li>The Rocket fetched a FireWork from the FireServer and ran the specification inside</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="adding-more-power-using-rapid-fire-mode">
<h2>Adding more power: using rapid-fire mode<a class="headerlink" href="#adding-more-power-using-rapid-fire-mode" title="Permalink to this headline">¶</a></h2>
<p>While launching a single job to a queue is nice, a more powerful use case is to submit a large number of jobs at once, or to maintain a certain number of jobs in the queue. Like the Rocket Launcher, the Queue Launcher can be run in a &#8220;rapid-fire&#8221; mode that provides these features.</p>
<div class="section" id="id1">
<h3>Add some FireWorks<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s reset our database and add three new FireWorks, all from our FireWorker:</p>
<div class="highlight-python"><pre>lp_run.py -l my_launchpad.yaml reset &lt;TODAY'S DATE&gt;
lp_run.py -l my_launchpad.yaml add fw_test.yaml
lp_run.py -l my_launchpad.yaml add fw_test.yaml
lp_run.py -l my_launchpad.yaml add fw_test.yaml</pre>
</div>
</div>
<div class="section" id="unleash-rapid-fire-mode">
<h3>Unleash rapid-fire mode<a class="headerlink" href="#unleash-rapid-fire-mode" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Clean your working directory of everything but four files: <tt class="docutils literal"><span class="pre">fw_test.yaml</span></tt>, <tt class="docutils literal"><span class="pre">my_qp.yaml</span></tt>, <tt class="docutils literal"><span class="pre">my_fworker.yaml</span></tt>, and <tt class="docutils literal"><span class="pre">my_launchpad.yaml</span></tt></p>
</li>
<li><p class="first">Submit several jobs with a single command:</p>
<div class="highlight-python"><pre>qlauncher_run.py -l my_launchpad.yaml -w my_fworker.yaml rapidfire -q 3 my_qp.yaml</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may have noticed that the paths to <tt class="docutils literal"><span class="pre">my_fworker.yaml</span></tt> and <tt class="docutils literal"><span class="pre">my_launchpad.yaml</span></tt> are needed in two places. The first place is when specifying the <tt class="docutils literal"><span class="pre">-l</span></tt> and <tt class="docutils literal"><span class="pre">-w</span></tt> arguments to <tt class="docutils literal"><span class="pre">qlauncher_run.py</span></tt>.The second place is inside the <tt class="docutils literal"><span class="pre">my_qp.yaml</span></tt> file.  The locations when specifying arguments to <tt class="docutils literal"><span class="pre">qlauncher_run.py</span></tt> are read by the head node during submission of your jobs to the queue manager. The locations inside <a href="#id2"><span class="problematic" id="id3">``</span></a>my_qp.yaml``are read by the compute nodes that run your job. These locations can be different or the same, but we suggest that they be the same unless your compute nodes cannot access the same filesystem as your head nodes.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The Queue Launcher sleeps between each job submission to give time for the queue manager to &#8216;breathe&#8217;. It might take a few minutes to submit all the jobs.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The command above submits jobs until you have at most 3 jobs in the queue. If you had some jobs existing in the queue before running this command, you might need to increase the <tt class="docutils literal"><span class="pre">-q</span></tt> parameter.</p>
</div>
</li>
</ol>
<ol class="arabic simple" start="5">
<li>The rapid-fire command should have created a directory beginning with the tag <tt class="docutils literal"><span class="pre">block_</span></tt>. Navigate inside this directory, and confirm that three directories starting with the tag <tt class="docutils literal"><span class="pre">launch</span></tt> were created. The <tt class="docutils literal"><span class="pre">launch</span></tt> directories contain your individual jobs.</li>
</ol>
<p>You&#8217;ve now launched multiple Rockets with a single command!</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more tips on the Queue Launcher, such as how to maintain a certain number of jobs in the queue indefinitely, read its built-in help: <tt class="docutils literal"><span class="pre">qlauncher_run.py</span> <span class="pre">rapidfire</span> <span class="pre">-h</span></tt></p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Launch Rockets through a queue</a><ul>
<li><a class="reference internal" href="#launch-a-single-job-through-a-queue">Launch a single job through a queue</a><ul>
<li><a class="reference internal" href="#configure-the-queue-launcher">Configure the Queue Launcher</a></li>
<li><a class="reference internal" href="#add-some-fireworks">Add some FireWorks</a></li>
<li><a class="reference internal" href="#submit-a-job">Submit a job</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-more-power-using-rapid-fire-mode">Adding more power: using rapid-fire mode</a><ul>
<li><a class="reference internal" href="#id1">Add some FireWorks</a></li>
<li><a class="reference internal" href="#unleash-rapid-fire-mode">Unleash rapid-fire mode</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dynamic_wf_tutorial.html"
                        title="previous chapter">Dynamic Workflows</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="python_tutorial.html"
                        title="next chapter">Using Python to command FireWorks</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/queue_tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="python_tutorial.html" title="Using Python to command FireWorks"
             >next</a> |</li>
        <li class="right" >
          <a href="dynamic_wf_tutorial.html" title="Dynamic Workflows"
             >previous</a> |</li>
        <li><a href="index.html">FireWorks 0.1dev1.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Anubhav Jain.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>