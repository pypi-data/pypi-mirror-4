c:
  fullname: C Language Tool

  dependencies:
  - rpm: ['gcc', 'gcc-c++','glibc-devel', 'automake', 'autoconf','valgrind','gdb','ddd','strace', 'vim-enhanced', 'vim-X11']

  dependencies_build:
  - rpm: ['rpm-build','mock','eclipse-rpm-editor']

  dependencies_eclipse:
  - rpm: ['eclipse-mylyn-context-cdt','eclipse-egit','eclipse-cdt','eclipse-cdt-parsers','eclipse-cdt-sdk']

  args:
    name:
      snippet: common_args

    build:
      flags:
      - -b
      - --build
      help:
        'This will create SRPM and RPM packages.'
      nargs:
        '?'
    vim:
      snippet: common_args

    eclipse:
      snippet: common_args

    github:
      snippet: common_args

  files:
    csources: &csources
      source: c/
    vim_update: &vim_update
      source: vim_update.sh
    vimrc: &vimrc
      source: vimrc

  run:
  - log_i: 'Copying c source tree to project destination'
  - if not ls $name:
    - cl_f: cp -r *csources $name
    - dda_c: $name
    - cl: cd $name
    - snippet: git_init_add_commit
  - else:
    - cl: cd $name
  - if not defined $build:
    - log_i: 'Run autoreconf'
    - cl_f: autoreconf --install
    - log_i: 'Run configure script'
    - cl_f: ./configure
    - log_i: 'Compilation sources'
    - cl_f: make
    - log_i: 'Calling make distcheck for creating tar ball'
    - cl_f: make distcheck # will create distribution tar ball for later on usage
  - if defined $vim:
    - cl_f: ./vim_update.sh vimrc
  - if $eclipse:
    - log_i: 'Creating eclipse project from command line'
    - cl_f: make clean
    - cl: cd ..
    - cl: mkdir -p $eclipse/$name
    - if ls $name/.eclipseproject:
      - log_i: 'Project was not imported to eclipse environment yet'
      - cl: sed -i s|<name>cdevelassistant<|<name>$name<| $name/.eclipseproject
      - cl: mv $name/.eclipseproject $name/.project
      - cl: cp $name/.project $eclipse/$name/.project
      - cl: cp $name/.cproject $eclipse/$name/.cproject
      - cl: cp $name/.autotools $eclipse/$name/.autotools
      - log_i: 'Copying neccessary files was done'
    - else:
      - log_i: 'Project was already imported into eclipse environment'
    - cl: eclipse -nosplash -application org.eclipse.cdt.managedbuilder.core.headlessbuild -import ./$name -data $eclipse
    - log_i: 'Import to Eclipse is done.'
    - log_i: 'Start eclipse for developping.'
  - if defined $build:
    - log_i: 'Creating spec file'
    - cl: rpmdev-setuptree
    - cl: rm -f ~/rpmbuild/SPECS/cdevelopmenttool.spec
    - cl: cp cdevelopmenttool-1.0.tar.gz ~/rpmbuild/SOURCES
    - cl: cp cdevelopmenttool.spec ~/rpmbuild/SPECS
    - cl: cd ~/rpmbuild/SPECS
    - cl_f: sudo yum-builddep ~/rpmbuild/SPECS/cdevelopmenttool.spec
    - log_i: 'Creating RPM from tarball'
    - cl_f: rpmbuild -ba cdevelopmenttool.spec
    #- log_i: 'Creating RPM from SRPM over mock'
    #- cl_f: rpmbuild -bs cdevelopmenttool.spec
    #- cl_f: mock -r $build ~/rpmbuild/SRPMS/cdevelopmenttool-1.0-0.src.rpm
  run_vim:
    - log_i: "Settings VIM environment"
    #- cl_f: *vim_update ./*vimrc
  run_github:
    - log_i: "Push on GitHub repository"
    - if not ls $name:
        - log_i: "Project were not created yet. It will be created now"
        - run: run
        - cl: cd ../
    - github: create_and_push
