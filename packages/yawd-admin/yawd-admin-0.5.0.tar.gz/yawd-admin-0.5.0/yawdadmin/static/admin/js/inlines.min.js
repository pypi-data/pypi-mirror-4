(function(a){a.fn.formset=function(b){var l=a.extend({},a.fn.formset.defaults,b);var g=a(this);var d=g.parent();var k=function(p,q,n){var m=new RegExp("("+q+"-(\\d+|__prefix__))");var o=q+"-"+n;if(a(p).attr("for")){a(p).attr("for",a(p).attr("for").replace(m,o))}if(p.id){p.id=p.id.replace(m,o)}if(p.name){p.name=p.name.replace(m,o)}};var e=a("#id_"+l.prefix+"-TOTAL_FORMS").attr("autocomplete","off");var f=parseInt(e.val(),10);var i=a("#id_"+l.prefix+"-MAX_NUM_FORMS").attr("autocomplete","off");var j=i.val()===""||(i.val()-e.val())>0;g.each(function(m){a(this).not("."+l.emptyCssClass).addClass(l.formCssClass)});if(g.length&&j){var h;if(g.prop("tagName")=="TR"){var c=this.eq(-1).children().length;d.append('<tr class="'+l.addCssClass+'"><td colspan="'+c+'"><a href="javascript:void(0)">'+l.addText+"</a></tr>");h=d.find("tr:last a")}else{g.filter(":last").after('<div class="'+l.addCssClass+'"><a href="javascript:void(0)">'+l.addText+"</a></div>");h=g.filter(":last").next().find("a")}h.click(function(o){o.preventDefault();var n=a("#id_"+l.prefix+"-TOTAL_FORMS");var m=a("#"+l.prefix+"-empty");var p=m.clone(true);p.removeClass(l.emptyCssClass).addClass(l.formCssClass).attr("id",l.prefix+"-"+f);if(p.is("tr")){p.children(":last").append('<div><a class="'+l.deleteCssClass+'" href="javascript:void(0)">'+l.deleteText+"</a></div>")}else{if(p.is("ul")||p.is("ol")){p.append('<li><a class="'+l.deleteCssClass+'" href="javascript:void(0)">'+l.deleteText+"</a></li>")}else{p.children(":first").append('<span><a class="'+l.deleteCssClass+'" href="javascript:void(0)">'+l.deleteText+"</a></span>")}}p.find("*").each(function(){k(this,l.prefix,n.val())});p.insertBefore(a(m));a(n).val(parseInt(n.val(),10)+1);f+=1;if((i.val()!=="")&&(i.val()-n.val())<=0){h.parent().hide()}p.find("a."+l.deleteCssClass).click(function(t){t.preventDefault();var u=a(this).parents("."+l.formCssClass);u.remove();f-=1;if(l.removed){l.removed(u)}var q=a("."+l.formCssClass);a("#id_"+l.prefix+"-TOTAL_FORMS").val(q.length);if((i.val()==="")||(i.val()-q.length)>0){h.parent().show()}for(var r=0,s=q.length;r<s;r++){k(a(q).get(r),l.prefix,r);a(q.get(r)).find("*").each(function(){k(this,l.prefix,r)})}});if(l.added){l.added(p)}})}return this};a.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null};a.fn.tabularFormset=function(d){var c=a(this);var f=function(h){a(c.selector).not(".add-row").removeClass("row1 row2").filter(":even").addClass("row1").end().filter(":odd").addClass("row2")};var b=function(){if(typeof DateTimeShortcuts!="undefined"){a(".datetimeshortcuts").remove();DateTimeShortcuts.init()}};var e=function(){if(typeof SelectFilter!="undefined"){a(".selectfilter").each(function(h,j){var i=j.name.split("-");SelectFilter.init(j.id,i[i.length-1],false,d.adminStaticPrefix)});a(".selectfilterstacked").each(function(h,j){var i=j.name.split("-");SelectFilter.init(j.id,i[i.length-1],true,d.adminStaticPrefix)})}};var g=function(h){h.find(".prepopulated_field").each(function(){var l=a(this),j=l.find("input, select, textarea"),i=j.data("dependency_list")||[],k=[];a.each(i,function(m,n){k.push("#"+h.find(".field-"+n).find("input, select, textarea").attr("id"))});if(k.length){j.prepopulate(k,j.attr("maxlength"))}})};c.formset({prefix:d.prefix,addText:d.addText,formCssClass:"dynamic-"+d.prefix,deleteCssClass:"inline-deletelink",deleteText:d.deleteText,emptyCssClass:"empty-form",removed:f,added:function(h){g(h);b();e();f(h)}});return c};a.fn.stackedFormset=function(d){var c=a(this);var e=function(h){a(c.selector).find(".inline_label").each(function(j){var k=j+1;a(this).html(a(this).html().replace(/(#\d+)/g,"#"+k))})};var b=function(){if(typeof DateTimeShortcuts!="undefined"){a(".datetimeshortcuts").remove();DateTimeShortcuts.init()}};var f=function(){if(typeof SelectFilter!="undefined"){a(".selectfilter").each(function(h,j){var i=j.name.split("-");SelectFilter.init(j.id,i[i.length-1],false,d.adminStaticPrefix)});a(".selectfilterstacked").each(function(h,j){var i=j.name.split("-");SelectFilter.init(j.id,i[i.length-1],true,d.adminStaticPrefix)})}};var g=function(h){h.find(".prepopulated_field").each(function(){var l=a(this),j=l.find("input, select, textarea"),i=j.data("dependency_list")||[],k=[];a.each(i,function(m,n){k.push("#"+h.find(".form-row .field-"+n).find("input, select, textarea").attr("id"))});if(k.length){j.prepopulate(k,j.attr("maxlength"))}})};c.formset({prefix:d.prefix,addText:d.addText,formCssClass:"dynamic-"+d.prefix,deleteCssClass:"inline-deletelink",deleteText:d.deleteText,emptyCssClass:"empty-form",removed:e,added:(function(h){g(h);b();f();e(h)})});return c}})(yawdadmin.jQuery);