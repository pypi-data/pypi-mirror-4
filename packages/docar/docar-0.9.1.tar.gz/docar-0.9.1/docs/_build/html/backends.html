

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Backends &mdash; python-docar 0.5 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="python-docar 0.5 documentation" href="index.html" />
    <link rel="prev" title="Mapping Fields" href="mapping_fields.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mapping_fields.html" title="Mapping Fields"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">python-docar 0.5 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="backends">
<span id="id1"></span><h1>Backends<a class="headerlink" href="#backends" title="Permalink to this headline">¶</a></h1>
<p>The backends are the real meat of the documents. Where the document defines what
you can do, the backends implement the how of it. Documents and backends use
dictionaries to communicate with each other. A backend expects a dictionary
representation of the document, applies it as needed, and returns the resource
as a dictionary again. Each backend must implement the following methods:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">fetch</span></tt></dt>
<dd>Fetch the resource from the underlying backend. Returns a dictionary.</dd>
<dt><tt class="docutils literal"><span class="pre">save</span></tt></dt>
<dd>Save the document to the resource in the underlying backend. Expects a
dictionary representation of the document.</dd>
<dt><tt class="docutils literal"><span class="pre">delete</span></tt></dt>
<dd>Delete the resource from the underlying backend.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">docar</span></tt> comes with its own backend registry, which you can choose to use. But
you can also supply the document with any class that will be used as a backend.</p>
<div class="section" id="http-backend">
<h2>HTTP Backend<a class="headerlink" href="#http-backend" title="Permalink to this headline">¶</a></h2>
<p>The HTTP backend uses the <tt class="docutils literal"><span class="pre">requests</span></tt> library to communicate to remote
backends over HTTP. It assumes currently JSON as exchange protocol. The
document methods map the following way to the HTTP backend:</p>
<ul class="simple">
<li><a class="reference internal" href="documents.html#Document.fetch" title="Document.fetch"><tt class="xref py py-meth docutils literal"><span class="pre">fetch()</span></tt></a> &#8211;&gt; HTTP GET</li>
<li><a class="reference internal" href="documents.html#Document.save" title="Document.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> &#8211;&gt; HTTP POST (on create)</li>
<li><a class="reference internal" href="documents.html#Document.save" title="Document.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> &#8211;&gt; HTTP PUT (on update)</li>
<li><a class="reference internal" href="documents.html#Document.delete" title="Document.delete"><tt class="xref py py-meth docutils literal"><span class="pre">delete()</span></tt></a> &#8211;&gt; HTTP DELET</li>
</ul>
<div class="section" id="uri-methods">
<h3>uri methods<a class="headerlink" href="#uri-methods" title="Permalink to this headline">¶</a></h3>
<p>This backend uses the <a class="reference internal" href="documents.html#Document.uri" title="Document.uri"><tt class="xref py py-meth docutils literal"><span class="pre">uri()</span></tt></a> method to determine its API
endpoint. You can implement specific uri methods for each HTTP verb to be more
precise. If a http specific uri method is not found, it will fallback to the
default <a class="reference internal" href="documents.html#Document.uri" title="Document.uri"><tt class="xref py py-meth docutils literal"><span class="pre">uri()</span></tt></a> method. The form of those methods is
<tt class="docutils literal"><span class="pre">verb_uri</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">NumberField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use this method for POST requests</span>
        <span class="k">return</span> <span class="s">&quot;http://post_location&quot;</span>

    <span class="k">def</span> <span class="nf">uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The default uri location for all other HTTP requests</span>
        <span class="k">return</span> <span class="s">&quot;http://location&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="django-backend">
<h2>Django Backend<a class="headerlink" href="#django-backend" title="Permalink to this headline">¶</a></h2>
<p>The django backend stores and retrieves resources using the <a class="reference external" href="http://djangoproject.org">Django ORM</a>.</p>
</div>
<div class="section" id="writing-your-own-backends">
<h2>Writing your own Backends<a class="headerlink" href="#writing-your-own-backends" title="Permalink to this headline">¶</a></h2>
<p>Its very easy to implement your own backends to use with docar. A backend is
always a class. If you want to use the builtin backend manager, this class has
to inherit from <tt class="docutils literal"><span class="pre">docar.backends.Backend</span></tt> and must be imported before using
it. But you can supply the class itself to the document too. The following
example shows the two possible ways to supply a document with a backend:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyBackend</span><span class="p">(</span><span class="n">Backend</span><span class="p">):</span>
    <span class="n">backend_type</span> <span class="o">=</span> <span class="s">&#39;mybackend&#39;</span>

<span class="c"># Supply a class as a backend</span>
<span class="k">class</span> <span class="nc">MyDocument</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">backend_type</span> <span class="o">=</span> <span class="n">MyBackend</span>

<span class="c"># Reference the backend by name</span>
<span class="k">class</span> <span class="nc">MyDocument</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">backend_type</span> <span class="o">=</span> <span class="s">&#39;mybackend&#39;</span>
</pre></div>
</div>
<p>A backend must implement the following interface:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">fetch(doc,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">save(doc,</span> <span class="pre">data,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">delete(doc,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></tt></li>
</ul>
<p>eg:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">docar.backends</span> <span class="kn">import</span> <span class="n">Backend</span>

<span class="k">class</span> <span class="nc">MyBackend</span><span class="p">(</span><span class="n">Backend</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;mybackend&#39;</span>

    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<div class="section" id="fetch">
<h3><tt class="docutils literal"><span class="pre">fetch</span></tt><a class="headerlink" href="#fetch" title="Permalink to this headline">¶</a></h3>
<p>The first argument must be the document itself. You can use it to retrieve more
information about the fields if needed. <tt class="docutils literal"><span class="pre">*args</span></tt> and <tt class="docutils literal"><span class="pre">**kwargs</span></tt> are
additional parameters that can be consumed by the backend, eg: username and
password are optional arguments of the http backend. <tt class="docutils literal"><span class="pre">fetch</span></tt> <em>must</em> return
the document as a dict type.</p>
</div>
<div class="section" id="save">
<h3><tt class="docutils literal"><span class="pre">save</span></tt><a class="headerlink" href="#save" title="Permalink to this headline">¶</a></h3>
<p>The first argument is again the document itself. The second argument is the
normalized data as a dict that should be saved. This method must implement the
logic to distinguish between an existing and a new document. The document class
itself has no knowledge about that.</p>
</div>
<div class="section" id="delete">
<h3><tt class="docutils literal"><span class="pre">delete</span></tt><a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h3>
<p>The first argument is the document itself. This purges the mapped document from
the specified backend.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Backends</a><ul>
<li><a class="reference internal" href="#http-backend">HTTP Backend</a><ul>
<li><a class="reference internal" href="#uri-methods">uri methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#django-backend">Django Backend</a></li>
<li><a class="reference internal" href="#writing-your-own-backends">Writing your own Backends</a><ul>
<li><a class="reference internal" href="#fetch"><tt class="docutils literal"><span class="pre">fetch</span></tt></a></li>
<li><a class="reference internal" href="#save"><tt class="docutils literal"><span class="pre">save</span></tt></a></li>
<li><a class="reference internal" href="#delete"><tt class="docutils literal"><span class="pre">delete</span></tt></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="mapping_fields.html"
                        title="previous chapter">Mapping Fields</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/backends.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mapping_fields.html" title="Mapping Fields"
             >previous</a> |</li>
        <li><a href="index.html">python-docar 0.5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Christo Buschek.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>