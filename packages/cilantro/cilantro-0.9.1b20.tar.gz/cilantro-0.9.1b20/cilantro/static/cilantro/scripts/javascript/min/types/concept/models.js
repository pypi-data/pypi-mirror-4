var __hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__bind=function(a,b){return function(){return a.apply(b,arguments)}},__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};define(["underscore","backbone","common/models/state"],function(a,b,c){var d,e;return d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.url=function(){return b.__super__.url.apply(this,arguments)+"/"},b}(c.Model),e=function(b){function c(){return this.toggleEnableByDomain=__bind(this.toggleEnableByDomain,this),c.__super__.constructor.apply(this,arguments)}return __extends(c,b),c.prototype.model=d,c.prototype.url=App.endpoints.criteria,c.prototype.initialize=function(){var a=this;return App.hub.subscribe("domain/active",this.toggleEnableByDomain),App.hub.subscribe("subdomain/active",this.toggleEnableByDomain),this.bind("reset",this.groupByDomain),this.bind("active",this.activate),this.bind("inactive",this.inactivate),App.hub.subscribe("concept/request",function(b){var c;c=a.get(b);if(c)return App.hub.publish("domain/request",c.get("domain").id),c.activate()}),this._activeByDomain={},this._activeDomain=null},c.prototype.groupByDomain=function(){var a=this;return this._byDomain={},this._bySubdomain={},this.each(function(b){var c,d,e,f,g,h,i,j,k,l;return c=b.get("domain"),c.parent?(((j=(d=a._bySubdomain)[g=c.id])!=null?j:d[g]=[]).push(b),((k=(e=a._byDomain)[h=c.parent.id])!=null?k:e[h]=[]).push(b)):((l=(f=a._byDomain)[i=c.id])!=null?l:f[i]=[]).push(b)})},c.prototype.toggleEnableByDomain=function(a){var b,c;this._activeDomain=a,b=this._bySubdomain[a]||this._byDomain[a],this.map(function(a){return __indexOf.call(b,a)<0?a.disable():(a.enable(),a.inactivate())});if(c=this._activeByDomain[a])return c.activate()},c.prototype.activate=function(b){var c;return this._activeByDomain[this._activeDomain]=b,c=this._bySubdomain[this._activeDomain]||this._byDomain[this._activeDomain],a(c).without(b).map(function(a){return a.inactivate()})},c.prototype.inactivate=function(a){},c}(b.Collection),{Model:d,Collection:e}})