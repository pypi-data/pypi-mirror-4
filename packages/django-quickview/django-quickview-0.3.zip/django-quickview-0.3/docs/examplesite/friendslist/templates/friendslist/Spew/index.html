{% extends 'base_site.html' %}
{% block extrastyle %}
.left-box {
    text-align: right;
    width: 400px;
}

#object_list_container {
    width: 400px;
}
{% endblock %}
    {% block extrahead %}
        <script id="entry-template" type="text/x-handlebars-template">
            <p>{{lastName}}, {{firstName}}</p>
        </script>

        <script xmlns="http://www.w3.org/1999/html">
            var source   = $("#entry-template").html();
            var template = Handlebars.compile(source);
            var context = {lastName: 'Weholt', firstName: 'Thomas'};
            var html = template(context);
        </script>

    {% endblock %}

    {% block documentready %}
        function SpewsListViewModel() {
            var self = this;
            self.spews = ko.observableArray([]);

            self.load = function()
            {
                get_spew_view_array(function(data){ self.spews(data); });
            }

            self.addSpew = function(params)
            {
                if (params['text'] != '' && params['text'] != undefined)
                {
                    spewApi.add(params, function(data){
                        self.spews.push(new spew_view_model(data));
                    });
                }
            }

            self.delete = function(pk)
            {
                for (var index = 0; index < self.spews().length; index++)
                {
                    console.log(index);
                    var element = self.spews()[index];
                    if (element.id() == pk)
                    {
                        self.spews.remove(function(item) { return item.id() == pk });
                        spewApi.delete(pk);
                        break;
                    }
                }
            }
        }

        //window.spw = new SpewsListViewModel();
        //ko.applyBindings(spw);
        //spw.load();

        //alert(spewApi.get_url({'url': 'friendslist-friend-update', 'args': [1]}));

    {% endblock %}

    {% block content %}

    <span id="here">This should dissappear.</span>
    <button onclick="$('#here').val(html);">Done!</button>

    <p>Hello: <strong data-bind="text: text()">What?!</strong></p>
    <button onclick="get_spew_view_model(1, function(data){ ko.applyBindings(data);})">Do tha bind!</button>

    <h1>Spew!</h1>
    <textarea cols="800" rows="2" name="text" onblur="spw.addSpew({'text': $(this).val()});" id="spew"></textarea>

    <div id="object_list_container">
    {% for object in object_list %}
        <div id="spew_{{object.id}}">
            <h3><a href="{% url 'friendslist-spew-detail' object.id %}">"{{ object.text }}"</a></h3>
            <div class="left-box">
                <i>{{ object.added|date:"M d, Y H:m" }}, {{ object.author }}</i>.
                <a href="{% url 'friendslist-spew-update' object.id %}"><i class="icon-pencil"></i></a>
                <a href="{% url 'friendslist-spew-detail' object.id %}"><i class="icon-fullscreen"></i></a>
                <a onclick="spw.delete({{object.id}});"><i class="icon-trash"></i></a>
            </div>
        </div>
    {% endfor %}
    </div>

    <div class="pagination">
        <span class="step-links">
            {% if object_list.has_previous %}
                <a href="?page={{ object_list.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ object_list.number }} of {{ object_list.paginator.num_pages }}.
            </span>

            {% if object_list.has_next %}
                <a href="?page={{ object_list.next_page_number }}">next</a>
            {% endif %}
        </span>
    </div>
    {% endblock %}