<tal:comment condition="nothing">
<!--
Full portal_relations macro

Usage:


  <metal:macro use-macro="here/eea_relateditems/macros/relatedItemsWithThumbs" />

Optional parameters:

  @param templateStyle  (optional) - the style that the relatedItems listing
   should use by default it uses an album_view look but you can pass a different
   name in order to get a folder_summary_view listing lookalike

  <metal:macro tal:define="templateStyle string:folder_summary"
               use-macro="here/eea_relateditems/macros/relatedItemsWithThumbs" />

-->
</tal:comment>
<div metal:define-macro="relatedItemsWithThumbs" id="relatedItems"
     tal:define="relations nocall:here/@@eea.relations.macro;
                  auto_relations nocall:here/@@auto-relations.html;
                  thumb_scale thumb_scale | string:image_thumb;
                  backward_tabs python:relations.backward();
                  forward_tabs python:relations.forward();
                  auto_tabs python:auto_relations.tabs;
                  templateStyle templateStyle|string:album_view;"
  tal:condition="python:backward_tabs or forward_tabs or auto_tabs">

    <div class="eea-i18n hidden" i18n:domain="eea" style="display: none;">
        <div id="eeaPaginationNext" i18n:translate="">next</div>
        <div id="eeaPaginationPrev" i18n:translate="">Â« previous</div>
        <div id="eeaPaginationItems" i18n:translate="">items</div>
    </div>

  <tal:backward tal:condition="backward_tabs">
    <!-- Backward relations -->
    <div class="visualNoMarker">
      <tal:tab repeat="tab backward_tabs">
        <tal:def define="label python:tab[0]; related python:tab[1]"
          tal:condition="related">
          <h3 tal:content="label">Relation label</h3>
          <div metal:use-macro="here/eea_relateditems/macros/relatedItems" />
        </tal:def>
      </tal:tab>
    </div>
  </tal:backward>

  <tal:forward tal:condition="forward_tabs">
    <!-- Forward relations -->
    <div class="visualNoMarker">
      <tal:tab repeat="tab forward_tabs">
        <tal:def define="label python:tab[0]; related python:tab[1]"
          tal:condition="related">
          <h3 tal:content="label">Relation label</h3>
          <div metal:use-macro="here/eea_relateditems/macros/relatedItems" />
        </tal:def>
      </tal:tab>
    </div>
  </tal:forward>

  <tal:auto tal:condition="python:auto_tabs">
    <!-- Auto relations -->
    <div class="visualNoMarker">
      <tal:tab repeat="tab auto_tabs">
        <tal:def define="label python:tab[0]; related python:tab[1]">
          <h3 tal:content="label">Relation label</h3>
          <div metal:use-macro="here/eea_relateditems/macros/relatedItems" />
        </tal:def>
      </tal:tab>
    </div>
  </tal:auto>

</div>



<tal:comment condition="nothing">
<!--
Generic macro for relatedItems (use relatedItemsWithThumbs for full relations)

Macro parameters

  @param related (required) - a set of item objects
  @param thumb_scale        - scale of image thumb to use
  @param templateStyle      - the style that the relatedItems listing should use
   by default it uses an album_view look but you can pass a different name in
   order to get a folder_summary_view listing, which is inside of a slot allowing
   you to override it in case you desire to construct a different kind of listing

Usage:

  <metal:macro use-macro="here/eea_relateditems/macros/relatedItems" />

-->
</tal:comment>
<div metal:define-macro="relatedItems"
     tal:define="related related | python:[];
                 thumb_scale thumb_scale | string:image_thumb;
                 templateStyle templateStyle"
     tal:condition="related">
    <tal:album_view tal:repeat="item related"
                    tal:condition="python: templateStyle == 'album_view'">
        <div class="photoAlbumEntry"
             tal:define="item item/getObject|nocall:item;
                         title item/Title;
                         description item/Description;
                         urlview item/@@url;
                         img_url item/absolute_url;
                         listing_url urlview/listing_url;
                         item_interfaces context/@@plone_interface_info;
                         is_video python:item_interfaces.provides('eea.mediacentre.interfaces.IVideo');
                         css_class python: 'video-fancybox' if is_video else '';
                         portal_type item/portal_type;
                         video python:'video-fancybox' if is_video and portal_type != 'FlashFile' else '';
                         animation python:'animation-fancybox' if portal_type == 'FlashFile' else '';
                         cloud python: 'video-fancybox cloudvideo' if portal_type == 'CloudVideo' else '';
                         desc_or_title python:item.Description or item.pretty_title_or_id;">
            <a tal:attributes="href listing_url;
                               title item/pretty_title_or_id;
                               class python:cloud or video or animation">

                <span class="photoAlbumEntryWrapper">
                    <img tal:attributes="title desc_or_title;
                                         alt item/pretty_title_or_id;
                                         src string:${item/absolute_url}/image_thumb" />
                </span>
                <span class="photoAlbumEntryTitle" tal:content="item/pretty_title_or_id" />
                <span class="photoAlbumEntryDescription" tal:content="python: item.Description()" />
            </a>
        </div>
    </tal:album_view>

    <metal:template define-slot="templateStyle">
        <tal:related tal:repeat="item related"
                     tal:condition="python: templateStyle != 'album_view'">
            <div class="tileItem visualIEFloatFix vevent"
                 tal:define="item item/getObject|nocall:item;
                             title item/Title;
                             description item/Description;
                             urlview item/@@url;
                             img_url item/absolute_url;
                             url urlview/listing_url;
                             item_interfaces context/@@plone_interface_info;
                             is_video python:item_interfaces.provides('eea.mediacentre.interfaces.IVideo');
                             css_class python: 'video-fancybox' if is_video else '';">
                <a class="tileImage"
                   tal:attributes="href url; title title; alt title;
                                   class python:'video-fancybox tileImage' if is_video else 'tileImage'">
                    <img tal:attributes="src python:'%s/%s' % (img_url,thumb_scale);
                                         title title; alt title;" />
                </a>
                <h3 class="tileHeadline">
                    <a tal:attributes="href  url;
                                       title description;
                                       class css_class"
                       tal:content="title">
                        Related Item
                    </a>
                </h3>
                <p class="tileFooter">
                    <a class="moreLink"
                       tal:attributes="href url;
                                       title title;"
                       i18n:translate="">
                        Read more
                    </a>
                </p>
                <div class="visualClear"></div>
            </div>
        </tal:related>
    </metal:template>
</div>
