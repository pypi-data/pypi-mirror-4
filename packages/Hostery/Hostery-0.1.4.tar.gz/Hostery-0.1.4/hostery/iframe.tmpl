<!doctype html>
<head>
  <title>Project History: {{ repo_name }}</title>
  <style type="text/css">
  html { 
    height: 100%;
  }
  body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    padding-right: 200px;
    font: 9px/16px Monaco, monospace;
  }
  #frame {
    border: 0;
    width: 100%;
    height: 100%;
  }
  #list {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    overflow: auto;
    width: 200px;
    background: #eee;
  }
  .commit { 
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -o-user-select: none;
    user-select: none;     
    background: #fff;
    background-image: linear-gradient(left,         rgb(240,240,240) 0%, rgba(240,240,240,0) 2%);
    background-image: -o-linear-gradient(left,      rgb(240,240,240) 0%, rgba(240,240,240,0) 2%);
    background-image: -moz-linear-gradient(left,    rgb(240,240,240) 0%, rgba(240,240,240,0) 2%);
    background-image: -webkit-linear-gradient(left, rgb(240,240,240) 0%, rgba(240,240,240,0) 2%);
    background-image: -ms-linear-gradient(left,     rgb(240,240,240) 0%, rgba(240,240,240,0) 2%);
    display: block;
    text-decoration: none;
    color: #777;
    padding: 10px 7px 10px 8px;
    border-bottom: 1px solid #ddd;
    box-shadow: 0 2px 3px rgba(0,0,0,0.03);
    text-align: center;
    cursor: pointer;
    background-color: #f9f9f9;
    text-shadow: 0 1px 0 #fff;
  }
  .commit:not(:first-child) {
    border-top: 1px solid #fff;
  }
  .commit.current { 
    background-color: #fff;
  }
  .commit.current * { 
    color: rgb(42, 148, 162);
  }
  .commit:hover {
    background-color: #fdfdfd;
  }
  .popup {
    display: inline-block;
    text-decoration: none;
    width: 8px;
    height: 7px;
    border: 1px solid #ddd;
    border-top-width: 2px;
    border-radius: 1px;
    background-color: #fff;
    box-shadow: 1px 1px 0 rgba(0,0,0,0.05);
    margin-top: 3px;
    float: right;
    margin-left: 5px;
  }
  .popup:hover {
    border-color: #aaa;
  }
  .number { 
    float: left;
  }
  .date { 
    float: left;
    margin-left: 5px;
    font-size: 9px;
    display: inline-block;
  }
  .hash { 
    float: right;
    /*margin-top: -3px;*/
  }
  .ago {
    font: bold 9px 'Lucida Grande', sans-serif;
  }
  /*.branch {
    position: absolute;
    right: 27px;
    margin-top: 7px;
    font-size: 7px;
  }*/
  </style>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
  <script type="text/javascript">
  $(function() {
    
    $('.ago').prettyDate();
    setInterval(function(){ $('.ago').prettyDate(); }, 5000);

    $('.commit').click(function() {
      var $this = $(this);
      $('.commit').each(function(key, commit) {
        $(commit).removeClass('current');
      });
      $this.addClass('current');
      $('#frame').attr('src', $this.attr('data-dir'))
    });

  });
  function ISODateString(d){
    d = new Date(d);
    function pad(n) { return n < 10 ? '0' + n : n }
    return d.getUTCFullYear()+'-'
      + pad(d.getUTCMonth()+1)+'-'
      + pad(d.getUTCDate())+'T'
      + pad(d.getUTCHours())+':'
      + pad(d.getUTCMinutes())+':'
      + pad(d.getUTCSeconds())+'Z'
  }

  /*
   * JavaScript Pretty Date
   * Copyright (c) 2011 John Resig (ejohn.org)
   * Licensed under the MIT and GPL licenses.
   */

  // Takes an ISO time and returns a string representing how
  // long ago the date represents.
  function prettyDate(time){
    var date = new Date((time || "").replace(/-/g,"/").replace(/[TZ]/g," ")),
      diff = (((new Date()).getTime() - date.getTime()) / 1000),
      day_diff = Math.floor(diff / 86400);
        
    if ( isNaN(day_diff) || day_diff < 0 || day_diff >= 31 )
      return;
        
    return day_diff == 0 && (
        diff < 60 && "Just now" ||
        diff < 120 && "1 min ago" ||
        diff < 3600 && Math.floor( diff / 60 ) + " mins ago" ||
        diff < 7200 && "1 hour ago" ||
        diff < 86400 && Math.floor( diff / 3600 ) + " hours ago") ||
      day_diff == 1 && "Yesterday" ||
      day_diff < 7 && day_diff + " days ago" ||
      day_diff < 31 && Math.ceil( day_diff / 7 ) + " weeks ago";
  }

  // If jQuery is included in the page, adds a jQuery plugin to handle it as well
  if ( typeof jQuery != "undefined" )
    jQuery.fn.prettyDate = function(){
      return this.each(function(){
        var date = prettyDate(this.title);
        if ( date )
          jQuery(this).text( date );
      });
    };

  </script>
</head>
<body>

  <div id="list">

    {% for commit in commit_data %}

    <div data-dir="./{{commit.commit}}/" class="commit{% if loop.index == 1 %} current{% endif%}">
      <span class="number">{{ '%02d'|format(commit_data|length - loop.index + 1) }}</span>
      <span class="date">{{ commit.date.strftime('%m/%d') }}</span>
      <span class="ago" title="{{ commit.date.isoformat() }}Z"></span>
      <a class="popup" href="./{{commit.commit}}/" target="_blank">&nbsp;</a>
      <span class="hash">{{ commit.commit }}</span>
      <!-- <span class="branch">{{ commit.branch }}</span> -->
    </div>

    {% endfor %} 

  </div>

  <iframe id="frame" src="./{{commit_data[0].commit}}/"></iframe>

</body>
</html>