{% extends "base.html" %}
{% load gravatar %}
{% load hk_generic %}
{% load storm %}

{% block content %}

<div class="message-header">
    <a class="thread-back"
       href="{% url thread threadid=message.thread_id, mlist_fqdn=list_address %}">
    </a>
    <h1>{{ message.subject }}</h1>
</div>

<section id="thread_content">
	{% include 'messages/first_email.html' with first_mail=message %}
</section>

{% endblock %}

{% block additionaljs %}
<script type="text/javascript">
	$(document).ready(function() {
		$(".voteup").click(function() {
			// @TODO: Extract the message id from the HTML DOM element instead of hard coding it in Javascript.
			message_id = this.parentElement.getAttribute('messageid');
			{% if user.is_authenticated %}
			$.ajax({
				type : "POST",
				url : "{% url message_vote mlist_fqdn=list_address %}",
				data : {
					vote : 1,
					messageid : message_id,
					list : "{{list_address}}",
					csrfmiddlewaretoken : '{{ csrf_token }}'
				},
				success : function(response) {
					console.log(response);
					location.reload();
				}
			});
			return false;
			{% else %}
				alert('You need to login in order to vote');
			{% endif %}
		});

		$(".votedown").click(function() {
			message_id = this.parentElement.getAttribute('messageid');
			{% if user.is_authenticated %}
			$.ajax({
				type : "POST",
				url : '{% url message_vote mlist_fqdn=list_address %}',
				data : {
					vote : -1,
					messageid : message_id,
					list : "{{list_address}}",
					csrfmiddlewaretoken : '{{ csrf_token }}'
				},
				success : function(response) {
					console.log(response);
					// @TODO : Remove this reload and update count using AJAX
					location.reload();
				}
			});
			return false;
			{% else %}
				alert('You need to login in order to vote');
			{% endif %}

		});

	});
</script>

{% endblock %}
