---
- name: Common configuration
  hosts: gridengine_master:gridengine_clients
  vars_files:
    - vars/os
  tasks:
    - include: common/tasks/hosts.yml hosts=${groups.all}
    - name: set hostname
      action: command hostname $inventory_hostname

- name: GridEngine masternode Playbook
  hosts: gridengine_master
  vars_files:
    - vars/os
  tasks: 
    - include: gridengine/tasks/master.yml
    - include: slurm/tasks/nfs.yml
    - action: nfsexport path=/home dest=/etc/exports clients=${groups.slurm_clients} options=rw,no_root_squash,sync
      notify: reload exports
  handlers:
    - include: slurm/handlers/main.yml
    - include: gridengine/handlers/main.yml

- name: GridEngine worker nodes Playbook
  hosts: gridengine_clients
  vars_files:
    - vars/os
  tasks: 
    - include: slurm/tasks/nfs-clients.yml nfsserver=${groups.gridengine_master[0]}
    - include: gridengine/tasks/clients.yml
  handlers:
    - include: gridengine/handlers/main.yml

