<?xml version="1.0" encoding="utf-8"?>
<!--
${LICENSE_HEADER}
-->
<openerp>
    <data>
{%  for menu in MENUES %}\
{%    def model(s='.') %}${menu.relateds(uml.CClass)[0].oerp_id(s, False)}{% end %}\
{%    def emodel(s='.') %}${menu.relateds(uml.CClass)[0].oerp_id(s)}{% end %}\
{%    if 'action' not in menu.tag and len(list(menu.relateds(uml.CClass))) == 1 %}\
        <record id="action_${model('_')}_${menu.name}" model="ir.actions.act_window">
            <field name="name">${escape(menu.tag.get('label', menu.name))}</field>
            <field name="res_model">${emodel()}</field>
            <field name="view_type">${menu.tag.get('view_type', 'form')}</field>
            <field name="view_mode">${menu.tag.get('view_mode', 'tree,form')}</field>
            <field name="view_id" ref="view_${model('_')}_tree"/>
            <field name="search_view_id" ref="view_${model('_')}_filter"/>
{%          if 'context' in menu.tag %}\
            <field name="context">${menu.tag['context']}</field>
{%          end %}\
{%          if 'domain' in menu.tag %}\
            <field name="domain">${menu.tag['domain']}</field>
{%          end %}\
        </record>
{%    end %}\

        <menuitem
            name="${escape(menu.tag.get('label', '<No label>'))}"
            id="menu_${menu.name}"
            sequence="${menu.tag.get('menu_sequence',100)}"
{%      if 'action' in menu.tag %}\
            action="${menu.tag['action']}"
{%      end %}\
{%      if 'action' not in menu.tag and len(list(menu.relateds(uml.CClass))) == 1 %}\
            action="action_${model('_')}_${menu.name}"
{%      end %}\
{%      if len(list(menu.prevs(uml.CUseCase))) > 0 %}\
            parent="menu_${menu.prevs(uml.CUseCase)[0].name}"
{%      end %}\
{%      if len(list(menu.prev_leafs(uml.CActor))) > 0 %}\
            groups="${','.join([ 'group_%s' % actor.name for actor in menu.prev_leafs(uml.CActor)])}"
{%      end %}\
            />

{%  end %}\
    </data>
</openerp>
<!-- vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4
     -->
