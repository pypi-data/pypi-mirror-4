define("router",["environ","jquery","underscore","backbone"],function(e,t,n,r){var i,s,o;return i=!1,o={},s=[],App.router=new r.Router,App.register=function(e,r,u){var a=this;if(o[r]!=null)throw new Error(""+r+" view already registered");o[r]=u;if(e===!1){typeof u.load=="function"&&u.load(),typeof u.resolve=="function"&&u.resolve();return}return this.router.route(e,r,function(){var e,t,u,a,f,l,c;if(!i){i=!0;for(f=0,l=s.length;f<l;f++)c=s[f],typeof (e=o[c]).unload=="function"&&e.unload(),typeof (t=o[c]).pending=="function"&&t.pending();s=[],n.defer(function(){return i=!1})}return typeof (u=o[r]).load=="function"&&u.load(),typeof (a=o[r]).resolve=="function"&&a.resolve(),s.push(r)}),this.router.on("route:"+r,function(){var e;return e=t("[data-route]"),e.parent().removeClass("active"),e.filter("[data-route="+r+"]").parent().addClass("active")})}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("session",["environ","mediator","underscore","backbone"],function(e,t,n,r){var i;return i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.url=App.urls.preferences,n.prototype.defaults={json:{}},n.prototype.initialize=function(){var e=this;n.__super__.initialize.apply(this,arguments),t.subscribe("session/changed",this.when(function(t,n){var r,i;return r=e.get("json"),(i=r.session)||(i=r.session={}),i[t]=n,e.save()})),this.on("sync",function(){return t.publish("session/synced")})},n.prototype.load=function(){var e,n,r,i;n=this.get("json"),i=n.session||{};for(r in i)e=i[r],t.publish("session/load/"+r,e)},n}(r.Model),App.preferences=new i,App.preferences.fetch()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("serrano/datafield",["backbone"],function(e){var t,n;return t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(e.Model),n=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.model=t,n}(e.Collection),{DataField:t,DataFields:n}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("serrano/dataconcept",["backbone"],function(e){var t,n;return t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(e.Model),n=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.model=t,n}(e.Collection),{DataConcept:t,DataConcepts:n}}),define("serrano/channels",[],function(){return{DATACONTEXT_CHANGED:"datacontext/changed",DATACONTEXT_SYNCING:"datacontext/syncing",DATACONTEXT_SYNCED:"datacontext/synced",DATACONTEXT_PAUSE:"datacontext/pause",DATACONTEXT_RESUME:"datacontext/resume",DATACONTEXT_ADD:"datacontext/add",DATACONTEXT_REMOVE:"datacontext/remove",DATACONTEXT_CLEAR:"datacontext/clear",DATAVIEW_CHANGED:"dataview/changed",DATAVIEW_SYNCING:"dataview/syncing",DATAVIEW_SYNCED:"dataview/synced",DATAVIEW_PAUSE:"dataview/pause",DATAVIEW_RESUME:"dataview/resume",DATAVIEW_COLUMNS:"dataview/columns",DATAVIEW_ORDERING:"dataview/ordering"}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__slice=[].slice,__bind=function(e,t){return function(){return e.apply(t,arguments)}};define("serrano/datacontext",["mediator","underscore","backbone","serrano/channels"],function(e,t,n,r){var i,s,o,u,a,f;return u=function(e){var t;return(e.type==="and"||e.type==="or")&&((t=e.children)!=null?t.length:void 0)>=2},f=function(e){return e.operator&&e.id&&e.value!==void 0},a=function(e){return e.composite===!0&&e.id},s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.validate=function(e){var t,n;if(u(e)||f(e)||a(e))return;for(t in e){n=e[t];if(n!==void 0)return"Unknown node type"}},n.prototype.toJSON=function(){var e;return this.isBranch()?e={type:this.get("type"),children:this.get("children")}:this.isComposite()?e={id:this.get("id"),composite:this.get("composite")}:e={id:this.get("id"),operator:this.get("operator"),value:this.get("value")},e},n.prototype.isRoot=function(){return this.parent==null},n.prototype.isEmpty=function(){return t.isEmpty(this.attributes)},n.prototype.isBranch=function(){return u(this.attributes)},n.prototype.isCondition=function(){return f(this.attributes)},n.prototype.isComposite=function(){return a(this.attributes)},n.prototype.siblings=function(){return this.isRoot()?!1:t.without(this.parent.get("children"),this)},n.prototype.promote=function(){var e,r,i,s=this;r=1<=arguments.length?__slice.call(arguments,0):[];if(r.length===0)throw new Error("At least one node must be supplied");return this.isRoot()?i="and":i=this.parent.get("type")==="and"?"or":"and",e=t.map([this.attributes].concat(__slice.call(r)),function(e){return n.parseAttrs(e,s)}),this.clear({slient:!0}),this.set({type:i,children:e}),this},n.prototype.demote=function(){return this.isRoot()?!1:this.parent.isRoot()?this.siblings().length===0?(this.parent.clear({silent:!0}),this.parent.set(this.attributes),this.parent):!1:(this.parent.parent.get("children").push(this.remove()),this)},n.prototype.add=function(){var e,t;e=1<=arguments.length?__slice.call(arguments,0):[];if(!this.isBranch())throw new Error('Node is not a branch. Use "promote" to convert it into one');return(t=this.get("children")).push.apply(t,e),this},n.prototype.remove=function(){var e,t;return this.isRoot()?this.clear():(e=this.parent.get("children"),(t=e.indexOf(this))>=0&&(e.splice(t,1)[0],e.length===1&&e[0].demote())),this},n}(n.Model),s.parseAttrs=function(e,n,r){var i,o;if(!e||t.isEmpty(e))o=new s;else if(e instanceof s)o=e;else if(u(e))o=new s({type:e.type}),i=t.map(e.children,function(e){return s.parseAttrs(e,o,r)}),o.set({children:i});else if(f(e))o=new s(e);else{if(!a(e))throw new Error("Unknown node type");o=new s(e)}return n&&(o.parent=n),typeof r=="function"&&r(o),o},s.updateAttrs=function(e,t){var n,r,i,o,u,a,f;if(e.isBranch()){n=e.get("children"),a=t.children,f=[];for(r=o=0,u=a.length;o<u;r=++o)i=a[r],f.push(s.updateAttrs(n[r],i));return f}return e.set(t)},i=function(n){function i(){return this._deferenceNode=__bind(this._deferenceNode,this),this._cacheNode=__bind(this._cacheNode,this),this.parse=__bind(this.parse,this),i.__super__.constructor.apply(this,arguments)}return __extends(i,n),i.prototype.deferred={save:!0},i.prototype.initialize=function(){var n,o,u,a=this;return i.__super__.initialize.apply(this,arguments),(n=this.nodes)==null&&(this.nodes={}),(o=this.clientNodes)==null&&(this.clientNodes={}),(u=this.root)==null&&(this.root=new s),this.on("sync",function(){return e.publish(r.DATACONTEXT_SYNCED,this,"success")}),this.on("error",function(){return e.publish(r.DATACONTEXT_SYNCED,this,"error")}),this.on("change",function(){return e.publish(r.DATACONTEXT_CHANGED,this)}),e.subscribe(r.DATACONTEXT_PAUSE,function(e){if(a.id===e||!e&&a.isSession())return a.pending()}),e.subscribe(r.DATACONTEXT_RESUME,function(e){if(a.id===e||!e&&a.isSession())return a.resolve()}),e.subscribe(r.DATACONTEXT_ADD,function(e,n){var r;t.isBoolean(n)&&(r=n,n=null);if(a.id===n||!n&&a.isSession())return a.add(e)}),e.subscribe(r.DATACONTEXT_REMOVE,function(e,n){var r;t.isBoolean(n)&&(r=n,n=null);if(a.id===n||!n&&a.isSession())return a.remove(e)}),e.subscribe(r.DATACONTEXT_CLEAR,function(e){if(a.id===e||!e&&a.isSession())return a.clear()}),this.resolve()},i.prototype.url=function(){return this.isNew()?i.__super__.url.apply(this,arguments):this.get("_links").self.href},i.prototype.parse=function(e){return e&&(this.root?s.updateAttrs(this.root,e.json):(this.nodes={},this.clientNodes={},this.root=s.parseAttrs(e.json,null,this._cacheNode))),e},i.prototype.save=function(){return e.publish(r.DATACONTEXT_SYNCING,this),i.__super__.save.apply(this,arguments)},i.prototype.toJSON=function(){var e;return e={id:this.id,name:this.get("name"),json:null,description:this.get("description"),keywords:this.get("keywords"),published:this.get("published"),archived:this.get("archived"),composite:this.get("composite"),session:this.get("session")},this.root&&!this.root.isEmpty()&&(e.json=this.root.toJSON()),e},i.prototype._cacheNode=function(e){var t;if(e.id)return(t=this.nodes[e.id])||(t=this.nodes[e.id]=[]),t.indexOf(e)===-1&&t.push(e),this.clientNodes[e.cid]=e},i.prototype._deferenceNode=function(e){var t,n;return(t=this.nodes[e.id])&&(n=t.indexOf(e))>=0&&t.splice(n,1),delete this.clientNodes[e.cid]},i.prototype.isSession=function(){return this.get("session")},i.prototype.getNodes=function(e){return this.nodes[e]||[]},i.prototype.add=function(e){var t;return this.clientNodes[e.cid]||(this._cacheNode(e),this.root.isEmpty()?this.root=e:this.root.isBranch()&&!this.root.id?this.root.get("children").push(e):(t=new s({type:"and",children:[this.root,e]}),this.root=t)),this.save()},i.prototype.remove=function(e){var t,n;return this.clientNodes[e.cid]&&(e===this.root?this.root=new s:this.root.isBranch()&&(t=this.root.get("children"),(n=t.indexOf(e))>=0&&t.splice(n,1)[0],t.length===1&&(this.root=t[0])),this._deferenceNode(e)),this.save()},i.prototype.clear=function(){return this.nodes={},this.clientNodes={},this.root.id?this.root=new s:this.root.clear(),this.save()},i}(n.Model),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.model=i,t.prototype.initialize=function(){t.__super__.initialize.apply(this,arguments),this.on("reset",function(e){var t,n,r,i,s;this.resolve(),i=e.models,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(t.trigger("sync"));return s})},t.prototype.hasSession=function(){return!!this.filter(function(e){return e.get("session")})[0]},t}(n.Collection),App.DataContextNode=s,{DataContextNode:s,DataContext:i,DataContexts:o}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("serrano/dataview",["environ","mediator","underscore","backbone","serrano/channels"],function(e,t,n,r,i){var s,o;return s=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return __extends(r,e),r.prototype.url=function(){return this.isNew()?r.__super__.url.apply(this,arguments):this.get("_links").self.href},r.prototype.deferred={save:!0},r.prototype.initialize=function(){var e=this;return r.__super__.initialize.apply(this,arguments),this.on("sync",function(){return t.publish(i.DATAVIEW_SYNCED,this,"success")}),this.on("error",function(){return t.publish(i.DATAVIEW_SYNCED,this,"error")}),this.on("change",function(){return t.publish(i.DATAVIEW_CHANGED,this)}),t.subscribe(i.DATAVIEW_PAUSE,function(t){if(e.id===t||!t&&e.isSession())return e.pending()}),t.subscribe(i.DATAVIEW_RESUME,function(t){if(e.id===t||!t&&e.isSession())return e.resolve()}),t.subscribe(i.DATAVIEW_COLUMNS,function(t,r){var i;n.isArray(t)&&(r=t,t=null);if(e.id===t||!t&&e.isSession())return(i=e.get("json"))||(i={}),i.columns=r,e.set("json",i),e.save()}),t.subscribe(i.DATAVIEW_ORDERING,function(t,r){var i;n.isArray(t)&&(r=t,t=null);if(e.id===t||!t&&e.isSession())return(i=e.get("json"))||(i={}),i.ordering=r,e.set("json",i),e.save()}),this.resolve()},r.prototype.isSession=function(){return this.get("session")},r.prototype.toJSON=function(){return{id:this.id,json:this.get("json"),session:this.get("session"),archived:this.get("archived"),published:this.get("published")}},r.prototype.save=function(){return t.publish(i.DATAVIEW_SYNCING,this),r.__super__.save.apply(this,arguments)},r}(r.Model),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.model=s,t.prototype.initialize=function(){t.__super__.initialize.apply(this,arguments),this.on("reset",function(e){var t,n,r,i,s;this.resolve(),i=e.models,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(t.trigger("sync"));return s})},t.prototype.hasSession=function(){return!!this.filter(function(e){return e.get("session")})[0]},t}(r.Collection),{DataView:s,DataViews:o}});var __slice=[].slice;define("serrano",["underscore","serrano/datafield","serrano/dataconcept","serrano/datacontext","serrano/dataview"],function(){var e,t;return t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],t.extend.apply(t,[{}].concat(__slice.call(e)))});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("models/datafield",["environ","serrano"],function(e,t){var n;return n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url=App.urls.datafields,t}(t.DataFields),App.DataField=new n});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("models/dataconcept",["environ","serrano"],function(e,t){var n;return n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url=App.urls.dataconcepts,t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this.on("reset",this.resolve),this.fetch()},t}(t.DataConcepts),App.DataConcept=new n});var __slice=[].slice;define("main",["environ","jquery","underscore","backbone","router","session","models/datafield","models/dataconcept"],function(e,t,n,r){var i,s;return s=App.routes,i=n.pluck(s,"module"),require(i,function(){var n,i,o,u,a,f,l;u=1<=arguments.length?__slice.call(arguments,0):[],a=e.SCRIPT_NAME||"/",a.substr(a.length-1)!=="/"&&(a+="/");for(o=f=0,l=s.length;f<l;o=++f){n=s[o];if(!n.module)continue;i=n.url?n.url.substr(a.length):!1,App.register(i,n.name,new u[o](n.options))}return r.history.start({root:a,pushState:!0}),App.preferences.load(),require(["models/datacontext","models/dataview"]),t(function(){var e,n,r,i,o;n=t('<ul class="nav pull-left" />');for(i=0,o=s.length;i<o;i++){r=s[i];if(!r.url)continue;e=t('<li><a href="'+r.url+'" data-route="'+r.name+'">'+r.label+"</a></li>"),n.append(e)}return n.appendTo("header .container-fluid"),t("body").on("click","[data-route]",function(e){var n;return e.preventDefault(),n=t(this).data("route"),n.substr(n.length-1)!=="/"&&(n+="/"),App.router.navigate(n,{trigger:!0})})})})});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("models/datacontext",["underscore","serrano"],function(e,t){var n,r,i,s;return r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url=App.urls.datacontexts,t}(t.DataContexts),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url=App.urls.datacontextHistory,t}(t.DataContexts),i=new r,i.on("reset",function(){var e;if(!i.hasSession())return e={session:!0},e.json=App.defaults.datacontext,i.create(e)}),s=new n,i.fetch(),s.fetch()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("models/dataview",["underscore","serrano"],function(e,t){var n,r,i,s;return r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url=App.urls.dataviews,t}(t.DataViews),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url=App.urls.dataviewHistory,t}(t.DataViews),s=new r,s.on("reset",function(){var e;if(!s.hasSession())return e={session:!0},e.json=App.defaults.dataview,s.create(e)}),i=new n,s.fetch(),i.fetch()})