{% extends "base.html" %}
{% load i18n autobreadcrumb %}

{% block head_title %}{{ board_title }}{% endblock %}
{% block head_more_links %}
    <link rel="stylesheet" href="{{ STATIC_URL }}sveedocuments/css/content.css" type="text/css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}djangotribune/djangotribune.css" type="text/css" />
{% endblock %}
{% block head_more_js %}
<script type="text/javascript" src="{{ STATIC_URL }}jquery/plugins/jquery.querystring.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}jquery/plugins/jquery.cookies.2.2.0.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}djangotribune/timer.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}djangotribune/csrf.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}djangotribune/djangotribune.js"></script>
<script language="JavaScript" type="text/javascript">
//<![CDATA[
    $(document).ready(function() {
        {% if debug %}DEBUG = true;{% endif %}
        $(".djangotribune").djangotribune({
            "host" : '{{ SITE.web_url }}',
            "remote_path": '{{ tribune_backend_url }}',
            "post_path": '{{ tribune_post_url }}',
            {% if tribune_channel %}"channel": "{{ tribune_channel.slug }}",
            {% endif %}{% if user.is_authenticated %}"authenticated_username": "{{ user.username }}",
            {% endif %}"message_limit": {{ message_display_limit }}
        });
    });
//]]>
</script>
{% endblock %}

{% block body_attr %} class="fixed_width absolute_width"{% endblock %}

{% block content %}
<h2>{{ board_title }}</h2>

<div class="notice">
    <p>This is the early staging for a <em>rich</em> interface. Actually implemented features are :</p>
    <ul>
        <li>Refresh backend using a timer;</li>
        <li>Checkbox to disable/enable the automatic refresh;</li>
        <li><em>Ajax</em> post;</li>
        <li>Action commands (<tt>name</tt> and <tt>lastfm</tt>);</li>
        <li>Mussle and user casting (<tt>moules&lt;</tt> and <tt>an_username&lt;</tt>);</li>
        <li>Smileys display;</li>
        <li>Partial channel support;</li>
        <li>Simple clock and messages highlights.</li>
    </ul>
    <p>There are currently no editable setting, no owner marks, no error notices, etc.. And this need to be more tested on various browsers.</p>
</div>

<div class="djangotribune">
    <ul class="messages">
        {% for row in message_list %}
        <li class="message msgclock_{{ row.clockclass }}">
            <span class="pk" style="display:none;">{{ row.id }}</span>
            <span class="created" style="display:none;">{{ row.created|date:"YmdHis" }}</span>
            <span class="clock_indice" style="display:none;">{{ row.clock_indice }}</span>
            <span class="clockclass" style="display:none;">{{ row.clockclass }}</span>
            <span class="clock">{{ row.clock|time:"H:i:s" }}{% ifnotequal row.clock_indice 1 %}<sup>{{ row.clock_indice }}</sup>{% else %}&nbsp;&nbsp;{% endifnotequal %}</span>
            <strong>{% spaceless %}{% if row.author__username %}
                <span class="identity authenticated" title="{{ row.user_agent }}">{{ row.author__username }}</span>
            {% else %}
                <span class="identity anonymous" title="{{ row.user_agent }}">{{ row.user_agent|slice:"0:30" }}</span>
            {% endif %}</strong>{% endspaceless %}
            <span class="content">{{ row.web_render|safe }}</span>
        </li>
        {% empty %}
            <li class="notice empty">{% trans 'There is no message yet, you should post the first one !' %}</li>
        {% endfor %}
    </ul>

    <form action="." method="post">{% csrf_token %}
        {{ form.as_p }}
        <p>
            <input type="submit" value="Ok" />
        </p>
    </form>
    
</div>
{% endblock %}