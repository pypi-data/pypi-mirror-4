var __hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("cilantro/types/report/models",["backbone"],function(a){var b,c,d;return b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.url=function(){var a;return a=b.__super__.url.apply(this,arguments),/\/$/.test(a)||(a+="/"),a},b.prototype.initialize=function(){return this.bind("change",function(){return App.hub.publish("report/change",this)})},b}(a.Model),c=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return __extends(c,a),c.prototype.url=App.endpoints.reports,c.prototype.model=b,c.prototype.comparator=function(a){return-Number(new Date(a.get("modified")))},c}(a.Collection),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.url=App.endpoints.session.report,b.prototype.defaults={name:"click to give your report a name...",description:"click to give your report a description..."},b.prototype.initialize=function(){var a=this;return b.__super__.initialize.apply(this,arguments),App.hub.subscribe("report/clear",function(){return a.clear({silent:!0}),a.save(null,{success:function(){return window.location=App.endpoints.define}})}),App.hub.subscribe("report/change",function(b){if(b.id===a.get("reference_id"))return a.set(b.toJSON())})},b.prototype.push=function(){return this.save(null,{url:this.get("permalink"),success:function(){return App.hub.publish("report/push",this)}})},b.prototype.revert=function(){return this.save(null,{data:JSON.stringify({revert:!0}),contentType:"application/json",success:function(){return App.hub.publish("report/revert",this)}})},b}(a.Model),{Model:b,Collection:c,Session:d}});var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("common/views/collection",["backbone","common/utils"],function(a,b){var c,d,e;return c=function(b){function c(){return this.update=__bind(this.update,this),this.destroy=__bind(this.destroy,this),this.remove=__bind(this.remove,this),this.reset=__bind(this.reset,this),this.add=__bind(this.add,this),this.all=__bind(this.all,this),c.__super__.constructor.apply(this,arguments)}return __extends(c,b),c.prototype.viewClass=a.View,c.prototype.defaultContent=null,c.prototype.initialize=function(){this.childViews={},this.collection.bind("add",this.add),this.collection.bind("reset",this.reset),this.collection.bind("remove",this.remove),this.collection.bind("destroy",this.destroy),this.collection.bind("change",this.update);if(this.defaultContent)return this.collection.bind("all",this.all),this.defaultContent=this.$(this.defaultContent).detach(),this.el.append(this.defaultContent)},c.prototype.insertChild=function(a){return this.el.append(a.el)},c.prototype.all=function(){return this.collection.length?this.defaultContent.hide():this.defaultContent.show()},c.prototype.add=function(a){var b;return(b=this.childViews[a.id||a.cid])?clearTimeout(b._destroyTimer):(b=this.childViews[a.id||a.cid]=(new this.viewClass({model:a})).render(),this.insertChild(b)),b},c.prototype.reset=function(a,b){return a.each(this.add)},c.prototype.remove=function(a){var b,c=this;return b=this.childViews[a.id||a.cid],b.el.detach(),b._destroyTimer=setTimeout(function(){return c.destroy(a)},1e4)},c.prototype.destroy=function(a){return this.childViews[a.id||a.cid].el.remove()},c.prototype.update=function(a){var b;return b=this.childViews[a.id||a.cid],!b&&(b=this.childViews[a.cid])&&(this.childViews[a.id]=b,delete this.childViews[a.cid]),b.render()},c}(a.View),d={collapsedLength:5,getItems:function(){return this.el.children()},getHiddenItems:function(){return this.getItems().filter(":gt("+(this.collapsedLength-1)+")")},getExpanderText:function(){return"Show "+this.getHiddenItems().length+" more.."},renderExpander:function(){var a=this;return this.expander=this.$('<a class="expand-list" href="#">'+this.getExpanderText()+"</a>").bind("click",function(){return a.expand(),!1}),this.el.after(this.expander)},expand:function(){return this.getHiddenItems().show(),this.expander.remove()},collapse:function(){this.expander&&this.expander.remove();if(this.getItems().length>this.collapsedLength)return this.getHiddenItems().hide(),this.renderExpander()}},e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(a.View),b.include(e,d),{View:c,ExpandableListMixin:d,ExpandableList:e}});var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("cilantro/types/report/views",["backbone","common/utils","common/views/collection"],function(a,b,c){var d,e,f,g,h;return d=function(a){function b(){return this.editHandler=__bind(this.editHandler,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.el='<div id="report-editor">            <input type="text" name="name" placeholder="Name...">            <textarea name="description" placeholder="Description..."></textarea>            <div class="controls">                <button class="cancel">Cancel</button>                <button class="save">Save</button>            </div>        </div>',b.prototype.elements={"[name=name]":"name","[name=description]":"description",".save":"saveButton",".cancel":"cancelButton"},b.prototype.events={"click .save":"save","click .cancel":"cancel"},b.prototype.initialize=function(){return App.hub.subscribe("report/edit",this.editHandler),this.el.appendTo("body").dialog({dialogClass:"ui-dialog-simple",autoOpen:!1,modal:!0,resizable:!1,draggable:!0,position:["center",150],width:500})},b.prototype.editHandler=function(a){return this.name.val(a.get("name")),this.description.val(a.get("description")),this.activeModel=a,this.el.dialog("open")},b.prototype.save=function(){return this.activeModel.set({name:this.name.val(),description:this.description.val()}),this.activeModel.save(),this.activeModel.isNew()&&this.activeModel.collection.add(this.activeModel),delete this.activeModel,this.el.dialog("close")},b.prototype.cancel=function(){return delete this.activeModel,this.el.dialog("close")},b}(a.View),e={edit:function(a,b){return b==null&&(b=this.model),App.hub.publish("report/edit",b),!1}},f=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.el='<section class="report">                <strong><a role="name"></a></strong>                <span class="info">- <span role="unique-count"></span> unique <span role="verbose-name"></span></span>                <span class="info time" style="float: right">modified <span role="modified"></span><span role="timesince"></span></span>                <div role="description"></div>                <div class="controls">                    <button class="delete">Delete</button>                    <button class="edit">Edit</button>                    <button class="copy">Copy</button>                </div>            </section>',b.prototype.events={"click .time":"toggleTime","click .edit":"edit","click .copy":"copy","click .delete":"delete",mouseenter:"showControls",mouseleave:"hideControls"},b.prototype.elements={"[role=name]":"name","[role=unique-count]":"uniqueCount","[role=verbose-name]":"verboseName","[role=modified]":"modified","[role=timesince]":"timesince","[role=description]":"description",".controls":"controls"},b.prototype.render=function(){var a,b;return this.name.text(this.model.get("name")),this.name.attr("href",this.model.get("permalink")),this.modified.text(this.model.get("modified")),this.timesince.text(this.model.get("timesince")),(a=this.model.get("description"))?this.description.show().text(a):this.description.hide().text("No description provided"),this.uniqueCount.text(b=this.model.get("unique_count")),b===1?this.verboseName.text(this.model.get("model_name")):this.verboseName.text(this.model.get("model_name_plural")),this},b.prototype.toggleTime=function(a){return this.modified.toggle(),this.timesince.toggle(),a.stopPropagation()},b.prototype.showControls=function(a){var b=this;return this._controlsTimer=setTimeout(function(){return b.controls.slideDown(200)},700),!1},b.prototype.hideControls=function(a){return clearTimeout(this._controlsTimer),this.controls.slideUp(300),!1},b.prototype.copy=function(a){var b;return b=this.model.clone(),b.set("id",null),b.set("name",b.get("name")+" (copy)"),b.set("_id",this.model.id),b.collection=this.model.collection,this.edit(a,b),!1},b.prototype["delete"]=function(){return this.model.destroy()},b}(a.View),g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.el="#report-list",b.prototype.viewClass=f,b.prototype.defaultContent='<section class="info">You have no saved reports.</section>',b}(c.View),h=function(a){function b(){return this.render=__bind(this.render,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.el="#report-name",b.prototype.events={click:"edit",mouseover:"hover",mouseout:"hover"},b.prototype.initialize=function(a){return this.model.bind("change:name",this.render),this.hoverText=this.$('<span class="info">click to edit</span>')},b.prototype.render=function(){var a;return this.el.text(""),(a=this.model.get("name"))?(this.el.removeClass("placeholder"),this.el.append(this.hoverText.hide())):(this.el.addClass("placeholder"),a=this.model.defaults.name,this.hoverText.detach()),this.el.prepend(a+" ")},b.prototype.hover=function(){return this.hoverText.toggle()},b}(a.View),b.include(f,e),b.include(g,c.ExpandableListMixin),b.include(h,e),{Name:h,Item:f,List:g,Editor:d}});var __hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("cilantro/types/report/messages",["underscore","cilantro/utils/logging"],function(a,b){var c,d;return d={UnsavedReportTemplate:'<div class="message-block warning">                <div class="content">                    <strong role="name"><%= name %></strong> has unsaved changes                </div>                <button class="revert">Revert</button>                <button class="save">Save</button>            </div>'},c=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return __extends(c,b),c.prototype.template=a.template(d.UnsavedReportTemplate),c.prototype.elements={"[role=name]":"name"},c.prototype.events={"click .save":"save","click .revert":"revert"},c.prototype.initialize=function(){var a=this;return this.render(),this.model.bind("change:name",function(b,c){return a.el.find("[role=name]").text(c)}),this.model.bind("change:has_changed",function(b,c){return c?App.hub.publish("log",a):App.hub.publish("dismiss",a)})},c.prototype.render=function(){return this.el=this.$(this.template(this.model.toJSON())),this.setLocalElements(),this.delegateEvents(),this},c.prototype.save=function(){return this.model.push()},c.prototype.revert=function(){return this.model.revert()},c}(b.MessageView),{UnsavedReport:c,templates:d}}),define("cilantro/types/report/main",["cilantro/types/report/models","cilantro/types/report/views","cilantro/types/report/messages"],function(a,b,c){return{Models:a,Views:b,Messages:c}});var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("cilantro/types/scope/models",["backbone"],function(a){var b;return b=function(a){function b(){return this.revert=__bind(this.revert,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.url=App.endpoints.session.scope,b.prototype.initialize=function(){return b.__super__.initialize.apply(this,arguments),App.hub.subscribe("report/revert",this.revert)},b.prototype.revert=function(){return this.fetch()},b}(a.Model),{Session:b}}),define("cilantro/types/scope/main",["cilantro/types/scope/models"],function(a){return{Models:a}});var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("cilantro/types/perspective/models",["backbone"],function(a){var b;return b=function(a){function b(){return this.revert=__bind(this.revert,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.url=App.endpoints.session.perspective,b.prototype.initialize=function(){return b.__super__.initialize.apply(this,arguments),App.hub.subscribe("report/revert",this.revert)},b.prototype.revert=function(){return this.fetch()},b}(a.Model),{Session:b}}),define("cilantro/types/perspective/main",["cilantro/types/perspective/models"],function(a){return{Models:a}});var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("cilantro/pages/workspace/session",["underscore","common/views/collection","cilantro/types/report/main"],function(a,b,c){var d,e,f;return f=function(b){function c(){return this.render=__bind(this.render,this),c.__super__.constructor.apply(this,arguments)}return __extends(c,b),c.prototype.el="#session-scope",c.prototype.defaultContent='<li class="info">No conditions have been defined</li>',c.prototype.initialize=function(){return this.model.bind("change:conditions",this.render),this.defaultContent=this.$(this.defaultContent),this.el.append(this.defaultContent)},c.prototype.render=function(){var b,c,d,e;b=this.model.get("conditions"),this.defaultContent.detach(),this.el.empty();if(b){c="";for(d in b)e=b[d],a.map(e,function(a){return c+="<li>"+a+"</li>"});this.el.html(c)}else this.el.append(this.defaultContent);return this.collapse()},c}(b.ExpandableList),d=function(b){function c(){return this.render=__bind(this.render,this),c.__super__.constructor.apply(this,arguments)}return __extends(c,b),c.prototype.el="#session-perspective",c.prototype.defaultContent='<li class="info">No data columns have been choosen</li>',c.prototype.initialize=function(){return this.model.bind("change:header",this.render),this.defaultContent=this.$(this.defaultContent),this.el.append(this.defaultContent)},c.prototype.template=a.template('<li><%= name %><% if (direction) { %>            <span class="info">(<%= direction %>)</span><% } %></li>'),c.prototype.render=function(){var a,b,c,d;this.defaultContent.detach(),this.el.empty();if(b=this.model.get("header"))for(c=0,d=b.length;c<d;c++)a=b[c],this.el.append(this.template(a));else this.el.append(this.defaultContent);return this.collapse()},c}(b.ExpandableList),e=function(a){function b(){return this.render=__bind(this.render,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.el='<div>                <strong><a role="name"></a></strong>                <span class="info">- <span role="unique-count"></span> unique <span role="verbose-name"></span></span>                <span class="info time" style="float: right">modified <span role="modified"></span><span role="timesince"></span></span>                <div role="description"></div>            </div>',b.prototype.parent="#session-report",b.prototype.initialize=function(){return this.el.prependTo(this.parent),this.model.bind("change",this.render)},b.prototype.render=function(){var a;b.__super__.render.apply(this,arguments),a=this.model.get("name");if(this.model.hasChanged("name")&&a)return this.name.text(a).attr("href",this.model.get("permalink")).parent().show();if(!a)return this.name.text("(session)")},b}(c.Views.Item),{Report:e,Scope:f,Perspective:d}}),define("cilantro/pages/workspace/main",["jquery","cilantro/types/report/main","cilantro/types/scope/main","cilantro/types/perspective/main","cilantro/pages/workspace/session"],function(a,b,c,d,e){var f,g,h,i;return f=new b.Models.Collection,h=new b.Models.Session,i=new c.Models.Session,g=new d.Models.Session,a(function(){var c,d,j,k,l,m;return a("#new-report").click(function(){return App.hub.publish("report/clear")}),c=new b.Views.Editor,d=new b.Views.List({collection:f}),l=new e.Scope({model:i}),j=new e.Perspective({model:g}),k=new e.Report({model:h}),m=new b.Messages.UnsavedReport({model:h}),f.fetch(),h.fetch(),i.fetch(),g.fetch()})})