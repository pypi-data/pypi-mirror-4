

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Architecture &mdash; django SHOP 0.1.1.dev0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.1.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="django SHOP 0.1.1.dev0 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">django SHOP 0.1.1.dev0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="architecture">
<h1>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h1>
<p>This document should gather all the pre-code architecture requirements/research.</p>
<div class="section" id="core-system">
<h2>Core system<a class="headerlink" href="#core-system" title="Permalink to this headline">¶</a></h2>
<p>Generally, the shop system can be seen as two different phases, with two different problems to solve:</p>
<div class="section" id="the-shopping-phase">
<h3>The shopping phase:<a class="headerlink" href="#the-shopping-phase" title="Permalink to this headline">¶</a></h3>
<p>From a user perspective, this is where you shop around different product categories, and add desired products to
a shopping cart (or other abstraction). This is a very well-know type of website problematic from a user interface
perspective as well as from a model perspective: a simple &#8220;invoice&#8221; pattern for the cart is enough.</p>
<p>The complexity here is to start defining what a shop item should be.</p>
</div>
<div class="section" id="the-checkout-process">
<h3>The checkout process:<a class="headerlink" href="#the-checkout-process" title="Permalink to this headline">¶</a></h3>
<p>As the name implies, this is a &#8220;workflow&#8221; type of problem: we must be able to add or remove steps to the checkout process depending
on the presence or absence of some plugins.
For instance, a credit-card payment plugin whould be able to insert a payment details page with credit card details in the general workflow.</p>
<p>To solve this we could implement a workflow engine. The person implementing the webshop whould then define the process using
the blocks we provide, and the system should then &#8220;run on its own&#8221;.</p>
</div>
<div class="section" id="random-ideas">
<h3>Random ideas:<a class="headerlink" href="#random-ideas" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">multiple shops (site and prefixed)</p>
<blockquote>
<div><ul>
<li><p class="first">namespaced urls for shops</p>
<blockquote>
<div><p>psuedocode , is this possible and or a good idea? requires restarts like the cms apphooks.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">prefix</span> <span class="o">=</span> <span class="n">shop</span><span class="o">.</span><span class="n">prefix</span>
<span class="c"># shopsite.get_urls(shop) # returns a tuple of (urlpatterns, app_name, shop_namespace)</span>
<span class="n">url</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">shopsite</span><span class="o">.</span><span class="n">get_urls</span><span class="p">(</span><span class="n">shop</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;shop_prefix&#39;</span><span class="p">:</span> <span class="n">prefix</span><span class="p">})</span>
</pre></div>
</div>
<p>on a product</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_product_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;shop_</span><span class="si">%s</span><span class="s">:product_detail&#39;</span> <span class="o">%</span> <span class="n">threadlocals</span><span class="o">.</span><span class="n">shop_pk</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;category_slug&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">category_slug</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">product</span><span class="o">.</span><span class="n">slug</span><span class="p">})</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">middleware to find current shop based on site and or prefix/ set current shop id in threadlocals?( process view )</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">process_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view_func</span><span class="p">,</span> <span class="n">view_args</span><span class="p">,</span> <span class="n">view_kwargs</span><span class="p">)</span>
    <span class="n">shop_prefix</span> <span class="o">=</span> <span class="n">view_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;shop_prefix&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">shop_prefix</span><span class="p">:</span>
        <span class="n">shop</span> <span class="o">=</span> <span class="n">Shop</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">shop_prefix</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">shop</span> <span class="o">=</span> <span class="n">shop</span>
        <span class="n">threadlocals</span><span class="o">.</span><span class="n">shop_pk</span> <span class="o">=</span> <span class="n">shop</span><span class="o">.</span><span class="n">pk</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">class-based views</p>
</li>
<li><p class="first">class based plugins (not modules based!)</p>
</li>
</ul>
</div>
</div>
<div class="section" id="plugin-structure">
<h2>Plugin structure<a class="headerlink" href="#plugin-structure" title="Permalink to this headline">¶</a></h2>
<p>Plugins should be class based, as most of the other stuff in Django is (for instace the admins), with the framework
defining both a base class for plugin writers to extend, as well as a registration method for subclasses.</p>
<p>Proposal by fivethreeo for the plugin structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># django_shop/checkout/__init__.py</span>
<span class="c"># django_shop/checkout/__init__.py</span>


<span class="kn">from</span> <span class="nn">django_shop.checkout.site</span> <span class="kn">import</span> <span class="n">CheckoutSite</span><span class="p">,</span> <span class="n">checkoutsite</span>

<span class="k">def</span> <span class="nf">autodiscover</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Auto-discover INSTALLED_APPS admin.py modules and fail silently when</span>
<span class="sd">    not present. This forces an import on them to register any admin bits they</span>
<span class="sd">    may want.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">copy</span>
    <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
    <span class="kn">from</span> <span class="nn">django.utils.importlib</span> <span class="kn">import</span> <span class="n">import_module</span>
    <span class="kn">from</span> <span class="nn">django.utils.module_loading</span> <span class="kn">import</span> <span class="n">module_has_submodule</span>

    <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span><span class="p">:</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">submod</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;django_shop_payment&#39;</span><span class="p">,</span> <span class="s">&#39;django_shop_shipment&#39;</span><span class="p">)</span>
            <span class="c"># Attempt to import the app&#39;s admin module.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">before_import_registry</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">checkoutsite</span><span class="o">.</span><span class="n">_registry</span><span class="p">)</span>
                <span class="n">import_module</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">submod</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c"># Reset the model registry to the state before the last import as</span>
                <span class="c"># this import will have to reoccur on the next request and this</span>
                <span class="c"># could raise NotRegistered and AlreadyRegistered exceptions</span>
                <span class="c"># (see #8245).</span>
                <span class="n">site</span><span class="o">.</span><span class="n">_registry</span> <span class="o">=</span> <span class="n">before_import_registry</span>
    
                <span class="c"># Decide whether to bubble up this error. If the app just</span>
                <span class="c"># doesn&#39;t have an admin module, we can ignore the error</span>
                <span class="c"># attempting to import it, otherwise we want it to bubble up.</span>
                <span class="k">if</span> <span class="n">module_has_submodule</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">submod</span><span class="p">):</span>
                    <span class="k">raise</span>

<span class="c"># django_shop/checkout/site.py</span>

<span class="kn">from</span> <span class="nn">djangoshop.payment_base</span> <span class="kn">import</span> <span class="n">PaymentBase</span>
<span class="kn">from</span> <span class="nn">djangoshop.shipper_base</span> <span class="kn">import</span> <span class="n">ShipperBase</span>

<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">TemplateView</span>

<span class="k">class</span> <span class="nc">CheckoutView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">&quot;checkout.html&quot;</span>

<span class="k">class</span> <span class="nc">CheckoutSite</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">checkout_view</span> <span class="o">=</span> <span class="n">CheckoutView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">app_name</span><span class="o">=</span><span class="s">&#39;django_shop&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;shipper&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s">&#39;payment&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
         <span class="c"># model_class class -&gt; admin_class instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;checkout&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span> <span class="o">=</span> <span class="n">app_name</span>
        
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registry</span><span class="p">,</span> <span class="n">classtype</span><span class="p">,</span> <span class="n">class_or_iterable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers the given model(s) with the checkoutsite</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">classtype</span><span class="p">):</span>
            <span class="n">class_or_iterable</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_or_iterable</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">class_or_iterable</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">registry</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">AlreadyRegistered</span><span class="p">(</span><span class="s">&#39;The </span><span class="si">%s</span><span class="s"> class </span><span class="si">%s</span><span class="s"> is already registered&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
            <span class="c"># Instantiate the class to save in the registry</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">registry</span><span class="p">][</span><span class="n">cls</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

     <span class="k">def</span> <span class="nf">unregister</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registry</span><span class="p">,</span> <span class="n">classtype</span><span class="p">,</span> <span class="n">class_or_iterable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unregisters the given classes(s).</span>

<span class="sd">        If a class isn&#39;t already registered, this will raise NotRegistered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">classtype</span><span class="p">):</span>
            <span class="n">class_or_iterable</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_or_iterable</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">class_or_iterable</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">registry</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">NotRegistered</span><span class="p">(</span><span class="s">&#39;The </span><span class="si">%s</span><span class="s"> class </span><span class="si">%s</span><span class="s"> is not registered&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">registry</span><span class="p">][</span><span class="n">cls</span><span class="p">]</span> 
            
    <span class="k">def</span> <span class="nf">register_shipper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shipper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;shipper&#39;</span><span class="p">,</span> <span class="n">ShipperBase</span><span class="p">,</span> <span class="n">shipper</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">unregister_shipper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shipper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;shipper&#39;</span><span class="p">,</span> <span class="n">ShipperBase</span><span class="p">,</span> <span class="n">shipper</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">register_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payment</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;payment&#39;</span><span class="p">,</span> <span class="n">PaymentBase</span><span class="p">,</span> <span class="n">payment</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">unregister_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payment</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;payment&#39;</span><span class="p">,</span> <span class="n">PaymentBase</span><span class="p">,</span> <span class="n">payment</span><span class="p">)</span>
                
    <span class="k">def</span> <span class="nf">get_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>

        <span class="c"># Checkout-site-wide views.</span>
        <span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkout_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;checkout&#39;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c"># Add in each model&#39;s views.</span>
        <span class="k">for</span> <span class="n">payment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_payment_registry</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">payment</span><span class="p">,</span> <span class="s">&#39;urls&#39;</span><span class="p">):</span>
                <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^shipment/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">payment</span><span class="o">.</span><span class="n">url_prefix</span><span class="p">,</span>
                        <span class="n">include</span><span class="p">(</span><span class="n">payment</span><span class="o">.</span><span class="n">urls</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="k">for</span> <span class="n">shipper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shippers_registry</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">shipper</span><span class="p">,</span> <span class="s">&#39;urls&#39;</span><span class="p">):</span>
                <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^payment/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">payment</span><span class="o">.</span><span class="n">url_prefix</span><span class="p">,</span>
                        <span class="n">include</span><span class="p">(</span><span class="n">shipper</span><span class="o">.</span><span class="n">urls</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">urlpatterns</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_urls</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="n">checkoutsite</span> <span class="o">=</span> <span class="n">CheckoutSite</span><span class="p">()</span>

<span class="c"># django_shop/checkout/shipper_base.py</span>

<span class="k">class</span> <span class="nc">ShipperBase</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">pass</span>
    
<span class="c"># django_shop/checkout/payment_base.py</span>
<span class="kn">from</span> <span class="nn">djangoshop.</span> <span class="kn">import</span> <span class="n">RegisterAbleClass</span>

<span class="k">class</span> <span class="nc">PaymentBase</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkout_site</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">checkout_site</span> <span class="o">=</span> <span class="n">checkout_site</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PaymentBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
    
<span class="c"># app/django_shop_shipment.py</span>

<span class="kn">from</span> <span class="nn">djangoshop.shipper_base</span> <span class="kn">import</span> <span class="n">ShipperBase</span>

<span class="k">class</span> <span class="nc">ShipmentClass</span><span class="p">(</span><span class="n">ShipperBase</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkout_site</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">checkout_site</span> <span class="o">=</span> <span class="n">checkout_site</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PaymentBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
    
<span class="n">checkoutsite</span><span class="o">.</span><span class="n">register_shipment</span><span class="p">(</span><span class="n">ShipmentClass</span><span class="p">)</span>

<span class="c"># app/django_shop_payment.py</span>

<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">TemplateView</span>
<span class="kn">from</span> <span class="nn">djangoshop.payment_base</span> <span class="kn">import</span> <span class="n">PaymentBase</span>

<span class="k">class</span> <span class="nc">PaymentView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">&quot;payment.html&quot;</span>

<span class="k">class</span> <span class="nc">PaymentClass</span><span class="p">(</span><span class="n">PaymentBase</span><span class="p">,</span> <span class="n">UrlMixin</span><span class="p">):</span>
    
    <span class="n">url_prefix</span> <span class="o">=</span> <span class="s">&#39;payment&#39;</span>
    
    <span class="n">payment_view</span> <span class="o">=</span> <span class="n">PaymentView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>

        <span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">payment_view</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_payment&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_prefix</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">urlpatterns</span>
        
    <span class="k">def</span> <span class="nf">urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_urls</span><span class="p">()</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>
    
<span class="n">checkoutsite</span><span class="o">.</span><span class="n">register_payment</span><span class="p">(</span><span class="n">PaymentClass</span><span class="p">)</span>
</pre></div>
</div>
<p>Similar to the Django-CMS plugins, most of the shop plugins will probably have to render templates (for instance when
they want to define a new checkout step).</p>
</div>
<div class="section" id="shoppping-cart">
<span id="cart"></span><h2>Shoppping Cart<a class="headerlink" href="#shoppping-cart" title="Permalink to this headline">¶</a></h2>
<p>In its core this is a list of a kind of CartItems which relate to Product.</p>
<p>It should be possible to have the same Product in different CartItems
when some details are different. Stuff like different service addons
etc.</p>
</div>
<div class="section" id="prices">
<span id="id1"></span><h2>Prices<a class="headerlink" href="#prices" title="Permalink to this headline">¶</a></h2>
<p>This seems to be rather complex and must be pluggable. Prices may be
influenced by many different things like the Product itself,
quantities, the customer (location, special prices), shipping method
and the payment method. This all would have to be handled by special /
custom pricing implementations. The core implementation must only
include ways for such extension possibilities.</p>
<p>Prices will also be related to taxes in some way.</p>
<p>The core product implementation should possibly know nothing about
prices and taxes at all.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Architecture</a><ul>
<li><a class="reference internal" href="#core-system">Core system</a><ul>
<li><a class="reference internal" href="#the-shopping-phase">The shopping phase:</a></li>
<li><a class="reference internal" href="#the-checkout-process">The checkout process:</a></li>
<li><a class="reference internal" href="#random-ideas">Random ideas:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-structure">Plugin structure</a></li>
<li><a class="reference internal" href="#shoppping-cart">Shoppping Cart</a></li>
<li><a class="reference internal" href="#prices">Prices</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/OLD-out-of-date/architecture.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">django SHOP 0.1.1.dev0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Chris Glass.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>