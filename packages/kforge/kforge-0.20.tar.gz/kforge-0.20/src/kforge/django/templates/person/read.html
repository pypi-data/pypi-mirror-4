{% extends "person/master.html"%}

{% block title %}
  {% if isSessionPerson %}
    {{ person.getLabelValue|escape }}
  {% else %}
    {% if person %}
    {{ person.getLabelValue|escape }}
    {% else %}
    Profile - No name specified!
    {% endif %}
  {% endif %}
{% endblock %}

{% block content %}

  {% if person %}
    <h2>{{ person.getLabelValue}}</h2>
    <p class="greyed">Registered {{ person.dateCreated|date }}</p>

    <h3>Project memberships</h3>
    {% if memberships %}
    <table>
      {% for membership in memberships %}
      <tr>
        <td>
        {% if view.canUpdateMember or view.canDeleteMember or isSessionPerson %}
        <div style="float:right" class="actions">
          {% if view.canUpdateMember %}
        <a href="{{uriPrefix}}/projects/{{ membership.project.name }}/members/{{ person.name }}/edit/" title="Edit membership ({{ membership.project.getLabelValue }})"><img height="20" width="20" src="{{ kforge_media_url }}/images/icon-edit.png" alt="Edit" /></a>
          {% endif %}
          {% if view.canDeleteMember or isSessionPerson %}
        <a href="{{uriPrefix}}/projects/{{ membership.project.name }}/members/{{ person.name }}/delete/" title="Leave project ({{ membership.project.getLabelValue }})"><img height="20" width="20" src="{{ kforge_media_url }}/images/icon-delete.png" alt="Leave" /></a>
          {% endif %}
        {% endif %}
        </div>
        <a style="font-size: 130%" href="{{uriPrefix}}/projects/{{ membership.project.name}}/">{{membership.project.getLabelValue|escape}}</a>
        <br/>
        <span class="greyed">
        Member since {{ membership.dateCreated|date }}
        </span>
        <br/>
        {{ membership.role.getLabelValue }}
        {% for service in membership.project.getTracServices %}
        {% include "snippets/newticketlinks.html" %}
        {% endfor %}
        </td>
      </tr>
      {% endfor %}
    </table>
    {% else %}
      {% if isSessionPerson %}
    <p>You are not a member of any projects at this time.</p>
      {% else %}
      <p>No project memberships.</p>
      {% endif %}
    {% endif %}

  {% else %}
    <h2>No name specified</h2>
    <p class="flash-error">
      You'll need to <a href="{{uriPrefix}}/people/">select a user</a> in order to see a user's profile page.<br />
      <br />
      If you were looking for your profile page, please <a href="{{uriPrefix}}/login/">log in</a>.
    </p>
  {% endif %}  

{% endblock %}

{% block primarysidebar %}
  <div class="action-box">
    <div class="action-box-inner">
{% if view.canUpdatePerson %}
      <h2>Account</h2>
      <ul>
        <li><a href="{{uriPrefix}}/people/{{domainObject.name}}/edit/">Settings</a></li>
        <li><a href="{{uriPrefix}}/people/{{domainObject.name}}/apikey/">API key</a></li>
        {% if view.isSshPluginEnabled %}
        <li><a href="{{uriPrefix}}/people/{{domainObject.name}}/sshKeys/create/">SSH keys</a></li>
        {% endif %}
        {% if view.registry.plugins.trac %}
        <li><a href="{{uriPrefix}}/people/{{domainObject.name}}/tickets/">Your tickets</a></li>
        <li><a href="{{uriPrefix}}/people/{{domainObject.name}}/tracsearch/">Search trac services</a></li>
        {% endif %}
      </ul>
{% endif %}
      <h2>Memberships</h2>
      {% if memberships %}
      <ul>
        {% for member in memberships %} 
        <li><a href="{{uriPrefix}}/projects/{{ member.project.name }}/">{{ member.project.getLabelValue|escape }}</a></li>
        {% endfor %}
      </ul>
      {% else %}
      <p>None</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
