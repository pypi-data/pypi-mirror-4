
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Defining Jobs using FireTasks &mdash; FireWorks 0.1dev1.6 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1dev1.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="FireWorks 0.1dev1.6 documentation" href="index.html" />
    <link rel="next" title="Creating Workflows" href="workflow_tutorial.html" />
    <link rel="prev" title="Installation Tutorial (part 2: the Worker)" href="installation_tutorial_pt2.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="workflow_tutorial.html" title="Creating Workflows"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation_tutorial_pt2.html" title="Installation Tutorial (part 2: the Worker)"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">FireWorks 0.1dev1.6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="defining-jobs-using-firetasks">
<h1>Defining Jobs using FireTasks<a class="headerlink" href="#defining-jobs-using-firetasks" title="Permalink to this headline">¶</a></h1>
<p>In the <a class="reference internal" href="installation_tutorial.html"><em>installation tutorial</em></a>, we ran a simple script that performed <tt class="docutils literal"><span class="pre">echo</span> <span class="pre">&quot;howdy,</span> <span class="pre">your</span> <span class="pre">job</span> <span class="pre">launched</span> <span class="pre">successfully!&quot;</span> <span class="pre">&gt;&gt;</span> <span class="pre">howdy.txt&quot;</span></tt>. Looking inside <tt class="docutils literal"><span class="pre">fw_test.yaml</span></tt>, that command was defined within a task labeled <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt>:</p>
<div class="highlight-python"><pre>spec:
  _tasks:
  - _fw_name: Script Task
    parameters:
      script: echo "howdy, your job launched successfully!" &gt;&gt; howdy.txt
      use_shell: true</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt> is one type of <em>FireTask</em>, which is a predefined job template written in Python. The <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt> in particular refers Python code inside FireWorks that runs an arbitrary shell script that you give it. You can use the <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt> to run almost any job (without worrying that it&#8217;s all done within a Python layer). However, you might want to set up custom job templates that are more explicit and reusable. In this section, we&#8217;ll demonstrate how to accomplish this with <em>FireTasks</em>, as well as provide more details on the <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt>.</p>
<p>This tutorial can be completed from the command line. Some knowledge of Python is helpful, but not required. In this tutorial, we will run examples on the central server for simplicity. One could just as easily run them on a FireWorker if you&#8217;ve set one up.</p>
<div class="section" id="running-multiple-firetasks">
<h2>Running multiple FireTasks<a class="headerlink" href="#running-multiple-firetasks" title="Permalink to this headline">¶</a></h2>
<p>You can run multiple tasks within the same FireWork. For example, the first step of your FireWork might write an input file that the second step processes. Let&#8217;s create a FireWork where the first step prints <tt class="docutils literal"><span class="pre">howdy.txt</span></tt>, and the second step counts the number of words in that file.</p>
<ol class="arabic">
<li><p class="first">Navigate to the tasks tutorial directory on your FireServer:</p>
<div class="highlight-python"><pre>cd &lt;INSTALL_DIR&gt;/fw_tutorials/firetask</pre>
</div>
</li>
<li><p class="first">Look inside the file <tt class="docutils literal"><span class="pre">fw_multi.yaml</span></tt>. You should see two instances of <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt> inside our <strong>spec</strong>. Remember, our <strong>spec</strong> contains all the information needed to run our job. The second <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt> runs the <tt class="docutils literal"><span class="pre">wc</span> <span class="pre">-w</span></tt> command to count the number of characters in <tt class="docutils literal"><span class="pre">howdy.txt</span></tt> and exports the result to <tt class="docutils literal"><span class="pre">words.txt</span></tt>:</p>
<div class="highlight-python"><pre>spec:
  _tasks:
  - _fw_name: Script Task
    parameters:
      script: echo "howdy, your job launched successfully!" &gt; howdy.txt
      use_shell: true
  - _fw_name: Script Task
    parameters:
      script: wc -w &lt; howdy.txt &gt; words.txt
      use_shell: true</pre>
</div>
</li>
<li><p class="first">Run this multi-step FireWork on your FireServer:</p>
<div class="highlight-python"><pre>lp_run.py reset &lt;TODAY'S DATE&gt;
lp_run.py add fw_multi.yaml
rlauncher_run.py singleshot</pre>
</div>
</li>
</ol>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can run all three of these commands on a single line by separating them with a semicolon. This will reset the database, insert a FW, and run it within a single command.</p>
</div>
<p>You should see two files written out to the system, <tt class="docutils literal"><span class="pre">howdy.txt</span></tt> and <tt class="docutils literal"><span class="pre">words.txt</span></tt>, confirming that you successfully ran a two-step job!</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The only way to communicate information between FireTasks within the same FireWork is by writing and reading files, such as in our example. If you want to perform more complicated information transfer, you might consider <a class="reference internal" href="#customtask-label"><em>Creating a custom FireTask</em></a> or <a class="reference internal" href="workflow_tutorial.html"><em>defining a workflow</em></a> that connects FireWorks instead.</p>
</div>
</div>
<div class="section" id="using-scripttask">
<h2>Using ScriptTask<a class="headerlink" href="#using-scripttask" title="Permalink to this headline">¶</a></h2>
<p>While running arbitrary shell scripts is flexible, it&#8217;s not particularly well-organized. The command (<tt class="docutils literal"><span class="pre">echo</span></tt>), its arguments (<tt class="docutils literal"><span class="pre">&quot;howdy,</span> <span class="pre">your</span> <span class="pre">job</span> <span class="pre">launched</span> <span class="pre">successfully!&quot;</span></tt>), and its output (<tt class="docutils literal"><span class="pre">howdy.txt</span></tt>) are all intermingled within the same line. If we separated these components, it would be easier to do a data-parallel task where the same commands are run for multiple arguments. Let&#8217;s explore a better way to define our multi-step job:</p>
<ol class="arabic">
<li><p class="first">Staying in the firetasks tutorial directory, remove any output from the previous step:</p>
<div class="highlight-python"><pre>rm howdy.txt fw.json words.txt</pre>
</div>
</li>
<li><p class="first">Look inside the file <tt class="docutils literal"><span class="pre">fw_better_multi.yaml</span></tt>:</p>
<div class="highlight-python"><pre>spec:
  _tasks:
  - _fw_name: Script Task
    parameters:
      script: cat -t
      stdin_key: echo_text
      stdout_file: howdy.txt
  - _fw_name: Script Task
    parameters:
      script: wc -w
      stdin_file: howdy.txt
      stdout_file: words.txt
  echo_text: howdy, your job launched successfully!</pre>
</div>
<p>You should see two FireTasks as before. However, this time, the <strong>spec</strong> contains more than just <strong>_tasks</strong> - it also contains an <strong>echo_text</strong> parameter that&#8217;s separated from the <strong>_tasks</strong>. We can replace the <strong>echo_text</strong> parameter with arbitrary data, and the same <strong>_tasks</strong> will process that data. Thus, performing the same tasks on multiple data is just a matter of changing a single parameter.</p>
<p>Under the hood, the first <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt> is getting its input from the <strong>echo_text</strong> parameter (we defined its <tt class="docutils literal"><span class="pre">stdin_key</span></tt> to be <em>echo_text</em>). It is then writing its output to <tt class="docutils literal"><span class="pre">howdy.txt</span></tt>. The second <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt> is reading in <tt class="docutils literal"><span class="pre">howdy.txt</span></tt>, performing the <tt class="docutils literal"><span class="pre">wc</span> <span class="pre">-w</span></tt> command, and writing its output <tt class="docutils literal"><span class="pre">words.txt</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We have changed the command from <tt class="docutils literal"><span class="pre">echo</span></tt> (in earlier examples) to <tt class="docutils literal"><span class="pre">cat</span> <span class="pre">-t</span></tt> - this is because <tt class="docutils literal"><span class="pre">cat</span> <span class="pre">-t</span></tt> can easily take in input from a standard input stream, which is how the <strong>echo_text</strong> parameter is being fed in.</p>
</div>
</li>
<li><p class="first">Run the FireWork on the central server to confirm that this new formulation also works as intended:</p>
<div class="highlight-python"><pre>lp_run.py reset &lt;TODAY'S DATE&gt;
lp_run.py add fw_better_multi.yaml
rlauncher_run.py singleshot</pre>
</div>
</li>
</ol>
<p>At this point, you might want to change the <tt class="docutils literal"><span class="pre">echo_text</span></tt> parameter to something other than <tt class="docutils literal"><span class="pre">howdy,</span> <span class="pre">your</span> <span class="pre">job</span> <span class="pre">launched</span> <span class="pre">successfully!</span></tt>, reinsert the FireWork, and re-run the Rocket. Your custom text should get printed to <tt class="docutils literal"><span class="pre">howdy.txt</span></tt> and the number of words should change appropriately.</p>
</div>
<div class="section" id="creating-a-custom-firetask">
<span id="customtask-label"></span><h2>Creating a custom FireTask<a class="headerlink" href="#creating-a-custom-firetask" title="Permalink to this headline">¶</a></h2>
<p>Because the <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt> can run arbitrary shell scripts, it can in theory run any type of job and is an &#8216;all-encompassing&#8217; FireTask. However, if you are comfortable with some basic Python, it is better to define your own custom FireTasks (job templates) for the codes you run. A custom FireTask can clarify the usage of your code and guard against unintended behavior by restricting the commands that can be executed.</p>
<p>Even if you plan to only use <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt>, we suggest that you still read through the next portion before continuing with the tutorial. We&#8217;ll be creating a custom FireTask that adds one or more numbers using Python&#8217;s <tt class="docutils literal"><span class="pre">sum()</span></tt> function, and later building workflows using this (and similar) FireTasks:</p>
<ol class="arabic">
<li><p class="first">Staying in the firetasks tutorial directory, remove any output from the previous step:</p>
<div class="highlight-python"><pre>rm howdy.txt fw.json words.txt</pre>
</div>
</li>
<li><p class="first">Let&#8217;s first look at what a custom FireTask looks like in Python. Look inside the file <tt class="docutils literal"><span class="pre">addition_task.py</span></tt> which defines the <tt class="docutils literal"><span class="pre">Addition</span> <span class="pre">Task</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AdditionTask</span><span class="p">(</span><span class="n">FireTaskBase</span><span class="p">,</span> <span class="n">FWSerializable</span><span class="p">):</span>

    <span class="n">_fw_name</span> <span class="o">=</span> <span class="s">&quot;Addition Task&quot;</span>

    <span class="k">def</span> <span class="nf">run_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fw</span><span class="p">):</span>
        <span class="n">input_array</span> <span class="o">=</span> <span class="n">fw</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s">&#39;input_array&#39;</span><span class="p">]</span>
        <span class="n">m_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">input_array</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;The sum of {} is: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_array</span><span class="p">,</span> <span class="n">m_sum</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">FWAction</span><span class="p">(</span><span class="s">&#39;CONTINUE&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;sum&#39;</span><span class="p">:</span> <span class="n">m_sum</span><span class="p">})</span>
</pre></div>
</div>
</li>
<li><p class="first">A few notes about what&#8217;s going on:</p>
</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>In the class definition, we are extending <em>FireTaskBase</em> to tell FireWorks that this is a FireTask.</li>
<li>A special parameter named <em>_fw_name</em> is set to <tt class="docutils literal"><span class="pre">Addition</span> <span class="pre">Task</span></tt>. This parameter sets what this FireTask will be called by the outside world.</li>
<li>The <tt class="docutils literal"><span class="pre">run_task()</span></tt> method is a special method name that gets called when the task is run. It can take in a FireWork object (<em>fw</em>).</li>
<li>This FireTask first reads the <strong>input_array</strong> parameter of the FireWork&#8217;s <strong>spec</strong>.</li>
<li>It then sums all the values it finds in the <strong>input_array</strong> parameter of the FireWork&#8217;s <strong>spec</strong> using Python&#8217;s <tt class="docutils literal"><span class="pre">sum()</span></tt> function.</li>
<li>The FireTask then prints both the inputs and the sum to the standard out.</li>
<li>Finally, the task returns a <em>FWAction</em> object. We&#8217;ll discuss this object in greater detail in future tutorials. For now, it is sufficient to know that this is an instruction that says we should <em>CONTINUE</em> with the workflow, and store the sum we computed in the database (inside the FireWork&#8217;s <tt class="docutils literal"><span class="pre">stored_data</span></tt> section).</li>
</ul>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Now let&#8217;s define a FireWork that runs this FireTask to add the numbers <tt class="docutils literal"><span class="pre">1</span></tt> and <tt class="docutils literal"><span class="pre">2</span></tt>. Look inside the file <tt class="docutils literal"><span class="pre">fw_adder.yaml</span></tt> for this new FireWork definition:</p>
<div class="highlight-python"><pre>spec:
  _tasks:
  - _fw_name: Addition Task
    parameters: {}
  input_array:
  - 1
  - 2</pre>
</div>
</li>
<li><p class="first">Let&#8217;s match up this FireWork&#8217;s <strong>spec</strong> with our code for our custom FireWork:</p>
</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>The <em>_fw_name</em> parameter is set to the same value as in our code for the FireTask (<tt class="docutils literal"><span class="pre">Addition</span> <span class="pre">Task</span></tt>). This is how FireWorks knows to run your custom FireTask rather than <tt class="docutils literal"><span class="pre">Script</span> <span class="pre">Task</span></tt> or some other FireTask.</li>
<li>This <strong>spec</strong> has an <strong>input_array</strong> field defined to <tt class="docutils literal"><span class="pre">1</span></tt> and <tt class="docutils literal"><span class="pre">2</span></tt>. Remember that our Python code was grabbing the values in the <strong>input_array</strong>, summing them, and printing them to standard out.</li>
</ul>
</div></blockquote>
<ol class="arabic">
<li><p class="first">When you are comfortable that you roughly understand how a custom FireTask is set up, try running the FireWork on the central server to confirm that the <tt class="docutils literal"><span class="pre">Addition</span> <span class="pre">Task</span></tt> works:</p>
<div class="highlight-python"><pre>lp_run.py reset &lt;TODAY'S DATE&gt;
lp_run.py add fw_adder.yaml
rlauncher_run.py --silencer singleshot</pre>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">--silencer</span></tt> option suppresses log messages.</p>
</div>
<p># Confirm that the <em>sum</em> is not only printed to the screen, but also stored in our FireWork in the <tt class="docutils literal"><span class="pre">stored_data</span></tt> section:</p>
<div class="highlight-python"><pre>lp_run.py get_fw 1</pre>
</div>
</div>
<div class="section" id="next-up-workflows">
<h2>Next up: Workflows!<a class="headerlink" href="#next-up-workflows" title="Permalink to this headline">¶</a></h2>
<p>With custom FireTasks, you can go beyond the limitations of running shell commands and execute arbitrary Python code templates. Furthermore, these templates can operate on data from the <tt class="docutils literal"><span class="pre">spec</span></tt> of the FireWork. For example, the <tt class="docutils literal"><span class="pre">Addition</span> <span class="pre">Task</span></tt> used the <tt class="docutils literal"><span class="pre">input_array</span></tt> from the spec to decide what numbers to add. By using the same FireWork with different values in the <tt class="docutils literal"><span class="pre">spec</span></tt>, one could execute a data-parallel application.</p>
<p>While one could construct an entire workflow by chaining together multiple FireTasks within a single FireWork, this is often not ideal. For example, we might want to switch between different FireWorkers for different parts of the workflow depending on the computing requirements for each step. Or, we might have a restriction on walltime that necessitates breaking up the workflow into more atomic steps. Finally, we might want to employ complex branching logic or error-correction that would be cumbersome to employ within a single FireWork. The next step in the tutorial is to explore <a class="reference internal" href="workflow_tutorial.html"><em>connecting together FireWorks into a workflow</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Defining Jobs using FireTasks</a><ul>
<li><a class="reference internal" href="#running-multiple-firetasks">Running multiple FireTasks</a></li>
<li><a class="reference internal" href="#using-scripttask">Using ScriptTask</a></li>
<li><a class="reference internal" href="#creating-a-custom-firetask">Creating a custom FireTask</a></li>
<li><a class="reference internal" href="#next-up-workflows">Next up: Workflows!</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation_tutorial_pt2.html"
                        title="previous chapter">Installation Tutorial (part 2: the Worker)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="workflow_tutorial.html"
                        title="next chapter">Creating Workflows</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/firetask_tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="workflow_tutorial.html" title="Creating Workflows"
             >next</a> |</li>
        <li class="right" >
          <a href="installation_tutorial_pt2.html" title="Installation Tutorial (part 2: the Worker)"
             >previous</a> |</li>
        <li><a href="index.html">FireWorks 0.1dev1.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Anubhav Jain.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>