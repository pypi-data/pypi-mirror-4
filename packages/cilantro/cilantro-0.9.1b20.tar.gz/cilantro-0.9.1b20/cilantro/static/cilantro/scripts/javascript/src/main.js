// Generated by CoffeeScript 1.3.3

define(['cilantro/core', 'cilantro/utils/logging', 'order!vendor/jquery.ui', 'order!vendor/jquery.idle', 'order!vendor/jquery.jqote2', 'order!vendor/jquery.block', 'order!vendor/jquery.scrollto', 'order!cilantro/utils/ajaxsetup', 'order!cilantro/utils/extensions', 'order!cilantro/utils/sanitizer'], function(Core, Logging) {
  var pendingRequests, safeMethod;
  if (!window.JSON) {
    require(['vendor/json2']);
  }
  $.block.defaults.message = null;
  $.block.defaults.css = {};
  $.block.defaults.overlayCSS = {};
  App.Log = new Logging.Log;
  App.LogView = new Logging.LogView;
  $.idleTimer(10 * 1000);
  pendingRequests = 0;
  $(document).bind({
    'idle.idleTimer': function() {
      return App.hub.publish('session/idle');
    },
    'active.idleTimer': function() {
      return App.hub.publish('session/resume');
    }
  });
  safeMethod = function(method) {
    return /^(GET|HEAD|OPTIONS|TRACE)$/.test(method);
  };
  $(document).on({
    ajaxSend: function(evt, xhr, settings) {
      if (!safeMethod(settings.type)) {
        return pendingRequests++;
      }
    },
    ajaxComplete: function(evt, xhr, settings) {
      if (!safeMethod(settings.type)) {
        return pendingRequests--;
      }
    }
  });
  return $(window).on('beforeunload', function() {
    if (pendingRequests) {
      return "Whoa you're quick! We are saving your stuff, it will only take a moment.";
    }
  });
});
